<div class="custom-dialog">
    <div class="custom-close" mat-dialog-close (click)="onNoClick()">
      <fa-icon icon="times" class="project-dialog"></fa-icon>
    </div>
  </div>
<div class = "full-height">
    <mat-card class="p-0 m-0 time-sheet">
        <mat-card-title class="data-table-header drag-handler">
            <div fxLayout="row wrap" fxLayout.xs="column" fxLayoutGap="0">
                <div fxFlex fxFlex.xs="100" fxLayoutAlign="start center" fxLayoutAlign.xs="center center">
                    <div class="card-title-text p-05">Error list
                    </div>
                </div>
                <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center" class="mr-05">
                    <mat-slide-toggle
                        [matTooltip]="(isArchived == true) ? 'Switch to unarchive' : 'Switch to archive'"
                        class="archive-switch" [(ngModel)]="isArchived" [checked]="isArchived"
                        (change)="changeArchiveError(isArchived)">
                    </mat-slide-toggle>
                </div>
                <div class="h-75" fxFlex="180px" fxFlex.xs="100" fxFlexOffset.xs="20px" fxLayoutAlign="end center">
                    <button mat-icon-button color="primary" matTooltip="Add error"
                        [satPopoverAnchorFor]="editErrorPopover" #editErrorPopUp="satPopoverAnchor"
                        (click)="$event.stopPropagation();openAddPopover(editErrorPopUp)">
                        <fa-icon class="mat-color-accent icon-button" icon="plus"></fa-icon>
                    </button>
                </div>
                <div class="mr-05 search_goalinput row-wrap" fxFlex="180px" fxFlex.xs="100" fxFlexOffset.xs="20px">
                    <mat-form-field fxLayoutAlign="end center" fxLayoutAlign.xs="start center">
                        <input class="search_goal" matInput placeholder="Search"
                            [(ngModel)]="searchText" (input)="filterByName($event)">
                    </mat-form-field>
                    <span class="custom_close_icon">
                        <span *ngIf="!searchText">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                        <mat-icon *ngIf="searchText" class="icon-button" aria-hidden="false" (click)="closeSearch()"
                            style="cursor:pointer"> 
                            close</mat-icon>
                    </span>
                </div>
            </div>
        </mat-card-title>
        <div class="full-height">
            <mat-progress-bar color="primary" mode="indeterminate" *ngIf="isLoading">
            </mat-progress-bar>
            <kendo-grid [data]="errorList" [sortable]="true" [pageable]="false" [filterable]="false"
                [selectable]="false" [sort]="sort" (sortChange)="sortChange($event)" [height]="696" [scrollable]="true">
                <kendo-grid-column field="errorMessage" title="Error name"
                    [style]="{'cursor':'default'}">
                </kendo-grid-column>
                <kendo-grid-column field="errorCode" title="Error code"
                    [style]="{'cursor':'default'}">
                </kendo-grid-column>
                <kendo-grid-column field="description" title="Description"
                    [style]="{'cursor':'default'}">
                </kendo-grid-column>
                <kendo-grid-command-column field="action" title="Actions">
                    <ng-template kendoGridCellTemplate let-dataItem>
                        <button *ngIf="!isArchived" class="text-center mr-05" title="Edit error"
                            mat-icon-button [satPopoverAnchorFor]="editErrorPopover"
                            #editErrorPopUp="satPopoverAnchor" (click)="editError(dataItem,editErrorPopUp)">
                            <fa-icon icon="edit" style="cursor: pointer;" class="mat-color-accent"></fa-icon>
                        </button>
                        <button *ngIf="!isArchived"
                        class="text-center" title="Archive error"
                        [satPopoverAnchorFor]="deleteError" #deleteErrorPopover="satPopoverAnchor"
                        (click)="$event.stopPropagation();deleteErrorItem(dataItem,deleteErrorPopover)"
                        mat-icon-button>
                        <!-- <fa-icon icon="archive" style="cursor: pointer;" class="mat-color-accent"></fa-icon> -->
                        <mat-icon style="cursor: pointer;" class="mat-color-accent">archive</mat-icon>
                    </button>
                    <button *ngIf="isArchived"
                        class="text-center" title="Unarchive error"
                        [satPopoverAnchorFor]="deleteError" #deleteErrorPopover="satPopoverAnchor"
                        (click)="$event.stopPropagation();deleteErrorItem(dataItem,deleteErrorPopover)"
                        mat-icon-button>
                        <!-- <fa-icon icon="archive" style="cursor: pointer;" class="mat-color-accent"></fa-icon> -->
                        <mat-icon style="cursor: pointer;" class="mat-color-accent">unarchive</mat-icon>
                    </button>
                    </ng-template>
                </kendo-grid-command-column>
            </kendo-grid>
        </div>
    </mat-card>
</div>

<sat-popover #editErrorPopover [autoFocus]="false" hasBackdrop backdropClass="backdrop-color" [restoreFocus]="false"
    [interactiveClose]="false" scrollStrategy="reposition" verticalAlign="below" horizontalAlign="end">
    <mat-card class="filter-data p-0" style="width: 330px;">
        <mat-card-title class="text-center">
            <div class="card-title-text mat-bg-primary p-05">
                <span *ngIf="isEdit">
                    Edit error
                </span>
                <span *ngIf="!isEdit">
                    Add error
                </span>
            </div>
        </mat-card-title>
        <form [formGroup]="form" novalidate #formDirective="ngForm"
            (submit)="form.valid && upsertError()">
            <div class="mobile-view-popover p-1">
                <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="10px" fxLayoutGap.xs="0px">
                    <div fxFlex="100" fxFlex.xs="100">
                        <mat-form-field class="full-width">
                            <input formControlName="errorMessage" matInput required
                                placeholder="Error name">
                            <mat-error *ngIf="form.get('errorMessage').hasError('required') &&
                                     form.get('errorMessage').touched">
                                Error name is required
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
                <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="10px" fxLayoutGap.xs="0px">
                    <div fxFlex="100" fxFlex.xs="100">
                        <mat-form-field class="full-width">
                            <input formControlName="errorCode" matInput required
                                placeholder="Error code">
                            <mat-error *ngIf="form.get('errorCode').hasError('required') &&
                                     form.get('errorCode').touched">
                                Error name is required
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
                <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="10px" fxLayoutGap.xs="0px">
                    <div fxFlex="100" fxFlex.xs="100">
                        <mat-form-field class="full-width">
                            <input formControlName="description" matInput
                                placeholder="Description">
                        </mat-form-field>
                    </div>
                </div>
            </div>
            <div class="text-center mb-1 prl-1">
                <button mat-raised-button color="primary" type="submit" class="mr-05"
                    (click)="$event.stopPropagation()">
                    <mat-progress-bar color="primary" mode="indeterminate" *ngIf="upsertInProgress">
                    </mat-progress-bar>
                    <span *ngIf="isEdit"><fa-icon icon="save" class="mr-05" *ngIf="isEdit"></fa-icon> Save </span>
                    <span *ngIf="!isEdit"><fa-icon icon="plus" class="mr-05"></fa-icon> Add </span>
                </button>
                <button mat-raised-button (click)="closePopup()" type="reset">
                    <fa-icon icon="times" class="mr-05"></fa-icon> Cancel
                </button>
            </div>
        </form>
    </mat-card>
</sat-popover>

<sat-popover #deleteError hasBackdrop backdropClass="backdrop-color" verticalAlign="below" horizontalAlign="end"
    [interactiveClose]="false">
    <mat-card class="p-0">
        <mat-card-title class="text-center mat-bg-primary">
            <div class="card-title-text p-05"> Confirmation </div>
        </mat-card-title>
        <mat-card-content>
            <mat-progress-bar color="primary" mode="indeterminate" *ngIf="deleteOperationIsInprogress">
            </mat-progress-bar>
            <div class="card-content p-05" *ngIf="!isArchived">
                Are you sure, you want to archive error
            </div>
            <div class="card-content p-05" *ngIf="isArchived">
                Are you sure, you want to unarchive error
            </div>
            <div class="text-center">
                <button *ngIf="!isArchived" class="mr-05" mat-button mat-raised-button color="primary"
                    (click)="removeErrorAtIndex(true)" [disabled]="deleteOperationIsInprogress">
                    <mat-icon style="cursor: pointer;" class="mr-05">archive</mat-icon>
                    Archive
                </button>
                <button *ngIf="isArchived" class="mr-05" mat-button mat-raised-button color="primary"
                    (click)="removeErrorAtIndex(false)" [disabled]="deleteOperationIsInprogress">
                    <mat-icon style="cursor: pointer;" class="mr-05">unarchive</mat-icon>
                    Unarchive
                </button>
                <button mat-button mat-raised-button (click)="closeDeleteErrorDialog();">
                    <fa-icon class="mr-05" icon="times"></fa-icon> Cancel
                </button>
            </div>
        </mat-card-content>
    </mat-card>
</sat-popover>