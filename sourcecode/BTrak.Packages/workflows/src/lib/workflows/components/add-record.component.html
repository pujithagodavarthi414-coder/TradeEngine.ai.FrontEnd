<div class="custom-dialog">
    <mat-progress-bar color="primary" mode="indeterminate" *ngIf="isLoading">
    </mat-progress-bar>
    <div class="custom-close" mat-dialog-close (click)="onNoClick()">
        <fa-icon icon="times" class="project-dialog"></fa-icon>
    </div>
</div>
<mat-card class="filter-data p-0">
    <mat-card-title class="text-center">
        <div class="card-title-text mat-bg-primary p-05">
            Add record insert</div>
    </mat-card-title>
    <form [formGroup]="insertionForm" novalidate (submit)="insertionForm.valid && upsertNewRecord()">
        <div id="style-1" class="goal-create-height p-1">
            <input matInput hidden formControlName="id" />
            <div fxLayout="row wrap" class="p-05 ">
                <div fxFlex="98">
                    <div fxFlex fxLayout="row wrap">
                        <div fxFlex="30">
                            <div class="pt-1">Form Name</div>
                        </div>
                        <div fxFlex="50" class="pt-1">
                            <mat-label>{{formname}}</mat-label>
                        </div>
                    </div>
                </div>
                <div fxFlex="98">
                    <div fxFlex fxLayout="row wrap">
                        <div fxFlex="30">
                            <div class="pt-1">Record insertion name *</div>
                        </div>
                        <mat-form-field class="full-width" fxFlex="50">
                            <input matInput formControlName="name">
                            <mat-error>
                                <span *ngIf="insertionForm.get('name').hasError('required')">
                                    Record insertion name is required</span>
                            </mat-error>

                        </mat-form-field>
                    </div>
                </div>
                <div fxFlex="98">
                    <div fxFlex fxLayout="row wrap">
                        <div fxFlex="30">
                            <div class="pt-1">Select child form *</div>
                        </div>
                        <mat-form-field class="full-width" fxFlex="50">
                            <mat-select formControlName="dataSourceId" (selectionChange)="onFormChange($event.value)">
                                <mat-option *ngFor="let t of formsList" [value]="t.id">
                                    {{t.formName}}
                                </mat-option>
                            </mat-select>
                            <mat-error>
                                <span *ngIf="insertionForm.get('dataSourceId').hasError('required')">
                                    Please select child form to submit</span>
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
                <div fxFlex="98">
                    <div fxFlex fxLayout="row wrap">
                        <div fxFlex="30">
                            <div class="pt-1">Select child custom application *</div>
                        </div>
                        <mat-form-field class="full-width" fxFlex="50">
                            <mat-select formControlName="customApplicationId">
                                <mat-option
                                    *ngFor="let t of customApplications | customApplicationFilter: selectedFormId"
                                    [value]="t.customApplicationId">
                                    {{t.customApplicationName}}
                                </mat-option>
                            </mat-select>
                            <mat-error>
                                <span *ngIf="insertionForm.get('customApplicationId').hasError('required')">
                                    Please select child custom application</span>
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>

                <div fxLayout="row" style="padding-top: 15px;">
                    Configure keys to submit new record</div>
                <div fxFlex="98" class="dvCriteria" style="padding-top: 15px;">
                    <div style="display: flex">
                        <div class="align-center" fxFlex="30px" class="mr-05">

                        </div>
                        <div fxFlex="100" fxFlex.gt-xs="22" fxFlex.xs="36" class="mr-05">
                            Select  fields for parent form
                        </div>
                        <div fxFlex="20">

                        </div>
                        <div fxFlex="100" fxFlex.gt-xs="22" fxFlex.xs="36" class="mr-05">
                            Select new fields for child form
                        </div>
                    </div>

                    <div formArrayName="inputParamSteps"
                        *ngFor="let item of insertionForm.get('inputParamSteps')['controls']; let i = index;">
                        <mat-card-content class="Step-description mt-1" fxFlex="98" fxFlex.gt-sm="98">
                            <div [formGroupName]="i" style="display: flex">
                                <input matInput hidden formControlName="id" />
                                <div class="align-center" fxFlex="30px" class="mr-05">
                                    <span class="test-case-step-count count-padding">{{i + 1}}.</span>
                                </div>

                                <div fxFlex="100" fxFlex.gt-xs="22" fxFlex.xs="36" class="mr-05">
                                    <mat-form-field class="full-width">
                                        <mat-select formControlName="inputName">
                                            <mat-option *ngFor="let t of formKeys" [value]="t.key">
                                                {{t.label}}
                                            </mat-option>
                                        </mat-select>
                                        <mat-error>
                                            <span *ngIf="item.get('inputName').hasError('required')">
                                                Please select form key</span>
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                                <div fxFlex="20">
                                    <div class="fieldequal">=</div>
                                </div>
                                <div fxFlex="100" fxFlex.gt-xs="22" fxFlex.xs="36" class="mr-05">
                                    <mat-form-field class="full-width">
                                        <mat-select formControlName="inputValue">
                                            <mat-option *ngFor="let t of formKeysDropdown" [value]="t.key">
                                                {{t.label}}
                                            </mat-option>
                                        </mat-select>
                                        <mat-error>
                                            <span
                                                *ngIf="item.get('inputValue').hasError('required') && item.get('inputValue').touched">
                                                value required</span>
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                                <div fxFlex="40px" fxLayout="column" fxLayoutAlign="space-around center" class="ml-05"
                                    fxLayoutGap="8px">
                                    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px">
                                        <a class="icon-hover" matTooltip="Add" (click)="addItem(i)">
                                            <fa-icon icon="plus" class="mat-color-accent"></fa-icon>
                                        </a>
                                        <a class="icon-hover" matTooltip="Delete" (click)="removeItem(i)" *ngIf="i !=0">
                                            <fa-icon icon="minus" class="mat-color-accent"></fa-icon>
                                        </a>
                                    </div>

                                </div>
                            </div>
                        </mat-card-content>
                    </div>
                </div>
            </div>
        </div>
        <div class="mt-05">
            <button class="pull-right mr-1" mat-raised-button type="submit" color="primary"
                [disabled]="!insertionForm.valid">
                <fa-icon class="mr-05" icon="check"></fa-icon>
                Save
            </button>
            <button class="pull-right mr-1" mat-raised-button (click)="cancelRecordTask()"
                [disabled]="!insertionForm.valid " type="button">
                Cancel
            </button>
        </div>
    </form>
</mat-card>

<ng-template #addActivityDialog let-data>
    <app-activity-list [data]=[data]></app-activity-list>
</ng-template>