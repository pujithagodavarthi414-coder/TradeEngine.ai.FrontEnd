<ng-container *ngIf="canAccess_feature_ManageProjectRolePermissions">
    <!-- <div fxLayout="row" fxLayout.xs="column">
        <mat-card class="col-sm-12 mat-card" style="padding: 0px !important;">
            <mat-card-title class="full-width mat-card-title">
                <div style="display: flex;">
                    <div class="col-sm-6" style="padding-top: 10px !important;">
                        <h5>{{ 'PROJECTS.PROJECTROLEPERMISSION' | translate  | softLabelsPipe : softLabels | titlecase}}</h5>
                    </div>
                    <div class="col-sm-6" style="text-align: right;">
                        <button class="topbar-button-right mat-icon-button" *ngIf="canAccess_feature_ViewRoles"
                            matTooltip="{{ 'PROJECTS.ROLEPERMISSION' | translate  | softLabelsPipe : softLabels}}"
                            [routerLink]="['/rolemanagement/rolemanagement']" style="line-height: 20px !important;">
                            <span class="material-icons icon-button mat-color-accent">brightness_high</span>
                        </button>
                        <button class="topbar-button-right mat-icon-button"
                            matTooltip="{{ 'SOFTLABELS.PROJECTSLABEL' | translate  | softLabelsPipe : softLabels}}"
                            [routerLink]="['/projects/allprojects']" style="line-height: 20px !important;">
                            <span class="material-icons icon-button mat-color-accent">work</span>
                        </button>
                    </div>
                </div>
            </mat-card-title>
        </mat-card>
    </div> -->
    <div fxLayout="row" fxLayout.xs="column">

        <div fxFlex="20" fxFlex.md="30" fxFlex.sm="40" fxFlex.xs="100">
            <mat-card class="p-0 m-0 mr-05">
                <mat-card-title class="data-table-header drag-handler">
                    <div class="role-title">
                        <div fxLayout="row">
                            <span fxFlex>{{'ROLES.PROJECTROLEPERMISSIONLIST'|translate | softLabelsPipe : softLabels | titlecase}}
                            </span>
                            <span fxFlex="20px" fxLayoutAlign="end center" [satPopoverAnchorFor]="addEntityRolePopover"
                                #addEntityRoleSatPopover="satPopoverAnchor"
                                (click)="addEntityRole(addEntityRoleSatPopover)"
                                matTooltip="{{'ROLES.ADDPROJECTROLE'|translate | softLabelsPipe : softLabels}}">
                                <fa-icon class="icon-button mat-color-accent" icon="plus"> </fa-icon>
                            </span>
                        </div>
                    </div>
                    <mat-divider></mat-divider>
                </mat-card-title>
                <mat-card-content class="p-0 listof_roles entity-roles-list" id="style-1">
                    <mat-list class="compact-list">
                        <div fxLayout="column" fxLayoutGap="5px" fxLayoutAlign="space-around" class="role-card"
                            *ngFor="let role of rolesList" (click)="selectedRole(role)"
                            [ngClass]="{ active: selectedRoleId == role.entityRoleId }">
                            <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="center" class="entity-role">
                                <span fxFlex
                                    class="hide-content-overflow">{{role.entityRoleName | capitalizeFirst | softLabelsPipe : softLabels}}</span>
                                <span fxFlex="20px" fxLayoutAlign="center" [satPopoverAnchorFor]="addEntityRolePopover"
                                    #addEntityRoleSatPopover="satPopoverAnchor"
                                    (click)="editEntityRole(role,addEntityRoleSatPopover);$event.stopPropagation()"
                                    matTooltip="{{'ROLES.EDITPROJECTROLENAME'|translate | softLabelsPipe : softLabels}}">
                                    <fa-icon class="icon-button mat-color-accent" icon="edit"> </fa-icon>
                                </span>
                                <span fxFlex="20px" fxLayoutAlign="center" [satPopoverAnchorFor]="deleteEntityPopover"
                                    #deleteEntityRoleSatPopover="satPopoverAnchor" *ngIf="canAccess_feature_ArchiveRole"
                                    (click)="deleteEntityRoleOpen(role,deleteEntityRoleSatPopover);$event.stopPropagation()"
                                    matTooltip="{{'ROLES.DELETEPROJECTROLENAME'|translate | softLabelsPipe : softLabels}}">
                                    <fa-icon class="icon-button mat-color-accent" icon="trash"> </fa-icon>
                                </span>
                            </div>
                        </div>
                    </mat-list>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex="80" fxFlex.md="70" fxFlex.sm="60" fxFlex.xs="100">
            <form name="form" #entityRoleForm="ngForm" novalidate>
                <div fxLayout="column">
                    <mat-card class="p-0 m-0">
                        <mat-card-title class="data-table-header drag-handler">
                            <div fxLayout="row" fxLayout.xs="column" fxLayoutGap.xs="5px" style="padding: 0 1rem"
                                class="mt-05">
                                <div fxFlex="calc(100% - 200px)" fxFlex.xs="100" class="hide-content-overflow">
                                    <span matTooltip="{{selectedRoleName }}"
                                        matTooltipPosition="below">{{selectedRoleName }}</span>
                                </div>
                                <div fxFlex="200px" fxFlex.xs="100" fxLayoutAlign.gt-xs="end center">
                                    <mat-checkbox mat-primary name="agreed" [(ngModel)]="selectAll"
                                        (change)="checkAllCheckBoxes()">
                                        <span>{{'ROLES.SELECTALLPERMISSIONS'|translate}} </span></mat-checkbox>
                                </div>
                            </div>
                        </mat-card-title>
                        <mat-divider></mat-divider>
                        <!-- <div fxLayout="column" class="listof_roles entity-roles-list project-roles-card-height pt-05" id="style-1">
                            <div fxLayout="column" *ngFor="let option of entityFeatures; let i = index" class="prl-1">
                                <mat-checkbox name="{{ option.entityFeatureName }}" [(ngModel)]="option.isActive"
                                    id="checkbox-{{ option.entityFeatureId }}" value="{{ option.entityFeatureId }}"
                                    (change)="onSelection(option.isActive)">
                                    <span class="role-permission"
                                        title="{{ option.entityFeatureName | capitalizeFirst }}">{{option.entityFeatureName | capitalizeFirst | softLabelsPipe : softLabels}}</span>
                                </mat-checkbox>
                            </div>
                        </div> -->
                        <div class="listof_roles roleslist-text-overflow roles-list pt-05 entityRolesHeight"
                            id="style-1" *ngIf="!showEntityFeatures">
                            <div class="masonry">
                                <div *ngFor="let roleFeature of selectedRoleFeatureList; let i = index;"
                                    class="masonry-item">
                                    <div fxLayout="column" fxLayoutAlign="space-between none" fxLayoutGap="5px"
                                        class="masonry-card">
                                        <div class="text-center role-heading">
                                            <mat-checkbox name="{{ roleFeature.entityFeatureName }}"
                                                [(ngModel)]="roleFeature.isActive"
                                                (change)="parentFeatureChecked(roleFeature, roleFeature.isActive)"
                                                id="checkbox-{{ roleFeature.entityFeatureId }}"
                                                value="{{ roleFeature.entityFeatureId }}">
                                                <span matTooltip="{{ roleFeature.entityFeatureName | capitalizeFirst }}"
                                                    class="role-feature-name">{{ roleFeature.entityFeatureName | capitalizeFirst | softLabelsPipe : softLabels}}</span>
                                            </mat-checkbox>
                                        </div>
                                        <div fxFlex fxLayout="row wrap"
                                            *ngFor="let option of roleFeature.children; let i = index"
                                            style="position: relative;" class="roles-icon">
                                            <div fxFlex="94">
                                                <mat-checkbox name="{{ option.entityFeatureName }}"
                                                    [(ngModel)]="option.isActive"
                                                    (change)="getFeaturesId(option, option.isActive)"
                                                    id="checkbox-{{ option.entityFeatureId }}"
                                                    value="{{ option.entityFeatureId }}">
                                                    <div fxLayout="row wrap" fxLayoutGap="5px">
                                                        <div fxFlex="100" fxLayoutAlign="start center"
                                                            class="role-permission-hover">
                                                            <span class="role-permission"
                                                                matTooltip="{{ option.entityFeatureName | capitalizeFirst | softLabelsPipe : softLabels}}">{{option.entityFeatureName | capitalizeFirst | softLabelsPipe : softLabels}}</span>
                                                        </div>
                                                    </div>
                                                </mat-checkbox>
                                            </div>
                                            <div fxFlex="10" fxLayoutAlign="start center"
                                                style="position: absolute; right: 0;">
                                                <fa-icon icon="eye" aria-hidden="true"
                                                    class="goal-cursor mat-color-accent role-icon"
                                                    style="padding-left: 5px;"
                                                    matTooltip="{{'ROLESVIEW.VIEWROLESWITHTHISPERMISSION'|translate}}"
                                                    (click)="openRolesDialog(option.entityFeatureId, option.entityFeatureName);$event.stopPropagation()">
                                                </fa-icon>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Loading-->
                        <div fxLayout="column" class="listof_roles roles-list pt-05" id="style-1"
                            *ngIf="showEntityFeatures">
                            <div class="masonry">
                                <div *ngFor="let Feature of [1,2,3,4,5,6,7,8,9]; let i = index;" class="masonry-item">
                                    <div fxLayout="column" fxLayoutAlign="space-between none" fxLayoutGap="15px"
                                        class="masonry-card">
                                        <div fxLayout="row" fxLayoutGap="10px" fxLayoutAlign="center none"
                                            class="mt-05">
                                            <div fxFlex="5" fxFlexOffset="20">
                                                <mat-checkbox [disabled]="true"></mat-checkbox>
                                            </div>
                                            <div fxFlex="50">
                                                <p class="mat-body-1 role-permission-empty-text loading-bg m-0"></p>
                                            </div>
                                        </div>
                                        <div fxLayout="column" *ngFor="let option of [1,2,3,4,5,6]; let i = index"
                                            fxLayoutGap="15px">
                                            <div fxLayout="row" fxLayoutGap="10px">
                                                <div fxFlex="4" fxFlexOffset="20">
                                                    <mat-checkbox [disabled]="true"></mat-checkbox>
                                                </div>
                                                <div fxFlex>
                                                    <p class="mat-body-1 role-permission-empty-text loading-bg m-0"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Loading-->
                    </mat-card>
                </div>
                <div class="floating-right-fab-button">
                    <div class="handle mr-6">
                        <button class="text-center m-1" [disabled]="showSpinner" type="submit" color="primary"
                            matTooltip="{{'ROLES.CLICKHERETOSAVEPROJECTROLEPERMISSIONS' |translate}}" mat-button
                            mat-raised-button (click)="saveEntityRolePermission()">
                            <mat-progress-bar color="primary" mode="indeterminate" *ngIf="showSpinner">
                            </mat-progress-bar>
                            <fa-icon class="mr-05" icon="save" style="cursor: pointer;"></fa-icon>{{'SAVE'|translate}}
                        </button>
                        <button class="text-center mr-1" [disabled]="showSpinner" type="cancel" mat-button
                            mat-raised-button matTooltip="{{'ROLESVIEW.CLICKHERETORESETROLEPERMISSIONS'|translate}}"
                            (click)="resetFeatures()">
                            <fa-icon class="mr-05" icon="undo" style="cursor: pointer;"></fa-icon>
                            {{'RESET'|translate}}
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <sat-popover #addEntityRolePopover [autoFocus]="false" hasBackdrop backdropClass="backdrop-color"
        [restoreFocus]="false" [interactiveClose]="false" scrollStrategy="reposition" verticalAlign="below"
        horizontalAlign="end">
        <mat-card class="p-0 mr-0">
            <mat-card-title class="text-center">
                <div class="card-title-text  mat-bg-primary p-05" *ngIf="!selectedEntityRoleId">
                    {{'ROLES.ADDPROJECTROLE'|translate | softLabelsPipe : softLabels}} </div>
                <div class="card-title-text  mat-bg-primary p-05" *ngIf="selectedEntityRoleId">
                    {{'ROLES.EDITPROJECTROLE'|translate | softLabelsPipe : softLabels}} </div>
            </mat-card-title>
            <form [formGroup]="upsertEntityRoleForm" novalidate #formDirective="ngForm"
                (submit)="upsertEntityRoleForm.valid && upsertEntityRole()">
                <div class="p-1">
                    <mat-form-field class="full-width">
                        <input matInput
                            placeholder="{{'ROLES.PROJECTROLENAME'|translate | softLabelsPipe : softLabels}}"
                            formControlName="entityRoleName">
                        <mat-error>
                            <span
                                *ngIf="upsertEntityRoleForm.get('entityRoleName').hasError('required') && upsertEntityRoleForm.get('entityRoleName').touched">
                                {{'ROLES.PLEASEENTERPROJECTROLENAME'|translate | softLabelsPipe : softLabels}} </span>
                            <span *ngIf="upsertEntityRoleForm.get('entityRoleName').hasError('maxlength')">
                                {{'ROLES.PROJECTROLENAMESHOULDNOTEXCEED250CHARACTERS' | translate | softLabelsPipe : softLabels}}
                            </span>
                        </mat-error>
                    </mat-form-field>
                    <div fxLayout="row" fxLayoutAlign="space-evenly center" class="mt-05">
                        <button mat-button mat-raised-button color="primary" class="mr-1"
                            [disabled]="!upsertEntityRoleForm.valid || savingEntityRoleInProgress">
                            <mat-progress-bar color="primary" mode="indeterminate" *ngIf="savingEntityRoleInProgress">
                            </mat-progress-bar>
                            <fa-icon class="mr-05" icon="save"></fa-icon> {{'SAVE'|translate}}
                        </button>
                        <button mat-button mat-raised-button type="reset" [disabled]="savingEntityRoleInProgress"
                            (click)="closeEntityRolePopover()">
                            <fa-icon class="mr-05" icon="times"></fa-icon> {{'CANCEL'|translate}}
                        </button>
                    </div>
                </div>
            </form>
        </mat-card>
    </sat-popover>


    <sat-popover backdropClass="backdrop-color" #deleteEntityPopover hasBackdrop backdropClass="backdrop-color"
        verticalAlign="below" horizontalAlign="end">
        <mat-card class="p-0">
            <mat-card-title class="text-center">
                <div class="card-title-text mat-bg-primary p-05">{{'ROLES.DELETEPROJECTROLE' | translate}}
                </div>
            </mat-card-title>
            <div class="card-content p-1">
                <div class="text-center mb-1">{{'ROLES.AREYOUSUREWANTTODELETETHISPROJECTROLE?' | translate}}
                </div>
                <div fxLayoutAlign="space-around center">
                    <button type="button" mat-button mat-raised-button class="mr-05" color="primary"
                        [disabled]="deletingEntityRoleInProgress" (click)="deleteEntityRole();"><i
                            class="fa fa-check"></i>{{'YES' | translate}}</button>
                    <button type="button" mat-button mat-raised-button (click)="closedeleteEntityRoleDialog()"><i
                            class="fa fa-times"></i>{{ 'CANCEL' | translate }}</button>
                </div>
            </div>
        </mat-card>
    </sat-popover>
</ng-container>

<app-common-message-box *ngIf="!canAccess_feature_ManageProjectRolePermissions"
    textToDisplay="{{ 'PERMISSIONSSREGISTER.ALERTMESSAGE' | translate }}">
</app-common-message-box>