<mat-accordion class="goal-summary goal-expansion-panel">
    <mat-expansion-panel hideToggle="true" [expanded]="panelOpenState" [disabled]="true">
        <mat-expansion-panel-header class="p-05" [collapsedHeight]="'45px'" [expandedHeight]="'45px'"
            class="project-card goal-card goal-summary-card " (contextmenu)="openContextMenu($event)"
            [ngStyle]="{ 'background-color': sprintSelected == true ? '#e1f0ff' : '' }"
            [ngClass]="{'selected-goal': sprintSelected == true}">
            <div fxFlex="2px" class="userstory-left">
                &nbsp;
            </div>

            <div [fxFlex]="isAllGoalsPage ? '60' : '67'" fxFlex.md="66" fxFlex.xs="72" fxFlex.sm="85">
                <p *ngIf="!isAllGoalsPage || sprint.sprintId =='00000000-0000-0000-0000-000000000000'" class="mat-body-2 selected-goal-text"
                    matTooltip="{{sprint.sprintName}}" matTooltipClass="tooltip-overflow">
                    {{ sprint.sprintName}}</p>
                <span class="allgoals_txt userStory-name-control" matTooltip="{{ sprint.sprintName }}"
                    *ngIf="isAllGoalsPage && sprint.sprintId !='00000000-0000-0000-0000-000000000000'" [ngClass]="sprint.projectName ? 'userStory-tag-control': ''"
                    matTooltipShowDelay="1000" matTooltipClass="tooltip-overflow">
                    {{ sprint.sprintName }} </span>
                <span class="userstory-tags-display full-width hide-content-overflow" style="color:#736e6ef0"
                    *ngIf="isAllGoalsPage && sprint.sprintId !='00000000-0000-0000-0000-000000000000'">
                    {{sprint.projectName}}
                </span>
            </div>
           

            <!-- <span fxLayoutAlign="end center" fxFlex="20px"
                *ngIf="sprint.sprintId !='00000000-0000-0000-0000-000000000000'"
                style="color:#192219b3;font-size: 12px;">
                ({{sprint.workItemsCount}})
            </span>
            <span fxLayoutAlign="end center" fxFlex="20px"
                *ngIf="sprint.sprintId =='00000000-0000-0000-0000-000000000000'"
                style="color:#192219b3;font-size: 12px;">
                ({{userStoriesCount}})
            </span> -->

            <span (mouseover)="boardTypeTooltip(sprint.boardTypeId)" fxLayoutAlign="end center" fxFlex="40px"
                class="mt-04 goal-card-project">
                <span *ngIf="sprint.boardTypeId">
                    <fa-icon class="pull-left board-type-icons" *ngIf="!sprint.isBugBoard"
                        [ngClass]="(sprint.boardTypeUiId.toUpperCase() == boardView.toUpperCase()) ? 'kanbanRotate': 'superagileRotate'"
                        [matTooltip]="checkTooltip(sprint)" icon="bars" matTooltipClass="tooltip-overflow">
                    </fa-icon>
                    <fa-icon class="pull-left ml-02 board-type-icons" *ngIf="(sprint | boardTypeToIcon) != null"
                        [matTooltip]="checkTooltip(sprint)" icon="{{ sprint | boardTypeToIcon}}"
                        matTooltipClass="tooltip-overflow">
                    </fa-icon>
                </span>
            </span>
            <div fxFlex="8" fxFlex.sm="4" class="goals_summary_member ml-02"
                *ngIf="sprint.sprintId !='00000000-0000-0000-0000-000000000000'">
                <app-chip [matTooltip]="sprint.sprintResponsiblePersonName"
                    class="pull-right avatar-image goal-summary-image" *ngIf="sprint.sprintResponsiblePersonId"
                    [isNameRequired]="false" [name]="sprint.sprintResponsiblePersonName | removeSpecialCharacters "
                    [src]="sprint.profileImage | fetchSizedAndCachedImage: '20':''" size="20">
                </app-chip>

                <app-chip class="pull-right avatar-image goal-summary-image" *ngIf="!sprint.sprintResponsiblePersonId"
                    [isNameRequired]="false" [src]="defaultProfileImage" size="20">
                </app-chip>
            </div>

            <fa-icon class="rotate-icon ml-02 m-0 p-03" icon="chevron-right" fxLayoutAlign="start center"
                *ngIf="sprint.sprintId !='00000000-0000-0000-0000-000000000000'"
                [ngClass]="{'rotate-icon-down': expansionIcon}" (click)="togglePanel();$event.stopPropagation()">
            </fa-icon>
            <mat-icon class="more_vert card-control"
                *ngIf="((canAccess_entityType_feature_AddOrUpdateSprint) || (canAccess_entityType_feature_DeleteSprint) || (canAccess_entityType_feature_CompleteSprint)) && !sprint.isComplete && sprint.sprintId !='00000000-0000-0000-0000-000000000000'"
                matTooltip="{{ 'MENU' | translate }}" [matMenuTriggerFor]="editSprint"
                (click)="$event.stopPropagation();" [style.left]="contextMenuPosition.x"
                [style.top]="contextMenuPosition.y">
            </mat-icon>
        </mat-expansion-panel-header>
        <div (click)="$event.stopPropagation();">
            <div class="p-02" fxLayout="row wrap">
                <span fxFlex>{{ 'GOALS.USERSTORIESCOUNT' | translate | softLabelsPipe : softLabels }}</span>
                <div fxFlex="40" fxLayoutAlign="start center">
                    <span class="goals-count">
                        {{ sprint.userStoriesCount > 0 ? sprint.userStoriesCount : 0 }}
                    </span>
                </div>
            </div>
            <div class="p-02" fxLayout="row wrap">
                <span fxFlex>{{ 'SPRINTS.COMPLETEDUSERSTORIESCOUNT' | translate | softLabelsPipe : softLabels }}</span>
                <div fxFlex="40" fxLayoutAlign="start center">
                    <span class="goals-count">
                        {{ sprint.completedUserStoriesCount > 0 ? sprint.completedUserStoriesCount : 0 }}
                    </span>
                </div>
            </div>
            <div fxLayout="row wrap" class="text-left p-02" *ngIf="sprint.sprintUniqueName">
                <span fxFlex>{{ 'GOALS.UNIQUENAME' | translate }}</span>
                <div fxFlex="40" fxLayoutAlign="start center" class="sprint-unique-name goal-card-project"
                    (click)="navigateToSprintsPage()">
                    <a class="unique-details-link unique-numbers-hover">
                        {{sprint.sprintUniqueName}}
                    </a>

                </div>
            </div>
            <div class="p-02" fxLayout="row wrap">

                <span fxFlex *ngIf="(deadLineDate.value == 'arrow-right')||(deadLineDate.value == 'arrow-left')">{{
                    'SPRINTS.SPRINTSTARTDATE' | translate }}</span>
                <div fxFlex="40">
                    <input matInput [value]="sprint.sprintStartDate|deadLineDateToIconFilter:false" #deadLineDate
                        hidden />
                    <span *ngIf="deadLineDate.value == 'arrow-right'"
                        matTooltip=" {{ sprint.sprintStartDate| date: 'dd-MMM-yyyy'}}">
                        <fa-icon icon="arrow-right"></fa-icon> <span class="ml-02">
                            {{sprint.sprintStartDate |deadLineDateFilter:false}}</span>
                    </span>
                    <span *ngIf="deadLineDate.value == 'arrow-left'" class="absDaysCount"
                        matTooltip=" {{ sprint.sprintStartDate| date: 'dd-MMM-yyyy'}}">
                        <fa-icon icon="arrow-left" class="absDaysCount"></fa-icon> <span class="ml-02">
                            -{{sprint.sprintStartDate |deadLineDateFilter:false}}</span>
                    </span>
                </div>
            </div>
            <div class="p-02" fxLayout="row wrap">
                <span fxFlex *ngIf="(endDate.value == 'arrow-right')||(endDate.value == 'arrow-left')">{{
                    'SPRINTS.SPRINTENDDATE' | translate }}</span>
                <div fxFlex="40">
                    <input matInput [value]="sprint.sprintEndDate|deadLineDateToIconFilter:false" #endDate hidden />
                    <span *ngIf="endDate.value == 'arrow-right'"
                        matTooltip=" {{ sprint.sprintEndDate| date: 'dd-MMM-yyyy'}}">
                        <fa-icon icon="arrow-right"></fa-icon> <span class="ml-02">
                            {{sprint.sprintEndDate|deadLineDateFilter:false}}</span>
                    </span>
                    <span *ngIf="endDate.value == 'arrow-left'" class="absDaysCount"
                        matTooltip=" {{ sprint.sprintEndDate| date: 'dd-MMM-yyyy'}}">
                        <fa-icon icon="arrow-left" class="absDaysCount"></fa-icon> <span class="ml-02">
                            -{{sprint.sprintEndDate|deadLineDateFilter:false}}</span>
                    </span>
                </div>
            </div>
        </div>
    </mat-expansion-panel>
</mat-accordion>


<mat-menu class="goal-options" #editSprint="matMenu" (click)="$event.stopPropagation()">

    <!-- <button mat-menu-item class="allgoals_icons" [satPopoverAnchorFor]="startSprintPopover"
        (click)="startSprintPopover.open(); $event.stopPropagation();">
        <mat-icon>queue</mat-icon><span>{{ 'SPRINTS.STARTSPRINT' | translate }} </span>
    </button> -->
    <button mat-menu-item class="allgoals_icons" *ngIf="(canAccess_entityType_feature_AddOrUpdateSprint)"
        [satPopoverAnchorFor]="editSprintPopover"
        (click)="editSprintPopover.open(); $event.stopPropagation();editSprintForm()">
        <mat-icon>edit</mat-icon>{{'SPRINTS.EDITSPRINT' | translate}}
    </button>
    <button mat-menu-item class="allgoals_icons" *ngIf="(canAccess_entityType_feature_DeleteSprint)"
        [satPopoverAnchorFor]="deleteSprintPopover" (click)="deleteSprintPopover.open(); $event.stopPropagation();">
        <mat-icon>delete</mat-icon>{{'SPRINTS.DELETESPRINT' | translate}}
    </button>
    <button mat-menu-item class="allgoals_icons" *ngIf="(canAccess_entityType_feature_CompleteSprint)"
        [satPopoverAnchorFor]="completeSprintPopover" (click)="completeSprintPopover.open(); $event.stopPropagation();">
        <mat-icon>check_circle</mat-icon>{{'SPRINTS.COMPLETESPRINT' | translate}}
    </button>
</mat-menu>

<sat-popover #deleteSprintPopover verticalAlign="below" backdropClass="backdrop-color" hasBackdrop
    horizontalAlign="end">
    <mat-card class="filter-data p-0">
        <mat-card-title class="text-center">
            <div class="card-title-text mat-bg-primary p-05">
                <span> {{ 'SPRINTS.DELETESPRINT' | translate }}
                </span>
            </div>
        </mat-card-title>
        <p class="p-05 m-0">
            {{ 'SPRINTS.AREYOUSUREWANTTODELETETHISSPRINT' | translate }} </p>
        <div class="text-center p-05">
            <button mat-raised-button type="button" color="primary" class="mr-05"
                (click)="deleteSprint(); $event.stopPropagation()"
                [disabled]="(sprintArchiveOperationInProgress$ | async)">
                <mat-progress-bar color="primary" mode="indeterminate"
                    *ngIf="(sprintArchiveOperationInProgress$ | async)">
                </mat-progress-bar>
                <fa-icon icon="check" class="mr-05"></fa-icon> {{ 'YES' | translate }}
            </button>
            <button mat-raised-button type="button" (click)="closeArchivePopup();deleteSprintPopover.close()"
                [disabled]="(sprintArchiveOperationInProgress$ | async)">
                <fa-icon icon="times" class="mr-05"></fa-icon> {{ 'NO' | translate }}
            </button>
        </div>
    </mat-card>
</sat-popover>

<sat-popover #completeSprintPopover verticalAlign="below" backdropClass="backdrop-color" hasBackdrop
    horizontalAlign="end">
    <mat-card class="filter-data p-0">
        <mat-card-title class="text-center">
            <div class="card-title-text mat-bg-primary p-05 mb-1">
                <span> {{ 'SPRINTS.COMPLETESPRINT' | translate }}
                </span>
            </div>
        </mat-card-title>

        <span class="p-05"> {{ 'SPRINTS.AREYOUSUREWANTTOMOVETHEINCOMPLETEWORKITEMSTOBACKLOG' | translate }}
        </span>

        <div class="text-center mb-05">
            <button mat-raised-button type="button" color="primary" class="mr-05"
                (click)="completeSprint(); $event.stopPropagation()"
                [disabled]="(sprintDeleteOperationInProgress$ | async)">
                <mat-progress-bar color="primary" mode="indeterminate"
                    *ngIf="(sprintDeleteOperationInProgress$ | async)">
                </mat-progress-bar>
                <fa-icon icon="check" class="mr-05"></fa-icon> {{ 'YES' | translate }}
            </button>
            <button mat-raised-button type="button" (click)="closeDeletePopup();completeSprintPopover.close()"
                [disabled]="(sprintDeleteOperationInProgress$ | async)">
                <fa-icon icon="times" class="mr-05"></fa-icon> {{ 'NO' | translate }}
            </button>
        </div>
    </mat-card>
</sat-popover>

<sat-popover #editSprintPopover verticalAlign="below" backdropClass="backdrop-color" hasBackdrop horizontalAlign="end"
    [interactiveClose]="false">
    <mat-card class="filter-data p-0" style="width: 376px;">
        <mat-progress-bar color="primary" mode="indeterminate" *ngIf="(sprintOperationInProgress$ | async)">
        </mat-progress-bar>
        <mat-card-title class="text-center">
            <div class="card-title-text mat-bg-primary p-05 mb-1">
                <span> {{ 'SPRINTS.EDITSPRINT' | translate }}
                </span>
            </div>
        </mat-card-title>
        <app-edit-sprint *ngIf="isEditSprint" [sprint]="sprint" [isEnableTestRepo]="sprint.isEnableTestRepo"
            (closeEditSprintPopUp)="closeSprintPopup()">
        </app-edit-sprint>
    </mat-card>
</sat-popover>