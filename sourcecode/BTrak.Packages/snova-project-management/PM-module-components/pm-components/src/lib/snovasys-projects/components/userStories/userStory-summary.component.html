<div fxLayout="row" (click)="getSelectedUserStory(userStory,$event)" (contextmenu)="openContextMenu($event,userStory)"
  class="userstory-summary "
  [ngClass]="(userStory.tag  || (userStory.goalId && userStory.sprintId || isSprintView)) ? 'tag-superagile-summary': 'superagile-summary'"
  [ngStyle]="{ 'background-color': userStorySelected == true ? '#e6f5ff' : '' }">
  <div fxLayout="row" fxFlex="100" class="userstory-list">
    <div fxFlex="25px" class="userstory-accordion"
      *ngIf="isEditFromProjects  && ((!userStory.parentUserStoryId && !userStory.isBugBoard) || (userStory.isBugBoard))"
      (click)="toggleSubChilds($event,userStory.userStoryId);$event.stopPropagation()">
      <span class="ml-08" fxLayoutAlign="center center"
        *ngIf="  (!isSprintView && (((isActiveGoalsPage && userStory.subUserStories && isSuperagileBoard) || (isActiveGoalsPage  && !userStory.isBugBoard && ((!isSuperagileBoard && userStory.subUserStories && !isAddUserStory) || (!isSuperagileBoard && isAddUserStory)))) || ((!isActiveGoalsPage && !userStory.isBugBoard && userStory.subUserStories && !isAddUserStory) || (!isActiveGoalsPage && !userStory.isBugBoard && isAddUserStory)))) || (((isSprintView && isEnableToggle && !userStory.isBugBoard && userStory.subUserStories && !isAddUserStory) || (isSprintView && isEnableToggle && !userStory.isBugBoard  && isAddUserStory)))">
        <a class="caret-right-space" *ngIf="treeStructure">
          <fa-icon class="caret-size" icon="caret-right"></fa-icon>
        </a>
        <a class="caret-right-space" *ngIf="!treeStructure">
          <fa-icon class="caret-size" icon="caret-down"></fa-icon>
        </a>
      </span>
    </div>
    <div fxFlex="2px" class="userstory-left"
      [style.backgroundColor]="userStory.isOnTrack ? 'red' : userStory.userStoryStatusColor">
      &nbsp;
    </div>
    <input matInput [value]="(canAccess_entityType_feature_AddOrUpdateWorkItem)" #accessForUserstoryEdit hidden />

    <div class="mt-02 mr-05" fxFlex="15px" *ngIf=" userStory.icon && (isSprintUserStories || !notFromAudits)">
      <fa-icon *ngIf="userStory.icon" icon="{{userStory.icon}}"
        [ngStyle]="setColorForBugPriorityTypes(userStory.bugPriorityColor)"
        matTooltip="{{userStory.bugPriorityDescription}}"></fa-icon>
    </div>


    <div fxFlex class="mr-05 userStory-name-pm" fxLayout="column">
      <span class="allgoals_txt userStory-name-control"
        [ngClass]="(userStory.tag || (userStory.parentUserStoryGoalId && !isSubTasksPage) || (userStory.goalId && userStory.sprintId || isSprintView))? 'userStory-tag-control': ''"
        matTooltip="{{ userStory.userStoryName }}" matTooltipShowDelay="1000" matTooltipClass="tooltip-overflow">
        {{ userStory.userStoryName }}
      </span>
      <span fxFlex class="userstory-tags-display full-width hide-content-overflow">


        <span *ngIf="userStory.parentUserStoryGoalId && !isSubTasksPage">
          <span *ngIf="userStory.parentUserStoryName">
            <span class="custom-goal-tag" matTooltip="{{ userStory.parentUserStoryName }}"
              matTooltipClass="tooltip-overflow">
              {{ userStory.parentUserStoryName}}
            </span>
          </span>
        </span>
        <span *ngIf="fromApp && userStory.goalName && !isSubTasksPage">

          <span class="custom-userstory-tag" [style.backgroundColor]=" " matTooltip="{{ userStory.goalName }}"
            matTooltipClass="tooltip-overflow">
            {{ userStory.goalName}}
          </span>
        </span>

        <span *ngIf="isSprintUserStories && !isSubTasksPage">
          <span class="custom-goal-tag" [style.backgroundColor]=" " matTooltip="{{ userStory.goalShortName }}"
            matTooltipClass="tooltip-overflow">
            {{ userStory.goalShortName}}
          </span>
        </span>
        <span *ngIf="!isSprintUserStories && !isSprintView && !isSubTasksPage">

          <span class="custom-userstory-tag" [style.backgroundColor]=" " matTooltip="{{ userStory.sprintName }}"
            matTooltipClass="tooltip-overflow">
            {{ userStory.sprintName}}
          </span>
        </span>
        <span *ngIf="isSprintView && !isSubTasksPage">
          <span class="custom-goal-tag" [style.backgroundColor]=" " matTooltip="{{ userStory.goalShortName }}"
            matTooltipClass="tooltip-overflow">
            {{ userStory.goalShortName}}
          </span>
        </span>
        <div *ngFor="let tag of userStoryInputTags">
          <span class="custom-userstory-tag" matTooltip="{{ tag }}" matTooltipClass="tooltip-overflow">
            {{tag}}
          </span>
        </div>
      </span>
    </div>

    <div fxFlex="4" class="m-0 mr-05 mt-03 userstory-timeline-show hide-content-overflow"
      matTooltip="{{'USERSTORY.SUBTASKS'|translate}}" *ngIf="userStory.subUserStories && isEditFromProjects"
      [ngClass]="{'display-timeline':isDeadlinedispaly}">
      ({{userStory.subUserStoriesList?.length}})
    </div>

    <!-- <span fxFlex class=" mr-1" *ngIf="isActiveGoalsPage && (CanAccess_Company_IsStartEnabled$ | async)">
      <button mat-icon-button type="button" style="margin-top:-9.5px; height: 31px;">
        <mat-progress-bar color="primary" mode="indeterminate" *ngIf="currentUserStory">
        </mat-progress-bar>
        <fa-icon *ngIf="!currentUserStory && (userStory.autoLog == true || userStory.autoLog == 1 )" icon="play"
          matTooltip="play" [ngStyle]="{ 'color': 'green' }" (click)="$event.stopPropagation();LogAction(userStory)">
        </fa-icon>
        <fa-icon *ngIf="!currentUserStory && (userStory.autoLog == false || userStory.autoLog == 0)" icon="pause"
          matTooltip="pause" [ngStyle]="{ 'color' : 'red' }" (click)="$event.stopPropagation();LogAction(userStory)">
        </fa-icon>
      </button>
    </span> -->

    <mat-icon class="more_vert card-control" matTooltip="{{ 'MENU' | translate }}" [matMenuTriggerFor]="EditUserStory"
      (click)="$event.stopPropagation();" [style.left]="contextMenuPosition.x" [style.top]="contextMenuPosition.y">
    </mat-icon>

    <div class="userstory-timeline-show mt-02" fxFlex="36px" (click)="$event.stopPropagation()"
      *ngIf="userStory?.isEnableBugBoards" [ngClass]="{'display-timeline':isDeadlinedispaly}">
      <a *ngIf="userStory.bugsCount > 0" matTooltip="{{'TESTMANAGEMENT.BUGSCOUNT' | translate}}"
        [satPopoverAnchorFor]="userStoryBugs" #userStoryBugsPopover="satPopoverAnchor"
        (click)="$event.stopPropagation();openBugsPopover(userStoryBugsPopover,userStory)">
        <fa-icon icon="bug"></fa-icon>
      </a>
      <span *ngIf="userStory.bugsCount > 0"
        class="testsuite-sections-count scenario-bugs-place scenario-bugs-count-padding">
        {{userStory.bugsCount}}
      </span>
    </div>

    <!-- <div  fxFlex="36px">
      <fa-icon icon="tasks" matTooltip="{{ userStory.userStoryTypeName }}" [ngStyle]="{ 'color': userStory.userStoryTypeColor }"></fa-icon>
    </div> -->

    <app-avatar *ngIf="userStory.dependencyUserId"
      matTooltip="{{ 'USERSTORY.DEPENDENCYON' | translate }} {{ userStory.dependencyName }}" class="mr-05 mt-2p"
      [name]="userStory.dependencyName | removeSpecialCharacters"
      [src]="userStory.dependencyProfileImage | fetchSizedAndCachedImage: '20':''" [isRound]="true" size="20">
    </app-avatar>

    <app-avatar *ngIf="userStory.bugCausedUserId"
      matTooltip="{{ 'USERSTORY.CAUSEDBY' | translate }} {{ userStory.bugCausedUserName }}" class="mr-05 mt-2p"
      [name]="userStory.bugCausedUserName | removeSpecialCharacters"
      [src]="userStory.bugCausedUserProfileImage | fetchSizedAndCachedImage: '20':''" [isRound]="true" size="20">
    </app-avatar>


    <app-avatar matTooltip="{{ 'USERSTORY.ASSIGNEDTO' | translate }} {{ userStory.ownerName }}" class="mt-2p mr-05"
      [name]="userStory.ownerName | removeSpecialCharacters" *ngIf="userStory.ownerUserId"
      [src]="userStory.ownerProfileImage | fetchSizedAndCachedImage: '20':''" [isRound]="true" size="20"
      [satPopoverAnchorFor]="inLineEditUserStoryPopover"
      (click)="$event.stopPropagation();saveAssignee(inLineEditUserStoryPopup)"
      #inLineEditUserStoryPopup="satPopoverAnchor">
    </app-avatar>

    <app-avatar matTooltip="Owner" [name]="profileImage| removeSpecialCharacters" *ngIf="!userStory.ownerUserId"
      class="mr-05" [src]='defaultProfileImage' [isRound]="true" size="20"
      [satPopoverAnchorFor]="inLineEditUserStoryPopover"
      (click)="$event.stopPropagation();saveAssignee(inLineEditUserStoryPopup)"
      #inLineEditUserStoryPopup="satPopoverAnchor">
    </app-avatar>

    <div [fxFlex]="isSubTasksPage ? '15' : '10'" class="m-0 mr-05 mt-2p" *ngIf="userStory.userStoryUniqueName"
      fxShow.lt-lg="false" fxShow.gt-md="true">
      <a matTooltip="{{ userStory.userStoryUniqueName }}" class="hide-content-overflow"
        (click)="$event.stopPropagation();navigateToUserStoriesPage()">
        <span [ngClass]="applyClassForUniqueName(userStory.userStoryTypeColor)"
          [ngStyle]="{ 'background-color': userStory.userStoryTypeColor ? userStory.userStoryTypeColor : ''}">{{userStory.userStoryUniqueName}}</span>
      </a>
    </div>

    
    <!-- <div fxFlex="4" class="mt-03 userstory-timeline-show show-estimations"  matTooltip="{{ 'ACTIVITYTRACKER.SCREENSHOTS' | translate}}" style="margin-right: 10px;" [ngClass]="{'display-timeline':isDeadlinedispaly}" *ngIf="canAccess_feature_ViewActivityScreenshots" (click)="$event.stopPropagation();openScreenShotsDialog()">
      <i class="material-icons mat-color-accent" style="cursor: pointer;">photo</i>
    </div> -->

    <div fxFlex="10px" [ngClass]=" isSubTasksPage ? 'mt-02': 'mr-1'" (click)="$event.stopPropagation()"
      style="margin-top: 5px;"
      *ngIf="isActiveGoalsPage && !archivedGoalUserStory && !ParkedGoalUserStory &&  (userStory.isEnableStartStop) &&  !userStory.userStoryArchivedDateTime && !userStory.userStoryParkedDateTime">
      <mat-progress-bar color="primary" mode="indeterminate" *ngIf="currentUserStory || _isLoading">
      </mat-progress-bar>
      <fa-icon *ngIf="!currentUserStory && (userStory.autoLog == true || userStory.autoLog == 1 )" icon="play"
        matTooltip="{{ 'USERSTORY.STARTWORK' | translate }}" [ngStyle]="{ 'color': 'green' }"
        (click)="$event.stopPropagation();LogAction(userStory)">
      </fa-icon>
      <fa-icon *ngIf="!currentUserStory && (userStory.autoLog == false || userStory.autoLog == 0)" icon="pause"
        matTooltip="{{ 'USERSTORY.PAUSEWORK' | translate }}" [ngStyle]="{ 'color' : 'red' }"
        (click)="$event.stopPropagation();LogAction(userStory)">
      </fa-icon>
    </div>


    <!-- estimated time & deadline time display in mobile responsive starts-->
    <div fxFlex="12" fxShow.xs="true" fxShow.gt-md="false" class="m-0 mr-05 mt-03 "
      *ngIf="userStory.userStoryUniqueName">
      <a matTooltip="{{ userStory.userStoryUniqueName }}"
        class="userstory-unique unique-numbers-hover hide-content-overflow"
        (click)="$event.stopPropagation();navigateToUserStoriesPage()">
        <span [ngClass]="applyClassForUniqueName(userStory.userStoryTypeColor)"
          [ngStyle]="{ 'background-color': userStory.userStoryTypeColor ? userStory.userStoryTypeColor : ''}">{{userStory.userStoryUniqueName}}</span>
      </a>
    </div>

    <!-- <div fxFlex="4" fxShow.xs="true" fxShow.gt-md="false" style="margin-right: 10px;"  matTooltip="{{ 'ACTIVITYTRACKER.TRACKERSCREENSHOTS' | translate}}" *ngIf="canAccess_feature_ViewActivityScreenshots" class="mt-03" (click)="$event.stopPropagation();openScreenShotsDialog()">
      <i class="material-icons mat-color-accent" style="cursor: pointer;">photo</i>
    </div> -->

    <div class="deadline-overflow" fxFlex="7" fxFlex.md="8" fxFlex.sm="8" fxShow="true" fxShow.gt-md="false"
      fxFlex.xs="36px" *ngIf="!isSprintUserStories && !isSubTasksPage">
      <h6 class="m-0 mr-03 allgoals_txt deadline-date" *ngIf="userStory.deadLineDate">

        <input matInput [value]="userStory.deadLineDate|deadLineDateToIconFilter :userStory.isDateTimeConfiguration"
          #deadLineDate hidden />

        <span *ngIf="deadLineDate.value == 'arrow-right'">
          <fa-icon icon="arrow-right" class="mr-05"></fa-icon>
        </span>
        <span *ngIf="deadLineDate.value == 'arrow-left'">
          <fa-icon icon="arrow-left" class="mr-05 absDaysCount"></fa-icon>
        </span>
        <span [matTooltip]="configureDeadlineDateDisplay(userStory.deadLineDate,userStory.isDateTimeConfiguration)"
          class="hide-content-overflow" [satPopoverAnchorFor]="inLineEditUserStoryPopover"
          #inLineEditUserStoryPopup="satPopoverAnchor"
          (click)="$event.stopPropagation();saveDeadlineDate(inLineEditUserStoryPopup,accessForUserstoryEdit.value)">{{userStory.deadLineDate | deadLineDateFilter:userStory.isDateTimeConfiguration}}</span>
      </h6>
      <div class="mt-03" *ngIf="!userStory.deadLineDate && !isSubTasksPage">
        <fa-icon class="m-0 mr-05 allgoals_txt" icon="minus"
          matTooltip="{{ 'USERSTORY.DEADLINEDATE' | translate | softLabelsPipe : softLabels}}"
          [satPopoverAnchorFor]="inLineEditUserStoryPopover"
          (click)="$event.stopPropagation();saveDeadlineDate(inLineEditUserStoryPopup,accessForUserstoryEdit.value)"
          #inLineEditUserStoryPopup="satPopoverAnchor"></fa-icon>
      </div>
    </div>

    <div fxFlex="18" fxFlex.sm="12" fxShow.xs="true" fxShow.gt-md="false" fxFlex.xs="90px" fxLayout="row wrap"
      class="mt-02 estimate-class" *ngIf="notFromAudits  && !isSubTasksPage">
      <div>
        <h6 class="m-0 mr-0 allgoals_txt hide-content-overflow estimation-time" *ngIf="userStory.estimatedTime"
        [satPopoverAnchorFor]="inLineEditUserStoryPopover"
        (click)="$event.stopPropagation();saveEstimatedTime(inLineEditUserStoryPopup,accessForUserstoryEdit.value)"
        #inLineEditUserStoryPopup="satPopoverAnchor">
        <span class="userstory-badge-item ml-05">
          {{userStory.estimatedTime | timefilter}}
        </span>
      </h6>
      <span class="m-0 ml-05 mr-05 allgoals_txt text-center hide-content-overflow sub-task-estimation-time"
        *ngIf="userStory.totalEstimatedTime && userStory.estimatedTime">
        <span class="userstory-badge-item ml-05">
          ({{userStory.totalEstimatedTime | timefilter}})
        </span>
      </span>
      </div>
      <div class="ml-1 mt-03" *ngIf="!userStory.estimatedTime && !isSubTasksPage && userStory.userStoryUniqueName != 'Document'" style="display: inline-flex !important">
        <fa-icon class="allgoals_txt" icon="minus" [matTooltip]="estimatedTime | timefilter"
          [satPopoverAnchorFor]="inLineEditUserStoryPopover" #inLineEditUserStoryPopup="satPopoverAnchor"
          (click)="$event.stopPropagation();saveEstimatedTime(inLineEditUserStoryPopup,accessForUserstoryEdit.value)">
        </fa-icon>
        <span class="m-0 ml-05 mr-05 allgoals_txt text-center hide-content-overflow sub-task-estimation-time"
          *ngIf="userStory.totalEstimatedTime">
          <span class="userstory-badge-item ml-05">
            ({{userStory.totalEstimatedTime | timefilter}})
          </span>
        </span>
      </div>
    </div>

    <div fxFlex="18"  fxFlex.sm="12" fxShow.xs="true" fxShow.gt-md="false" fxShow.gt-md="false"
      fxFlex.xs="36px" *ngIf="isSprintUserStories && !isSubTasksPage" fxLayout="row wrap" class="mt-02 estimate-class">
      <div>
        <h6 class="m-0 mr-0 allgoals_txt hide-content-overflow estimation-time" *ngIf="userStory.sprintEstimatedTime"
        [satPopoverAnchorFor]="inLineEditUserStoryPopover"
        (click)="$event.stopPropagation();saveSprintEstimatedTime(inLineEditUserStoryPopup,accessForUserstoryEdit.value)"
        #inLineEditUserStoryPopup="satPopoverAnchor">
        <span class="userstory-badge-item ml-05" style="padding: 3px 3px !important">
          {{userStory.sprintEstimatedTime}} SP
        </span>
      </h6>
      <span class="m-0 ml-05 mr-05 allgoals_txt text-center hide-content-overflow sub-task-estimation-time"
        *ngIf="userStory.totalSprintEstimatedTime && userStory.sprintEstimatedTime">
        <span class="userstory-badge-item ml-05" style="padding: 3px 1px !important">
          ({{userStory.totalSprintEstimatedTime}}SP) 
        </span>
      </span>
      </div>
      <div class="ml-1 mt-03" *ngIf="!userStory.sprintEstimatedTime && !isSubTasksPage && isSprintUserStories" style="display: inline-flex !important">
        <fa-icon class="ml-05 allgoals_txt" icon="minus"
          matTooltip="{{ 'GOALS.ESTIMATEDTIMEINSP' | translate | softLabelsPipe : softLabels}}"
          [satPopoverAnchorFor]="inLineEditUserStoryPopover" #inLineEditUserStoryPopup="satPopoverAnchor"
          (click)="$event.stopPropagation();saveSprintEstimatedTime(inLineEditUserStoryPopup,accessForUserstoryEdit.value)">
        </fa-icon>
        <span class="m-0 ml-05 mr-05 allgoals_txt text-center hide-content-overflow sub-task-estimation-time"
          *ngIf="userStory.totalSprintEstimatedTime">
          <span class="userstory-badge-item ml-05" style="padding: 3px 1px !important">
            ({{userStory.totalSprintEstimatedTime}}SP)
          </span>
        </span>
      </div>
    </div>
    <!--estimated time & deadline time display in mobile responsive ends-->

    <div fxFlex="8" class="userstory-timeline-show deadline-overflow show-estimations"
      *ngIf="userStory.deadLineDate && !isSprintUserStories && !isSubTasksPage"
      [ngClass]="{'display-timeline':isDeadlinedispaly}">
      <h6 class="m-0 mr-03 allgoals_txt deadline-date">

        <input matInput [value]="userStory.deadLineDate|deadLineDateToIconFilter:userStory.isDateTimeConfiguration"
          #deadLineDate hidden />

        <span *ngIf="deadLineDate.value == 'arrow-right'">
          <fa-icon icon="arrow-right" class="mr-05"></fa-icon>
        </span>
        <span *ngIf="deadLineDate.value == 'arrow-left'">
          <fa-icon icon="arrow-left" class="mr-05 absDaysCount"></fa-icon>
        </span>
        <span [innerHTML]="userStory.deadLineDate | deadLineDateFilter:userStory.isDateTimeConfiguration"
          [matTooltip]="configureDeadlineDateDisplay(userStory.deadLineDate,userStory.isDateTimeConfiguration)"
          [satPopoverAnchorFor]="inLineEditUserStoryPopover" #inLineEditUserStoryPopup="satPopoverAnchor"
          (click)="$event.stopPropagation();saveDeadlineDate(inLineEditUserStoryPopup,accessForUserstoryEdit.value)"></span>
      </h6>
    </div>

    <div fxFlex="8" class="userstory-timeline-show mt-02 show-estimations"
      *ngIf="!userStory.deadLineDate && !isSprintUserStories && !isSubTasksPage"
      [ngClass]="{'display-timeline':isDeadlinedispaly}">
      <div class="mt-03">
        <fa-icon class="ml-05 m-0 mr-05 allgoals_txt" icon="minus"
          matTooltip="{{ 'USERSTORY.DEADLINEDATE' | translate | softLabelsPipe : softLabels}}"
          [satPopoverAnchorFor]="inLineEditUserStoryPopover"
          (click)="$event.stopPropagation();saveDeadlineDate(inLineEditUserStoryPopup,accessForUserstoryEdit.value)"
          #inLineEditUserStoryPopup="satPopoverAnchor"></fa-icon>
      </div>
    </div>

    <div fxFlex="16.5" class="userstory-timeline-show mt-02 show-estimations"
      *ngIf="(userStory.estimatedTime) && notFromAudits && !isSubTasksPage"
      [ngClass]="{'display-timeline':isDeadlinedispaly}">
      <span class="m-0 mr-0 allgoals_txt text-center" [satPopoverAnchorFor]="inLineEditUserStoryPopover"
        (click)="$event.stopPropagation();saveEstimatedTime(inLineEditUserStoryPopup,accessForUserstoryEdit.value)"
        #inLineEditUserStoryPopup="satPopoverAnchor">
        <span class="userstory-badge-item ml-05">
          {{userStory.estimatedTime | timefilter}}
        </span>
      </span>
      <span class="m-0 ml-05 mr-05 allgoals_txt text-center" *ngIf="userStory.totalEstimatedTime">
        <span class="userstory-badge-item ml-05">
          ({{userStory.totalEstimatedTime | timefilter}})
        </span>
      </span>
    </div>

    <div fxFlex="16.5" class="userstory-timeline-show show-estimations mt-02"
      *ngIf="!userStory.estimatedTime && notFromAudits && !isSubTasksPage"
      [ngClass]="{'display-timeline':isDeadlinedispaly}">
      <div class="mt-03">
        <fa-icon class="ml-05 allgoals_txt text-center" icon="minus" *ngIf="userStory.userStoryUniqueName != 'Document'"
          matTooltip="{{ 'USERSTORY.ESTIMATEDTIME' | translate | softLabelsPipe : softLabels}}"
          [satPopoverAnchorFor]="inLineEditUserStoryPopover" #inLineEditUserStoryPopup="satPopoverAnchor"
          (click)="$event.stopPropagation();saveEstimatedTime(inLineEditUserStoryPopup,accessForUserstoryEdit.value)">
        </fa-icon>
        <span class="m-0 ml-05 mr-05 allgoals_txt text-center userstory-badge-item ml-05"
          *ngIf="userStory.totalEstimatedTime">
          ({{userStory.totalEstimatedTime | timefilter}})
        </span>
      </div>
    </div>

    <div fxFlex="15.5" class="userstory-timeline-show show-estimations mt-02"
      *ngIf="(userStory.sprintEstimatedTime) && isSprintUserStories && !isSubTasksPage"
      [ngClass]="{'display-timeline':isDeadlinedispaly}">
      <span class="m-0 mr-0 allgoals_txt text-center" [satPopoverAnchorFor]="inLineEditUserStoryPopover"
        (click)="$event.stopPropagation();saveSprintEstimatedTime(inLineEditUserStoryPopup,accessForUserstoryEdit.value)"
        #inLineEditUserStoryPopup="satPopoverAnchor">
        <span class="userstory-badge-item ml-05" style="padding: 3px 3px !important">
          {{userStory.sprintEstimatedTime}} SP
        </span>
      </span>
      <span class="m-0 ml-05 mr-05 allgoals_txt text-center" *ngIf="userStory.totalSprintEstimatedTime">
        <span class="userstory-badge-item ml-05" style="padding: 3px 3px !important">
          ({{userStory.totalSprintEstimatedTime}}SP)
        </span>
      </span>
    </div>

    <div fxFlex="15.5" class="userstory-timeline-show mt-02 show-estimations"
      *ngIf="!userStory.sprintEstimatedTime && isSprintUserStories && !isSubTasksPage"
      [ngClass]="{'display-timeline':isDeadlinedispaly}">
      <div class="mt-03" style="display: inline-flex !important;">
        <fa-icon class="ml-05 allgoals_txt text-center" icon="minus"
          matTooltip="{{ 'GOALS.ESTIMATEDTIMEINSP' | translate | softLabelsPipe : softLabels}}"
          [satPopoverAnchorFor]="inLineEditUserStoryPopover" #inLineEditUserStoryPopup="satPopoverAnchor"
          (click)="$event.stopPropagation();saveSprintEstimatedTime(inLineEditUserStoryPopup,accessForUserstoryEdit.value)">
        </fa-icon>
        <span class="m-0 ml-05 mr-05 allgoals_txt text-center userstory-badge-item ml-05"
          *ngIf="userStory.totalSprintEstimatedTime" style="padding: 3px 3px !important">
          ({{userStory.totalSprintEstimatedTime}}SP)
        </span>
      </div>
    </div>

    <mat-chip *ngIf="userStory.transitionDateTime" fxFlex="15" fxFlex.gt-md="140px"
      [satPopoverAnchorFor]="inLineEditUserStoryPopover" #inLineEditUserStoryPopup="satPopoverAnchor"
      (click)="$event.stopPropagation();saveUserStoryStatus(inLineEditUserStoryPopup,null)"
      class="ml-05 mr-2 allgoals_process userstory_status text-center goal-cursor userstory_color mt-03" mat-sm-chip
      [style.backgroundColor]="userStory.userStoryStatusColor">
      {{ userStory.userStoryStatusName | titlecase }}
    </mat-chip>
    <mat-chip *ngIf="!userStory.transitionDateTime" fxFlex="15" fxFlex.gt-md="140px"
      [satPopoverAnchorFor]="inLineEditUserStoryPopover" #inLineEditUserStoryPopup="satPopoverAnchor"
      (click)="$event.stopPropagation();saveUserStoryStatus(inLineEditUserStoryPopup,null)"
      class="ml-05 mr-2 allgoals_process text-center goal-cursor userstory_color mt-03" mat-sm-chip
      [style.backgroundColor]="userStory.userStoryStatusColor" matTooltip="{{userStory.userStoryStatusName}} ">
      {{ userStory.userStoryStatusName | titlecase}}
    </mat-chip>

    <mat-menu class="goal-options" #EditUserStory="matMenu" (click)="$event.stopPropagation()">

      <div
        *ngIf="!archivedGoalUserStory && userStory.userStoryUniqueName != 'Document' && !userStory.userStoryArchivedDateTime && ((isAllGoalsPage && isPermissionForParkUserStory) || (!isAllGoalsPage && canAccess_entityType_feature_ParkWorkItem)) && isUserStoriesPage && notFromAudits">

        <button mat-menu-item class="allgoals_icons" [satPopoverAnchorFor]="parkUserstoryPopover"
          *ngIf="showIcons && isParked"
          (click)="parkUserstoryPopover.open(); $event.stopPropagation();openParkUserStory()">
          <mat-icon>local_parking</mat-icon>
          <span>{{ 'USERSTORY.PARKUSERSTORY' | translate | softLabelsPipe : softLabels}}</span>
        </button>

        <button mat-menu-item class="allgoals_icons" *ngIf=" showIcons && !isParked"
          [satPopoverAnchorFor]="parkUserstoryPopover"
          (click)="parkUserstoryPopover.open(); $event.stopPropagation();openParkUserStory()">
          <mat-icon>local_parking</mat-icon>
          <span>{{ 'USERSTORY.RESUMEUSERSTORY' | translate | softLabelsPipe : softLabels}} </span>
        </button>
      </div>

      <div
        *ngIf="!isArchivedGoal && userStory.userStoryUniqueName != 'Document' && !userStory.userStoryParkedDateTime  && ((!notFromAudits && canAccess_entityType_feature_ArchiveAction) || (isAllGoalsPage && isPermissionForArchiveUserStory)|| (!isAllGoalsPage && canAccess_entityType_feature_ArchiveWorkItem)) && isUserStoriesPage">
        <button mat-menu-item class="allgoals_icons" [satPopoverAnchorFor]="archiveUserstoryPopover"
          #archivePopOver="satPopoverAnchor" *ngIf="showIcons && isArchived"
          (click)="archiveUserstoryPopover.open(); $event.stopPropagation();openArchiveUserStory();">
          <mat-icon>archive</mat-icon> {{ 'USERSTORY.ARCHIVEUSERSTORY' | translate | softLabelsPipe : softLabels}}
        </button>
        <button mat-menu-item class="allgoals_icons" [satPopoverAnchorFor]="archiveUserstoryPopover"
          *ngIf="showIcons && !isArchived"
          (click)="archiveUserstoryPopover.open(); $event.stopPropagation();openArchiveUserStory();">
          <mat-icon>archive</mat-icon> {{ 'USERSTORY.UNARCHIVEUSERSTORY' | translate | softLabelsPipe : softLabels}}
        </button>
      </div>
      <div
        *ngIf="!archivedGoalUserStory && userStory.userStoryUniqueName != 'Document' && !ParkedGoalUserStory && !replanGoalUserStory && !userStory.userStoryArchivedDateTime && !userStory.userStoryParkedDateTime && notFromAudits">
        <button mat-menu-item class="allgoals_icons" (click)="copyLink(); $event.stopPropagation()">
          <mat-icon>file_copy</mat-icon>{{'USERSTORY.CLICKHERETOCOPYLINK' | translate}}
        </button>
      </div>
      <div
        *ngIf="!archivedGoalUserStory && userStory.userStoryUniqueName != 'Document' && !ParkedGoalUserStory && !replanGoalUserStory  && !userStory.userStoryArchivedDateTime && !userStory.userStoryParkedDateTime && notFromAudits">
        <button mat-menu-item class="allgoals_icons" (click)="openInNewTab(); $event.stopPropagation()">
          <mat-icon>web_asset</mat-icon>{{'USERSTORY.CLICKHERETOOPENINNEWTAB' | translate}}
        </button>
      </div>
      <button mat-menu-item class="allgoals_icons" [satPopoverAnchorFor]="userstoryTagsPopover"
        *ngIf="!archivedGoalUserStory && !ParkedGoalUserStory && !isSubTasksPage && !userStory.userStoryArchivedDateTime && !userStory.userStoryParkedDateTime"
        (click)="userstoryTagsPopover.open(); $event.stopPropagation();openTagsPopUp()">
        <mat-icon>local_offer</mat-icon><span>{{ 'USERSTORY.TAGS' | translate }} </span>
      </button>

    </mat-menu>


    <!-- archive userstory popover start -->
    <sat-popover #archiveUserstoryPopover verticalAlign="below" hasBackdrop horizontalAlign="start"
      backdropClass="backdrop-color">
      <mat-card class="filter-data p-0">
        <mat-card-title class="text-center">
          <div *ngIf="userStory.userStoryArchivedDateTime">
            <div class="card-title-text mat-bg-primary p-05">
              {{ 'USERSTORY.UNARCHIVEUSERSTORY' | translate | softLabelsPipe : softLabels}}</div>
          </div>
          <div *ngIf="!userStory.userStoryArchivedDateTime">
            <div class="card-title-text mat-bg-primary p-05">
              {{ 'USERSTORY.ARCHIVEUSERSTORY' | translate | softLabelsPipe : softLabels}}</div>
          </div>
        </mat-card-title>
        <p class="p-05 m-0" *ngIf="userStory.userStoryArchivedDateTime">
          {{ 'USERSTORY.AREYOUSUREWANTTOUNARCHIVETHISWORKITEM' | translate | softLabelsPipe : softLabels  }} </p>
        <p class="p-05 m-0" *ngIf="!userStory.userStoryArchivedDateTime">
          {{ 'USERSTORY.AREYOUSUREWANTTOARCHIVETHISWORKITEM' | translate | softLabelsPipe : softLabels  }}</p>
        <app-pm-component-archive-userStory *ngIf="isArchiveUserStory" [userStory]="archiveStory"
          [userstoryUniquePage]=false [isSprintUserStories]="isSprintUserStories" [isSubTaskPage]="isSubTasksPage"
          [isAllGoalsPage]="isAllGoalsPage" [isEditFromProjects]="isEditFromProjects"
          (closePopup)="closeArchivePopUp($event);archiveUserstoryPopover.close()">
        </app-pm-component-archive-userStory>
      </mat-card>
    </sat-popover>
    <!-- archive userstory popover end -->

    <!-- park user story popover start -->
    <sat-popover #parkUserstoryPopover verticalAlign="below" hasBackdrop horizontalAlign="start"
      backdropClass="backdrop-color">
      <mat-card class="filter-data p-0">
        <mat-card-title class="text-center">
          <div *ngIf="userStory.userStoryParkedDateTime">
            <div class="card-title-text mat-bg-primary p-05">
              {{ 'USERSTORY.RESUMEUSERSTORY' | translate | softLabelsPipe : softLabels}}
            </div>
          </div>
          <div *ngIf="!userStory.userStoryParkedDateTime">
            <div class="card-title-text mat-bg-primary p-05">
              {{ 'USERSTORY.PARKUSERSTORY' | translate | softLabelsPipe : softLabels}}
            </div>
          </div>
        </mat-card-title>
        <p class="p-05 m-0" *ngIf="userStory.userStoryParkedDateTime">
          {{ 'USERSTORY.AREYOUSUREWANTTORESUMETHISWORKITEM' | translate | softLabelsPipe : softLabels  }} </p>
        <p class="p-05 m-0" *ngIf="!userStory.userStoryParkedDateTime">
          {{ 'USERSTORY.AREYOUSUREWANTTOPARKTHISWORKITEM' | translate | softLabelsPipe : softLabels  }}</p>
        <app-pm-component-park-userStory *ngIf="isParkUserStory" [userStory]="parkUserStory" [userstoryUniquePage]=false
          [isAllGoalsPage]="isAllGoalsPage" [isSprintUserStories]="isSprintUserStories" [isSubTaskPage]="isSubTasksPage"
          [isEditFromProjects]="isEditFromProjects" (closePopup)="closeParkPopUp($event);parkUserstoryPopover.close();">
        </app-pm-component-park-userStory>
      </mat-card>
    </sat-popover>

    <sat-popover #inLineEditUserStoryPopover verticalAlign="below" [autoFocus]="false" [interactiveClose]="false"
      hasBackdrop horizontalAlign="start" backdropClass="backdrop-color">

      <mat-card class="filter-data p-0">
        <mat-progress-bar color="primary" mode="indeterminate"
          *ngIf="(anyOperationInProgress$|async) ||  (workItemInProgress)">
        </mat-progress-bar>
        <div>
          <button class="inline_edit_close btn" color="warn" (click)="closeUserStoryDialogWindow()">
            <fa-icon icon="times"></fa-icon>
          </button>
          <mat-card-title class="text-center">
            <div class="card-title-text p-1 mat-bg-primary">
              {{titleText | softLabelsPipe : softLabels}}
            </div>
          </mat-card-title>

          <app-inline-editing-userstory-component
            *ngIf="isInlineEdit || isInlineEditForEstimatedTime || isInlineEditForUserStoryStatus || isInlineEditForUserStoryOwner || isInlineEditForSprintEstimatedTime"
            [isSprintsView]="isSprintUserStories" [userStory]="inLineUserStory" [isInlineEditForEstimatedTime]="isInlineEditForEstimatedTime"
            [isFromBugsCount]="isFromBugsCount" [isInlineEditForUserStoryOwner]="isInlineEditForUserStoryOwner"
            [isInlineEdit]="isInlineEdit" [isInlineEditForUserStoryStatus]="isInlineEditForUserStoryStatus"
            [isInlineEditForSprintEstimatedTime]="isInlineEditForSprintEstimatedTime" [goalReplanId]="goalReplanId"
            [isAllGoalsPage]="isAllGoalsPage" [isEditFromProjects]="isEditFromProjects" [isBugsTab]=false
             (completeUserStory)="getStableState($event)"
            (workItemsLoader)="getWorkItemsLoader($event)" (stopLoader)="getStopLoader($event)"
            (closeUserStoryDialog)="closeUserStoryDialog()">
          </app-inline-editing-userstory-component>
        </div>
      </mat-card>
    </sat-popover>

    <!--Add tags popover-->
    <sat-popover #userstoryTagsPopover verticalAlign="below" [autoFocus]="false" [interactiveClose]="false" hasBackdrop
      horizontalAlign="start" backdropClass="backdrop-color">

      <mat-card class="filter-data p-0">
        <mat-progress-bar color="primary" mode="indeterminate" *ngIf="(anyOperationInProgress$ | async)">
        </mat-progress-bar>
        <div>
          <button class="inline_edit_close btn" color="warn" (click)="closeTagsDialog()">
            <fa-icon icon="times"></fa-icon>
          </button>
          <mat-card-title class="text-center">
            <div class="card-title-text p-1 mat-bg-primary">
              {{'USERSTORY.ADDTAGS' | translate}}
            </div>
          </mat-card-title>
          <app-pm-component-tags *ngIf="isTagsPopUp && userStory.userStoryUniqueName != 'Document'" [userStoryId]="userStory.userStoryId" [goalId]=null
            [isAllGoalsPage]="isAllGoalsPage" [parentUserStoryId]="userStory.parentUserStoryId"
            [isSprintUserStories]="isSprintUserStories" [isReview]=null
            [reviewDetails]=null
            (closeTagsPopUp)="closeTagsDialog();userstoryTagsPopover.close()"></app-pm-component-tags>
            <app-pm-component-tags *ngIf="isTagsPopUp && userStory.userStoryUniqueName == 'Document'" [userStoryId]=null [goalId]=null
            [isAllGoalsPage]="isAllGoalsPage" [parentUserStoryId]="userStory.parentUserStoryId"
            [isSprintUserStories]="isSprintUserStories" [isReview]="userStory.userStoryUniqueName"
            [reviewDetails]="userStory" (closeTagsPopUp)="userstoryTagsPopover.close()"
            (emitUserStoryTags)="getTags($event);userstoryTagsPopover.close()"></app-pm-component-tags>
        </div>
      </mat-card>
    </sat-popover>

    <!-- park user story popover end -->
  </div>
  <!-- <mat-icon class="more_vert card-control" matTooltip="{{ 'MENU' | translate }}" [matMenuTriggerFor]="EditUserStory"
    *ngIf="( ((isAllGoalsPage && isPermissionForParkUserStory) || (!isAllGoalsPage && canAccess_entityType_feature_ParkWorkItem))) ||
 (((isAllGoalsPage && isPermissionForArchiveUserStory)|| (!isAllGoalsPage && canAccess_entityType_feature_ArchiveWorkItem)))
 && isUserStoriesPage" (click)="$event.stopPropagation();" [style.left]="contextMenuPosition.x"
    [style.top]="contextMenuPosition.y">
  </mat-icon> -->
</div>

<!-- Scenario bugs dialog -->
<sat-popover backdropClass="backdrop-color" #userStoryBugs hasBackdrop [interactiveClose]="false"
 [verticalAlign] ="setAlignmentForpopUp()" horizontalAlign="start">
  <mat-card class="filter-data card-filter-runs p-0">
    <button class="inline_edit_close btn" color="warn" (click)="closeBugPopover()">
      <fa-icon icon="times"></fa-icon>
    </button>
    <mat-card-title class="text-center">
      <div class="card-title-text mat-bg-primary p-05 mb-1">
        {{'USERDETAIL.BUGS' | translate}}
      </div>
    </mat-card-title>
    <mat-card-content class="goal-bugs" id="style-1" style="width: 650px !important;">
      <userstory-bugs *ngIf="isLoadBugs" [userStoryData]="userStoryModel" [isSprintUserStories]="isSprintUserStories"
        [isDetailPage]=false [isInline]=true>
      </userstory-bugs>
    </mat-card-content>
  </mat-card>
</sat-popover>
<!-- Scenario bugs dialog -->

<ng-template #screenShotComponent let-data>
  <app-ts-component-trackerscreenshots [data]=[data]></app-ts-component-trackerscreenshots>
</ng-template>