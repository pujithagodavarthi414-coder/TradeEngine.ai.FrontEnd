<div class="scrollBar bg-color">
  <div fxLayout="row wrap" style="margin-top: 10px;" fxLayout.md="column" fxLayout.sm="column">
    <div fxLayout="row nowrap" fxFlex="25" fxLayoutAlign="left center" fxLayoutAlign.md="center center"
      fxLayoutAlign.sm="center center">
      <div *ngIf="!isMyProductivityDashboard && (!lineManagerId || !userId || !branchId)" style="width: 10px;"></div>
      <div fxLayout="row nowrap" *ngIf="isMyProductivityDashboard">
        <div style="margin-left: 7px;margin-top: 2px;">
          <p *ngIf="userProfileImage != null && userProfileImage != ''">
            <app-avatar [src]="userProfileImage" [isRound]="true" size="34">
            </app-avatar>
          </p>
          <p *ngIf="userProfileImage == null || userProfileImage == ''">
            <app-avatar [name]="username | removeSpecialCharacters" [isRound]="true" size="34">
            </app-avatar>
          </p>
        </div>
        <div style="margin-left: 8px;">
          <h6 style="margin-top: 10px;"><b class="statsHeadings p-0">{{username}}{{'PRODUCTIVITY.SPRODUCTIVITY' |
              translate }}</b></h6>
        </div>
      </div>
      <!-- <mat-chip class="mr-08 pull-right" color="anything" style="height: 32px;" selected
        *ngIf="(isBranchProductivityDashboard || isCompanyProductivityDashboard) && lineManagerId">
        <span matLine><b>{{'PRODUCTIVITY.LINEMANAGER' | translate }}:</b> {{lineManagerName}}</span>
        <fa-icon class="ml-05 mat-color-accent cursor-pointer" icon="times" (click)="removeFilter()"></fa-icon>
      </mat-chip> -->
      <div fxLayout="row nowrap"
        *ngIf="(isBranchProductivityDashboard || isCompanyProductivityDashboard) && lineManagerId"
        (mouseover)="clearEnable = true" (mouseleave)="clearEnable = false">
        <div style="margin-left: 7px;margin-top: 3px;">
          <p *ngIf="lineManagerProfileImage">
            <app-avatar [src]="lineManagerProfileImage" [isRound]="true" size="34">
            </app-avatar>
          </p>
          <p *ngIf="!lineManagerProfileImage">
            <app-avatar [name]="lineManagerName | removeSpecialCharacters" [isRound]="true" size="34">
            </app-avatar>
          </p>
        </div>
        <div style="margin-left: 8px;">
          <h6 style="margin-top: 10px;"><b class="statsHeadings p-0">{{lineManagerName |
              titlecase}}{{'PRODUCTIVITY.STEAMPRODUCTIVITY' |
              translate }}</b></h6>
        </div>
        <fa-icon *ngIf="clearEnable" class="mat-color-accent cursor-pointer"
          style="padding: 12px;margin-left: 0px !important;" icon="times" (click)="removeFilter()"></fa-icon>
      </div>
      <div fxLayout="row nowrap"
        *ngIf="(isTeamProductivityDashboard || isBranchProductivityDashboard || isCompanyProductivityDashboard) && userId"
        (mouseover)="clearEnable = true" (mouseleave)="clearEnable = false">
        <div style="margin-left: 7px;margin-top: 3px;">
          <p *ngIf="userProfile">
            <app-avatar [src]="userProfile" [isRound]="true" size="34">
            </app-avatar>
          </p>
          <p *ngIf="!userProfile">
            <app-avatar [name]="userFiltername | removeSpecialCharacters" [isRound]="true" size="34">
            </app-avatar>
          </p>
        </div>
        <div style="margin-left: 8px;">
          <h6 style="margin-top: 10px;"><b class="statsHeadings p-0">{{userFiltername |
              titlecase}}{{'PRODUCTIVITY.SPRODUCTIVITY' |
              translate }}</b></h6>
        </div>
        <fa-icon *ngIf="clearEnable" class="mat-color-accent cursor-pointer"
          style="padding: 12px;margin-left: 0px !important;" icon="times" (click)="removeFilter()"></fa-icon>
      </div>
      <!-- <mat-chip class="mr-08 pull-right" color="anything" style="height: 32px;" selected
        *ngIf="(isTeamProductivityDashboard || isBranchProductivityDashboard || isCompanyProductivityDashboard) && userId">
        <span matLine><b>{{'PRODUCTIVITY.USER' | translate }}:</b></span>
        <span>
          <span>
            <app-avatar class="employee_img_chip" *ngIf="!userProfile" [name]="userFiltername | removeSpecialCharacters"
              [isRound]="true" size="23">
            </app-avatar>
            <app-avatar class="employee_img_chip" *ngIf="userProfile" [src]="userProfile" [isRound]="true" size="23">
            </app-avatar>
          </span>
          <span> {{userFiltername}}</span>
        </span>
        <fa-icon class="ml-05 mat-color-accent cursor-pointer" icon="times" (click)="removeFilter()"></fa-icon>
      </mat-chip> -->
      <mat-chip class="mr-08 pull-right" color="anything" style="height: 32px;" selected
        *ngIf="(isCompanyProductivityDashboard) && branchId">
        <span matLine><b>{{'PRODUCTIVITY.BRANCH' | translate }}:</b> {{branchName}}</span>
        <fa-icon class="ml-05 mat-color-accent cursor-pointer" icon="times" (click)="removeFilter()"></fa-icon>
      </mat-chip>
    </div>
    <div fxFlex="27" fxLayoutAlign.md="center center" fxLayoutAlign="center center">
      <div fxFlex fxLayout="row wrap" fxLayoutAlign="center center" fxLayoutAlign.xs="center center"
        fxLayoutAlign.sm="end center" *ngIf="day">
        <div class="date-value-margin">
          <input matInput [matDatepicker]="picker1" (dateChange)="onDateChange($event)" [max]="maxDate"
            class="date-picker date-filter-value" style="cursor: pointer" (click)="picker1.open()"
            [(ngModel)]='dateToday' [readonly]="true">
          <mat-datepicker #picker1></mat-datepicker>
        </div>
      </div>
      <div *ngIf="week" fxFlex fxLayoutAlign="center center" style="margin-top: 10px;"
        matTooltip="{{dateFrom | date: 'dd-MMM-yyyy'}}  to  {{dateTo | date: 'dd-MMM-yyyy'}}">
        <span class="date-filter-value">&nbsp;&nbsp;&nbsp;&nbsp;
          {{selectedWeek | date: "MMM - yyyy"}}&nbsp;&nbsp;</span><span *ngIf="weekNumber"
          class="date-filter-value">W{{weekNumber}}&nbsp;&nbsp;&nbsp;&nbsp;</span>
      </div>
      <div *ngIf="month" fxFlex fxLayoutAlign="center center" style="margin-top: 10px;">
        <span class="date-filter-value"
          matTooltip="{{dateFrom | date: 'dd-MMM-yyyy'}}  to  {{dateTo | date: 'dd-MMM-yyyy'}}">&nbsp;&nbsp;&nbsp;&nbsp;{{selectedMonth
          | date:
          "MMMM, yyyy"}}&nbsp;&nbsp;&nbsp;&nbsp;</span>
      </div>
      <div *ngIf="year" fxFlex fxLayoutAlign="center center" style="margin-top: 10px;">
        <span class="date-filter-value"
          matTooltip="{{dateFrom | date: 'dd-MMM-yyyy'}}  to  {{dateTo | date: 'dd-MMM-yyyy'}}">&nbsp;&nbsp;&nbsp;&nbsp;{{selectedYear
          | date:
          "yyyy"}}&nbsp;&nbsp;&nbsp;&nbsp;</span>
      </div>
      <div *ngIf="quarterYear" fxFlex fxLayoutAlign="center center" style="margin-top: 10px;">
        <span class="date-filter-value"
          matTooltip="{{dateFrom | date: 'dd-MMM-yyyy'}}  to  {{dateTo | date: 'dd-MMM-yyyy'}}">&nbsp;&nbsp;&nbsp;&nbsp;
          {{selectedQuarterYear | date: "yyyy"}}&nbsp;&nbsp;<span
            class="date-filter-value">Q{{Quarterno}}&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
      </div>
      <div *ngIf="dateRange" fxLayout fxLayoutAlign="space-between center">
        <div fxFlex="48" fxFlex.sm="50" fxFlex.xs="100">
          <mat-form-field color="primary" class="dateRange">
            <mat-label style="color: rgb(50, 14, 150)">{{ 'PERMISSIONHISTORY.FROMDATE' | translate }}</mat-label>
            <input matInput [matDatepicker]="picker1" (dateChange)="dateFromChanged($event)" [max]="maxDate"
              class="date-picker date-filter-value" (click)="picker1.open()" [(ngModel)]="fromDate" [readonly]="true">
            <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
            <mat-datepicker #picker1></mat-datepicker>
          </mat-form-field>
        </div>
        <div fxFlex="47" fxFlex.sm="40" fxFlex.xs="100">
          <mat-form-field color="primary" class="dateRange">
            <mat-label style="color: rgb(50, 14, 150)">{{ 'PERMISSIONHISTORY.TODATE' | translate }}</mat-label>
            <input matInput [matDatepicker]="picker2" autocomplete="off" [min]="minDate" (click)="picker2.open()"
              (dateChange)="dateToChanged($event)" class="date-picker date-filter-value" [max]="maxDate"
              [(ngModel)]="toDate" [readonly]="true">
            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
            <mat-datepicker #picker2></mat-datepicker>
          </mat-form-field>
        </div>
      </div>
    </div>
    <div fxFlex fxLayout="row wrap" fxLayoutAlign="end center" style="padding-bottom: 4px" fxLayoutAlign.md="center center">
      <button mat-mini-fab color="primary" style="margin-right: 5px;"  matTooltip={{getbackwordToolTip()}}
        *ngIf="!dateRange" (click)="getBackwordValues()">
        <mat-icon style="margin-bottom: 3px;">keyboard_arrow_left</mat-icon>
      </button>
      <button mat-mini-fab  color="primary" style="margin-right: 5px;" matTooltip={{getforwordToolTip()}}
        *ngIf="!dateRange" (click)="getForwordValues()" [disabled]="!dispalyForward">
        <mat-icon style="margin-bottom: 3px;">keyboard_arrow_right</mat-icon>
      </button>
      <div>
        <button mat-raised-button color="{{primaryDay}}" (click)="dayTypeForTimeUsage('day')">{{'ACTIVITYTRACKER.DAY' |
          translate}}</button>
      </div>
      <div>
        <button mat-raised-button color="{{primaryWeek}}" (click)="dayTypeForTimeUsage('week')">{{'ACTIVITYTRACKER.WEEK'
          | translate}}</button>
      </div>
      <div>
        <button mat-raised-button color="{{primaryMonth}}"
          (click)="dayTypeForTimeUsage('month')">{{'ACTIVITYTRACKER.MONTH' | translate}}</button>
      </div>
      <div>
        <button mat-raised-button color="{{primaryQuarter}}" (click)="dayTypeForTimeUsage('quarter')">Quarter</button>
      </div>
      <div>
        <button mat-raised-button color="{{primaryYear}}" (click)="dayTypeForTimeUsage('year')">Year</button>
      </div>
      <div>
        <button mat-raised-button color="{{primaryDateRange}}"
          (click)="dayTypeForTimeUsage('daterange')">{{'ACTIVITYTRACKER.DATERANGE' | translate}}
        </button>
      </div>
      <button type="submit" mat-icon-button (click)="filterClick()" #filterMenuTrigger="matMenuTrigger"
        [matMenuTriggerFor]="filterMenu" *ngIf="!isMyProductivityDashboard">
        <fa-icon icon="filter" class="filter mat-color-accent"
          matTooltip="{{'HRMANAGAMENT.ADVANCESEARCH' | translate}}">
        </fa-icon>
      </button>
    </div>
  </div>

  <loading-component *ngIf="!loadingCompelete"></loading-component>
  <div fxLayout="row wrap" fxLayout.md="column" fxLayout.sm="column">
    <div fxFlex="65" class="p-2" fxFlex.xs>
      <!-- <app-trendinsights-hrstats [filterValues]="productivityfilters"></app-trendinsights-hrstats> -->
      <app-trendinsights-hrstats (loadingComplete)="insightsloadComplete($event)" [loadingCompelete]="loadingCompelete"
        [filterValues]="productivityfilters"></app-trendinsights-hrstats>
    </div>
    <div fxFlex="35" class="p-2" fxFlex.xs>
      <app-productivity-qualitystats (loadingComplete)="statsloadComplete($event)" [loadingCompelete]="loadingCompelete"
        [filterValues]="productivityfilters"></app-productivity-qualitystats>
    </div>
  </div>

  <app-productivity-graph [filterValues]="productivityfilters"></app-productivity-graph>
</div>

<mat-menu #filterMenu="matMenu" class="filter-panel" (click)="$event.stopPropagation()">
  <button mat-menu-item [matMenuTriggerFor]="userFilter"
    *ngIf="isTeamProductivityDashboard || isCompanyProductivityDashboard || isBranchProductivityDashboard">
    {{'PRODUCTIVITY.USER' | translate }}</button>
  <button mat-menu-item [matMenuTriggerFor]="lineManagerFilter"
    *ngIf="isBranchProductivityDashboard || isCompanyProductivityDashboard">
    {{'PRODUCTIVITY.LINEMANAGER' | translate }}</button>
  <button mat-menu-item [matMenuTriggerFor]="branchFilter" *ngIf="isCompanyProductivityDashboard">
    {{'PRODUCTIVITY.BRANCH' | translate }}</button>
</mat-menu>

<mat-menu #lineManagerFilter="matMenu">
  <mat-card class="filter-data" (click)="$event.stopPropagation()">
    <div fxFlex="180px" class="ml-05 mr-05">
      <mat-form-field>
        <mat-select placeholder="Line Manager" [(ngModel)]="lineManagerId"
          (selectionChange)="changeLineManager($event)">
          <mat-option [value]="linemanager.userId" *ngFor="let linemanager of linemanagersList">
            <app-avatar class="employee_img" *ngIf="!linemanager.profileImage"
              [name]="linemanager.userName | removeSpecialCharacters" [isRound]="true" size="30">
            </app-avatar>
            <img class="employee_img" *ngIf="linemanager.profileImage"
              src="{{linemanager.profileImage}}">{{linemanager.userName}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </mat-card>
</mat-menu>

<mat-menu #userFilter="matMenu">
  <mat-card class="filter-data" (click)="$event.stopPropagation()" *ngIf="!isBranchProductivityDashboard">
    <div fxFlex="180px" class="ml-05 mr-05">
      <mat-form-field>
        <mat-select placeholder="User" (selectionChange)="changeUser($event)" [(ngModel)]="userId">
          <mat-option [value]="User.teamMemberId" *ngFor="let User of employeesDropDown">
            <app-avatar class="employee_img" *ngIf="!User.profileImage"
              [name]="User.teamMemberName | removeSpecialCharacters" [isRound]="true" size="30">
            </app-avatar>
            <img class="employee_img" *ngIf="User.profileImage" src="{{User.profileImage}}">{{User.teamMemberName}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </mat-card>
  <mat-card class="filter-data" (click)="$event.stopPropagation()" *ngIf="isBranchProductivityDashboard">
    <div fxFlex="180px" class="ml-05 mr-05">
      <mat-form-field>
        <mat-select placeholder="User" (selectionChange)="changeBranchUser($event)" [(ngModel)]="userId">
          <mat-option [value]="User.userId" *ngFor="let User of branchMembersList">
            <app-avatar class="employee_img" *ngIf="!User.profileImage" [name]="User.userName | removeSpecialCharacters"
              [isRound]="true" size="30">
            </app-avatar>
            <img class="employee_img" *ngIf="User.profileImage" src="{{User.profileImage}}">{{User.userName}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </mat-card>
</mat-menu>

<mat-menu #branchFilter="matMenu">
  <mat-card class="filter-data" (click)="$event.stopPropagation()">
    <div fxFlex="180px" class="ml-05 mr-05">
      <mat-form-field>
        <mat-select placeholder="Branch" (selectionChange)="changeBranch($event)" [(ngModel)]="branchId">
          <mat-option [value]="branch.branchId" *ngFor="let branch of branchesList">
            {{branch.branchName}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </mat-card>
</mat-menu>