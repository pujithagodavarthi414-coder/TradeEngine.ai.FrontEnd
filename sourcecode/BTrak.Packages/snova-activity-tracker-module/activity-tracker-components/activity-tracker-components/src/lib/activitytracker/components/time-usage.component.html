<div *ngIf="(canAccess_feature_ViewEmployeeActivityTimeUsage)">
    <mat-divider></mat-divider>
    <mat-card class="p-02 m-0" id="productivity-2">
        <div class="ml-08 mr-08" fxLayout="row wrap" fxLayout.xs="column" fxLayoutAlign.xs="center center"
            fxLayoutGap="10px">
            <form [formGroup]="selectFilter" class="display-form-custom">
                <div fxFlex="9" fxFlex.lg="8" fxFlex.md="19" fxFlex.sm="20" fxFlex.xs="100"
                    fxLayoutAlign="center center" class="mr-05"
                    *ngIf="canAccess_feature_ViewActivityReportsForAllEmployee">

                    <mat-form-field class="full-width" (click)="$event.stopPropagation();">
                        <mat-select formControlName="branchIds" placeholder="{{'BRANCH.BRANCH' | translate}}" multiple
                            (selectionChange)="branchSelected();changeBranch($event.value)" [(ngModel)]="branchId">
                            <mat-select-trigger>
                                {{selectedBranch}}
                            </mat-select-trigger>
                            <mat-option #allBranchesSelected (click)="toggleAllBranchesSelected()" [value]="0">
                                {{ 'PERMISSIONMANAGEMENT.SELECTALL' | translate }}</mat-option>
                            <mat-option [value]="branch.branchId" *ngFor="let branch of branchesList"
                                #allBranchesSelected (click)="toggleBranchesPerOne()">
                                {{branch.branchName}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div fxFlex="9" fxFlex.lg="8" fxFlex.md="19" fxFlex.sm="20" fxFlex.xs="100"
                    fxLayoutAlign="center center" class="mr-05">
                    <mat-form-field class="full-width" (click)="$event.stopPropagation();">
                        <mat-select formControlName="roleIds" placeholder="{{'USERMANAGEMENT.ROLE' | translate}}"
                            multiple (selectionChange)="roleSelected();changeRole($event.value)" [(ngModel)]="roleId">
                            <mat-select-trigger>
                                {{selectedRole}}
                            </mat-select-trigger>
                            <mat-option #allRolesSelected (click)="toggleAllRolesSelected()" [value]="0">
                                {{ 'PERMISSIONMANAGEMENT.SELECTALL' | translate }}</mat-option>
                            <mat-option [value]="roles.roleId" *ngFor="let roles of rolesDropDown" #allRolesSelected
                                (click)="toggleRolesPerOne()">
                                {{roles.roleName}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div fxFlex="9" fxFlex.lg="8" fxFlex.md="16.3" fxFlex.sm="20" class="mb-0">
                    <mat-form-field class="full-width" (click)="$event.stopPropagation();">
                        <mat-select formControlName="userIds" placeholder="{{'ACTIVITYTRACKER.USER' | translate}}"
                            multiple (selectionChange)="userSelected();changeUser($event.value)" [(ngModel)]="userId">
                            <mat-select-trigger>
                                {{selectedUser}}
                            </mat-select-trigger>
                            <mat-option #allUsersSelected (click)="toggleAllUsersSelected()" [value]="0">
                                {{ 'PERMISSIONMANAGEMENT.SELECTALL' | translate }}</mat-option>
                            <mat-option [value]="employees.teamMemberId" *ngFor="let employees of employeesDropDown"
                                #allUsersSelected (click)="toggleUsersPerOne()">
                                {{employees.teamMemberName}}<span *ngIf="employees.teamMemberId == loggedUser">
                                    (Myself)</span>
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
            </form>
            <div fxFlex="47.3" fxLayout="row wrap" fxFlex.md="43" fxFlex.sm="60">
                <div fxFlex fxLayout="row wrap" fxLayoutAlign="center center" fxLayoutAlign.xs="center center"
                    fxLayoutAlign.sm="end center" *ngIf="day">
                    <div fxFlex="5" fxFlex.lg="7" fxFlex.md="10" fxFlex.sm="15" fxFlex.lt-sm="10" fxFlex.xs="20">
                        <fa-icon matTooltip="{{'TIMESHEET.ONEWEEKBACKWARD' | translate}}"
                            *ngIf="(!isTrailExpired || !isPreviousDisable) && (dayCount == 7)"
                            (click)="timeSheetDetailsForDay('backward','week')" class="mr-05 icon-button"
                            icon="angle-double-left">
                        </fa-icon>
                        <fa-icon matTooltip="{{'TIMESHEET.ONEDAYBACKWARD' | translate}}"
                            *ngIf="!isTrailExpired || !isPreviousDisable"
                            (click)="timeSheetDetailsForDay('backward','day');previous()" class="mr-05 icon-button"
                            icon="chevron-left">
                        </fa-icon>
                    </div>
                    <div fxFlex="11" fxFlex.lg="15" fxFlex.md="23" fxFlex.sm="23" fxFlex.lt-sm="52" fxFlex.xs="43">
                        <input matInput [matDatepicker]="picker1" (dateChange)="onDateChange($event)" [max]="maxDate"
                            class="date-picker" (click)="picker1.open()" [(ngModel)]="dateToday" [readonly]="true">
                        <mat-datepicker #picker1></mat-datepicker>
                    </div>
                    <div fxFlex="5" fxFlex.lg="7" fxFlex.md="10" fxFlex.sm="15" fxFlex.lt-sm="20" fxFlex.xs="20"
                        [hidden]="!dispalyForward">
                        <fa-icon matTooltip="{{'TIMESHEET.ONEDAYFORWARD' | translate}}"
                            (click)="timeSheetDetailsForDay('forward','day');next()" class="ml-05 icon-button"
                            icon="chevron-right">
                        </fa-icon>
                        <fa-icon matTooltip="{{'TIMESHEET.ONEWEEKFORWARD' | translate}}"
                            (click)="timeSheetDetailsForDay('forward','week')" class="ml-05 icon-button"
                            icon="angle-double-right">
                        </fa-icon>
                    </div>
                </div>
                <div *ngIf="week" fxFlex fxLayoutAlign="center center">
                    <fa-icon (click)="getWeekBasedOnDate('left')" class="icon-button" icon="chevron-left"
                        *ngIf="!isTrailExpired"></fa-icon>
                    <span class="month-display-elsement">&nbsp;&nbsp;&nbsp;&nbsp;{{selectedWeek | date: "MMM -
                        yyyy"}}&nbsp;&nbsp;</span><span *ngIf="weekNumber"
                        class="month-display-elsement">W{{weekNumber}}&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    <fa-icon (click)="getWeekBasedOnDate('right')" class="icon-button" icon="chevron-right"
                        [hidden]="!dispalyForward">
                    </fa-icon>
                </div>
                <div *ngIf="month" fxFlex fxLayoutAlign="center center">
                    <fa-icon (click)="getMonthBasedOnDate('left')" class="icon-button" icon="chevron-left">
                    </fa-icon>
                    <span class="month-display-elsement">&nbsp;&nbsp;&nbsp;&nbsp;{{selectedMonth | date:
                        "MMM-yyyy"}}&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    <fa-icon (click)="getMonthBasedOnDate('right')" class="icon-button" icon="chevron-right"
                        [hidden]="!dispalyForward">
                    </fa-icon>
                </div>
                <div *ngIf="dateRange" fxLayout="row" fxLayout.xs="column" fxLayoutAlign="center center"
                    fxLayoutGap="10px">
                    <div fxFlex="48" fxFlex.sm="50" fxFlex.xs="100">
                        <mat-form-field color="accent">
                            <mat-label>{{ 'PERMISSIONHISTORY.FROMDATE' | translate }}</mat-label>
                            <input matInput [matDatepicker]="picker1" autocomplete="off" (click)="picker1.open()"
                                (dateChange)="dateFromChanged($event)" class="date-picker" [(ngModel)]="fromDate"
                                [min]="minDateOnTrailExpired" [max]="maxDate" [readonly]="true">
                            <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                            <mat-datepicker #picker1></mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div fxFlex="47" fxFlex.sm="40" fxFlex.xs="100">
                        <mat-form-field color="accent">
                            <mat-label>{{ 'PERMISSIONHISTORY.TODATE' | translate }}</mat-label>
                            <input matInput [matDatepicker]="picker2" autocomplete="off" [min]="minDate"
                                (click)="picker2.open()" (dateChange)="dateToChanged($event)" class="date-picker"
                                [max]="maxDate" [(ngModel)]="toDate" [readonly]="true">
                            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                            <mat-datepicker #picker2></mat-datepicker>
                        </mat-form-field>
                    </div>
                </div>
            </div>
            <div class="fxcls" fxFlex fxLayout="row wrap" fxLayoutAlign="end center" fxLayoutAlign.lt-md="center center" fxFlex.sm="100">
                <div id="productivity-3" fxLayout="row wrap">
                    <div class="mt-02">
                        <mat-slide-toggle matTooltip="{{'ACTIVITYTRACKER.INCLUDEIDLETIME' | translate }}" class="mr-1 archive-switch"
                            [(ngModel)]="isIdleView" [checked]="isIdleView">
                        </mat-slide-toggle>
                    </div>
                    <div class="mb-05" *ngIf="false">
                        <button mat-raised-button (click)="dayTypeForTimeUsage('day')" color="{{primaryDay}}">{{'ACTIVITYTRACKER.DAY' |
                            translate}}</button>
                    </div>
                    <!-- <div class="mb-05" *ngIf="!isTrailExpired "> -->
                    <div class="mb-05" *ngIf="false">
                        <button mat-raised-button (click)="dayTypeForTimeUsage('week')" color="{{primaryWeek}}">{{'ACTIVITYTRACKER.WEEK' |
                            translate}}</button>
                    </div>
                    <div class="mb-05" *ngIf="false">
                        <button mat-raised-button (click)="dayTypeForTimeUsage('month')" color="{{primaryMonth}}">{{'ACTIVITYTRACKER.MONTH'
                            | translate}}</button>
                    </div>
                    <div class="mb-05" *ngIf="false">
                        <button mat-raised-button (click)="dayTypeForTimeUsage('daterange')"
                            color="{{primaryDateRange}}">{{'ACTIVITYTRACKER.DATERANGE' | translate}}
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <mat-divider *ngIf="filterStatus()"></mat-divider>
        <div class="pt-2" *ngIf="filterStatus()" fxLayout="row wrap">
            <mat-chip disableRipple matRipple *ngIf="fromDate && dateRange" class="ml-05 m03">
                <div>
                    <b>{{'PERMISSIONHISTORY.FROMDATE' | translate}}:</b>&nbsp;{{fromDate | date:"d MMM, y"}}
                </div>
            </mat-chip>
            <mat-chip disableRipple matRipple *ngIf="toDate && dateRange" class="ml-05 m03">
                <div>
                    <b>{{'PERMISSIONHISTORY.TODATE' | translate}}:</b>&nbsp;{{toDate | date:"d MMM, y"}}
                </div>
            </mat-chip>
            <mat-chip disableRipple matRipple *ngIf="selectedBranch" class="ml-05 m03" fxLayout="row">
                <div>
                    <b>{{'LOGTIMEREPORT.BRANCH' | translate}}:</b>&nbsp;{{selectedBranch}}
                </div>
                <div (click)="resetBranch()" class="cursor-pointer ml-01">
                    <fa-icon icon="times" class="times-on-hover"></fa-icon>
                </div>
            </mat-chip>
            <mat-chip disableRipple matRipple *ngIf="selectedRole" class="ml-05 m03" fxLayout="row">
                <div>
                    <b>{{'USERMANAGEMENT.ROLE' | translate}}:</b>&nbsp;{{selectedRole}}
                </div>
                <div (click)="resetRole()" class="cursor-pointer ml-01">
                    <fa-icon icon="times" class="times-on-hover"></fa-icon>
                </div>
            </mat-chip>
            <mat-chip disableRipple matRipple *ngIf="selectedUser" class="ml-05 m03" fxLayout="row">
                <div>
                    <b>{{'ACTIVITYTRACKER.USER' | translate}}:</b>&nbsp;{{selectedUser}}
                </div>
                <div (click)="resetUser()" class="cursor-pointer ml-01">
                    <fa-icon icon="times" class="times-on-hover"></fa-icon>
                </div>
            </mat-chip>
        </div>
    </mat-card>
    <mat-progress-bar mode="indeterminate" *ngIf="loading"></mat-progress-bar>
    <div class="tracker-timeusage-bar" fxLayout="row wrap" fxLayout.xs="column" fxLayoutAlign.xs="start"
        fxLayoutGap="10px"  >
        <div fxFlex class="full-width time-usage-height productive-count pagination-move-left" id="productivity-1"
            [ngClass]="timeUsage.length == 0 ? 'page-count-hide' : ''"> 
            <ngx-datatable class="btrak" [rows]="timeUsage" [sortType]="'multi'" [headerHeight]="35" [footerHeight]="35"
                [rowHeight]="40" [limit]="pageSize" [columnMode]="'force'" [externalPaging]="true" [offset]="pageNumber"
                (sort)="onSort($event)" (page)='setPage($event)' [count]="totalCount" [scrollbarH]="true"
                [virtualization]="false" [sorts]="[{prop: 'name', dir: 'asc'}]"
                [messages]="{emptyMessage:('NODATATODISPLAY' | translate), totalMessage: 'TOTAL' | translate}">
                <ngx-datatable-column name="{{'ACTIVITYTRACKER.USER' | translate | softLabelsPipe : softLabels}}"
                    sortable="true" prop="name">
                    <ng-template let-row="row" ngx-datatable-cell-template class="hide-content-overflow">
                        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
                            <div fxFlex>
                                <img class="employee_img" style="margin: 0;width:25px;height: 25px;"
                                    src="{{row.profileImage}}" *ngIf="row?.profileImage" />
                                <ngx-avatar name="{{ row?.name}}" initialsSize="2" [round]="true" size="25"
                                    *ngIf="!row?.profileImage">
                                </ngx-avatar>
                            </div>
                            <div fxFlex>
                                <label class="assets-name-control hide-content-overflow mb-0 mt-05"
                                    matTooltip="{{row?.name}}">{{ row?.name }}<span *ngIf="row?.userId == loggedUser">
                                        (Myself)</span></label>
                            </div>
                        </div>
                    </ng-template>
                </ngx-datatable-column>
                <span *ngFor="let date of dates">
                    <ngx-datatable-column name="{{ getMyDate(date) | date: 'dd-MMM-yyyy' }}" [sortable]="false">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                            <span *ngFor="let usage of row?.timeUsageSearchOutputModel">
                                <span
                                    >
                                    <!-- [ngStyle]="{'display': display(date ,usage?.operationDate) ? displayUi : displayUi }" -->
                                    <!-- display(date | date:'shortDate',usage?.operationDate | date:'shortDate') -->
                                    <div fxLayout="row wrap" [ngStyle]="{width: '125px'}">
                                        <div fxLayout="row" fxFlex="100">
                                            <div fxFlex="{{ calculateWidth(usage, 'productive') }}" *ngIf="usage?.productive != 0"
                                                matTooltip="{{usage?.productiveTime  | activityTimeFilter}} - {{'ACTIVITYTRACKER.PRODUCTIVE' | translate}}">
                                                <span class="cursor-pointer"
                                                    (click)="openActivityTrackerDetails(date, row, 'Productive', usage)">
                                                    <hr class="productive-bar-color"
                                                        style="height: 10px; border-width: 0px; margin-bottom: 0px;">
                                                    <!-- <mat-progress-bar mode="determinate" value="100"
                                                        class="productive-color" [ngStyle]="{height:'12px'}">
                                                    </mat-progress-bar> -->
                                                </span>
                                            </div>
                                            <div fxFlex="{{ calculateWidth(usage, 'unProductive') }}" *ngIf="usage?.unProductive != 0"
                                                matTooltip="{{usage?.unProductiveTime | activityTimeFilter}} - {{'ACTIVITYTRACKER.UNPRODUCTIVE' | translate}}">
                                                <span class="cursor-pointer"
                                                    (click)="openActivityTrackerDetails(date, row, 'UnProductive', usage)">
                                                    <hr class="unproductive-bar-color"
                                                        style="height: 10px; border-width: 0px; margin-bottom: 0px;">
                                                    <!-- <mat-progress-bar mode="determinate" value="100"
                                                        class="unproductive-color" [ngStyle]="{height:'12px'}">
                                                    </mat-progress-bar> -->
                                                </span>
                                            </div>
                                            <div fxFlex="{{ calculateWidth(usage, 'neutral') }}" *ngIf="usage?.neutral != 0"
                                                matTooltip="{{usage?.neutralTime | activityTimeFilter}} - {{'ACTIVITYTRACKER.NEUTRAL' | translate}}">
                                                <span class="cursor-pointer"
                                                    (click)="openActivityTrackerDetails(date, row, 'Neutral', usage)">
                                                    <hr class="neutral-bar-color"
                                                        style="height: 10px; border-width: 0px; margin-bottom: 0px;">
                                                    <!-- <mat-progress-bar mode="determinate" value="100"
                                                        class="neutral-color" [ngStyle]="{height:'12px'}">
                                                    </mat-progress-bar> -->
                                                </span>
                                            </div>
                                            <div fxFlex="{{ calculateWidth(usage, 'idle') }}" *ngIf="usage?.idle != 0 && isIdleView"
                                                matTooltip="{{usage?.idleTime | activityTimeFilter}} - {{'ACTIVITYTRACKERAPPS.IDLETIME' | translate}}">
                                                <span class="cursor-pointer"
                                                    (click)="openActivityTrackerDetails(date, row, 'SystemBreaks', usage)">
                                                    <hr class="idle-bar-color"
                                                        style="height: 10px; border-width: 0px; margin-bottom: 0px;">
                                                    <!-- <mat-progress-bar mode="determinate" value="100"
                                                        class="idle-color" [ngStyle]="{height:'12px'}">
                                                    </mat-progress-bar> -->
                                                </span>
                                            </div>
                                        </div>
                                        <div fxLayout="row" fxLayoutAlign="center center" fxFlex="100">
                                            {{ totalTime(usage) | activityTimeFilter}}
                                        </div>
                                    </div>
                                </span>
                            </span>
                        </ng-template>
                    </ngx-datatable-column>
                </span>
            </ngx-datatable>
        </div>
    </div>
    <!-- <div fxLayout="row wrap" fxLayoutAlign="end center" fxLayoutAlign.xs="start" class="chip-type mt-05 mr-8">
        <div class="mr-1">
            <mat-chip class="chip-productive ml-05"></mat-chip> &nbsp;
            <label class="activity-font-color"
                matTooltip="{{'ACTIVITYTRACKER.PRODUCTIVE' | translate}}">{{'ACTIVITYTRACKER.PRODUCTIVE' | translate}}</label>
        </div>
        <div class="mr-1">
            <mat-chip class="chip-unproductive ml-05"></mat-chip> &nbsp;
            <label class="activity-font-color"
                matTooltip="{{'ACTIVITYTRACKER.UNPRODUCTIVE' | translate}}">{{'ACTIVITYTRACKER.UNPRODUCTIVE' | translate}}</label>
        </div>
        <div class="mr-1">
            <mat-chip class="chip-neutral ml-05"></mat-chip> &nbsp;
            <label class="activity-font-color"
                matTooltip="{{'ACTIVITYTRACKER.NEUTRAL' | translate}}">{{'ACTIVITYTRACKER.NEUTRAL' | translate}}</label>
            &nbsp;
            &nbsp;
        </div>
    </div> -->
</div>
<app-common-message-box *ngIf="!(canAccess_feature_ViewEmployeeActivityTimeUsage )"
    textToDisplay="{{ 'PERMISSIONMESSAGE' | translate }}">
</app-common-message-box>

<ng-template #activityTrackerDialog let-data>
    <app-activity-tracker-dialog [data]=[data]></app-activity-tracker-dialog>
</ng-template>