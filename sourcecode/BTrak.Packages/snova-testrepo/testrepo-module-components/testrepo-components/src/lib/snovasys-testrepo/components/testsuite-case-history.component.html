<mat-progress-bar color="primary" class="pl-1" mode="indeterminate" *ngIf="anyOperationInProgress$ | async">
</mat-progress-bar>
<!-- <mat-card *ngIf="!(anyOperationInProgress$ | async)" class="p-0 ml-1 test-display" fxFlex="100" fxFlex.gt-sm="100">
    <div fxLayout="row" fxFlex="100">
        <div fxFlex="100" fxFlex.gt-sm="5" class="p-05">
            <fa-icon icon="info-circle"></fa-icon>
        </div>
        <div fxFlex="100" fxFlex.gt-sm="95" class="p-05 ml-1">
            <p class="m-0">{{'TESTMANAGEMENT.NOHISTORYFOUND' | translate}}</p>
        </div>
    </div>
</mat-card> -->
<div fxLayoutAlign="end center" class="mb-1">
    <span class="mr-05">{{'TESTMANAGEMENT.TESTCASEVIEWED' | translate}}</span>
    <mat-slide-toggle [(ngModel)]="isCaseViewed" [checked]="isCaseViewed">
    </mat-slide-toggle>
</div>
<div class="p-03" *ngIf="!(anyOperationInProgress$ | async)">
    <div *ngFor="let caseHistory of (testCaseHistory$ | async)">
        <div fxLayout="row wrap" fxLayoutGap="10px" *ngIf="caseHistory.fieldName != 'TestCaseViewed' && caseHistory.fieldName != 'TestCaseUpdated' 
                && caseHistory.fieldName != 'CaseStatus' && caseHistory.fieldName != 'StatusComment' && caseHistory.fieldName != 'TestCaseStatusChanged'
                && caseHistory.fieldName != 'AssignToComment' && caseHistory.fieldName != 'Assignee'
                && caseHistory.fieldName != 'ActualResult' && caseHistory.fieldName != 'StepStatus' 
                && caseHistory.userStoryId == null" >
            <div mat-card-avatar fxFlex="5" fxFlex.gt-lg="3" fxFlex.xs="13">
                <app-avatar matTooltip="{{ caseHistory.testedByName }}"
                    [name]="caseHistory.testedByName | removeSpecialCharacters"
                    [src]="caseHistory.testedByProfileImage | fetchSizedAndCachedImage: '20':''" [isRound]="true"
                    size="20">
                </app-avatar>
            </div>
            <div fxFlex fxLayout="column" fxLayoutGap="5px">
                <div fxLayout="row">
                    <div fxFlex="50" fxFlex.gt-lg="20" fxFlex.lg="30" fxFlex.md="45">
                        <b>{{caseHistory.testedByName}}</b>
                    </div>
                    <div fxFlex>
                        <span class="pull-right"
                            matTooltip="{{caseHistory.createdDateTime| date:'dd-MM-yyyy, h:mm a ' }}">{{caseHistory.createdDateTime | utcToLocalTime | timeago }}</span>
                    </div>
                </div>
                <div class="mb-05" fxLayout="row" *ngIf="caseHistory.fieldName == 'CaseStatus'">
                    <span>
                        <b>{{'TESTMANAGEMENT.TESTMARKEDAS' | translate}}</b>
                        <b><i>{{caseHistory.newValue}}&nbsp;</i>{{'TESTMANAGEMENT.IN' | translate}}&nbsp;<b><i>{{caseHistory.testRunName}}</i>&nbsp;</b>{{'TESTMANAGEMENT.TESTRUNFORHISTORY' | translate}}</b>
                    </span>
                </div>
               
                <!-- <div class="mb-05" fxLayout="row" *ngIf="caseHistory.fieldName == 'TestCaseViewed'">
                    <span>
                        <b>{{ caseHistory.testedByName }}&nbsp;{{'TESTMANAGEMENT.HADSEENTHISTESTCASE' | translate}}</b>
                    </span>
                </div> -->
                <div class="mb-05" fxLayout="row" *ngIf="caseHistory.fieldName == 'TestCaseCreated'">
                    <span>
                        <b>{{ caseHistory.testedByName }}&nbsp;{{'TESTMANAGEMENT.CREATEDTHISTESTCASE' | translate}}</b>
                    </span>
                </div>
                <div class="mb-05" fxLayout="row" *ngIf="caseHistory.fieldName == 'TestCaseMoved'">
                    <span>
                        <b>{{ caseHistory.testedByName }}&nbsp;{{'TESTMANAGEMENT.MOVEDTHISTESTCASE' | translate}}</b>
                    </span>
                </div>
                <div class="mb-05" fxLayout="row" *ngIf="caseHistory.description == 'AddedToTestRun'">
                    <span>
                        <b>{{'TESTMANAGEMENT.THISTESTCASEWASADDEDTO' | translate}}</b>&nbsp;
                        <b><i>{{caseHistory.testRunName}}&nbsp;{{'TESTMANAGEMENT.TESTRUNFORHISTORY' | translate}}</i>{{'TESTMANAGEMENT.THISTESTCASEWASADDEDTOEND' | translate}}</b>
                    </span>
                </div>
                <div class="mb-05" fxLayout="row" *ngIf="caseHistory.fieldNameÂ == 'test case section' || caseHistory.fieldName == 'test case template' 
                || caseHistory.fieldName == 'test case type' || caseHistory.fieldName == 'automation type' 
                || caseHistory.fieldName == 'test case priority' || caseHistory.fieldName == 'preconditions' 
                || caseHistory.fieldName ==  'title' || caseHistory.fieldName == 'references'|| caseHistory.fieldName=='mission'|| caseHistory.fieldName=='goals'
                || caseHistory.fieldName == 'estimate' ">
                    <span>
                        <b>{{ caseHistory.testedByName }}&nbsp;{{'TESTMANAGEMENT.CHANGED' | translate}}</b>&nbsp;<i>{{ caseHistory.fieldName }}</i>&nbsp;<b>{{'TESTMANAGEMENT.FROM' | translate}}</b>
                        &nbsp;<i>{{ caseHistory.oldValue }}</i>&nbsp;<b>{{'TESTMANAGEMENT.TO' | translate}}</b>&nbsp;<i>{{ caseHistory.newValue }}</i>&nbsp;<b>{{'TESTMANAGEMENT.CHANGEDTELUGU' | translate}}</b>
                    </span>
                </div>
                
                <div class="mb-05" fxLayout="row" *ngIf="caseHistory.fieldName == 'StepDescription' ">
                    <span>
                        <b>{{ caseHistory.testedByName }}&nbsp;{{'TESTMANAGEMENT.CHANGED' | translate}}</b>&nbsp;<i>{{'TESTMANAGEMENT.STEPDESCRIPTION' | translate}}</i>&nbsp;<b>{{'TESTMANAGEMENT.FROM' | translate}}</b>
                        &nbsp;<i>{{ caseHistory.oldValue }}</i>&nbsp;<b>{{'TESTMANAGEMENT.TO' | translate}}</b>&nbsp;<i>{{ caseHistory.newValue }}</i>&nbsp;<b>{{'TESTMANAGEMENT.CHANGEDTELUGU' | translate}}</b>
                    </span>
                </div>
                <div class="mb-05" fxLayout="row" *ngIf="caseHistory.fieldName == 'ExpectedResult' ">
                    <span>
                        <b>{{ caseHistory.testedByName }}&nbsp;{{'TESTMANAGEMENT.CHANGED' | translate}}</b>&nbsp;<i>{{'TESTMANAGEMENT.EXPECTEDRESULT' | translate}}</i>&nbsp;<b>{{'TESTMANAGEMENT.FROM' | translate}}</b>
                        &nbsp;<i>{{ caseHistory.oldValue }}</i>&nbsp;<b>{{'TESTMANAGEMENT.TO' | translate}}</b>&nbsp;<i>{{ caseHistory.newValue }}</i>&nbsp;<b>{{'TESTMANAGEMENT.CHANGEDTELUGU' | translate}}</b>
                    </span>
                </div>
                <div class="mb-05" fxLayout="row" *ngIf="caseHistory.fieldName == 'StepCreated'"
                    style="word-break: break-all;">
                    <!-- style="white-space: pre-line; display: flex;" -->
                    <span>
                        <span>
                            <b>{{'TESTMANAGEMENT.STEP' | translate}}: {{caseHistory.stepOrder}}</b>
                        </span>
                        <span *ngIf="caseHistory?.oldValue && caseHistory?.oldValue.length > 0" class="ml-01">
                            {{'TESTMANAGEMENT.WITHDES' | translate}}
                            <span class="ml-01"><b>{{caseHistory.oldValue}}</b></span>
                        </span>
                        <span class="ml-01">
                            {{'TESTMANAGEMENT.WASCREATED' | translate}}
                        </span>
                    </span>
                </div>
                <div class="mb-05" fxLayout="row" *ngIf="caseHistory.fieldName == 'StepDeleted'"
                    style="word-break: break-all;">
                    <!-- style="white-space: pre-line; display: flex;" -->
                    <span>
                        <span>
                            <b>{{'TESTMANAGEMENT.STEP' | translate}}: {{caseHistory.stepOrder}}</b>
                        </span>
                        <span *ngIf="caseHistory.step && caseHistory.step.length > 0" class="ml-01">
                            {{'TESTMANAGEMENT.WITHDES' | translate}}
                            <span class="ml-01"><b>{{caseHistory.step}}</b></span>
                        </span>
                        <span class="ml-01">
                            {{'TESTMANAGEMENT.WASDELETED' | translate}}
                        </span>
                    </span>
                </div>
                <div class="mb-05" fxLayout="row" *ngIf="caseHistory.fieldName == 'StepTextUpdated'"
                    style="word-break: break-all;">
                    <!-- style="white-space: pre-line; display: flex;" -->
                    <span>
                        <span>
                            <b>{{'TESTMANAGEMENT.STEP' | translate}}: {{caseHistory.stepOrder}}</b>
                        </span>
                        <!-- style="white-space: pre-line; display: flex;" -->
                        <span class="ml-01">
                            {{ 'TESTMANAGEMENT.STEPTEXTCHANGEDFROM' | translate }}
                            <span class="ml-01">
                                <b *ngIf="caseHistory?.oldValue && caseHistory?.oldValue.length > 0">
                                    {{caseHistory?.oldValue}}</b>
                                <b *ngIf="caseHistory?.oldValue == null || caseHistory?.oldValue == ''">
                                    N/A</b>
                            </span>
                            {{ 'BILLINGMANAGEMENT.SMALLTO' | translate }}
                            <span class="ml-01">
                                <b *ngIf="caseHistory?.newValue && caseHistory?.newValue.length > 0">
                                    {{caseHistory?.newValue}}</b>
                                <b *ngIf="caseHistory?.newValue == null || caseHistory?.newValue == ''">
                                    N/A</b>
                            </span>
                            {{ 'BILLINGMANAGEMENT.DONE' | translate }}
                        </span>
                    </span>
                </div>
                <div class="mb-05" fxLayout="row" *ngIf="caseHistory.fieldName == 'StepExpectedResultUpdated'"
                    style="word-break: break-all;">
                    <!-- style="white-space: pre-line; display: flex;" -->
                    <span>
                        <span>
                            <b>{{'TESTMANAGEMENT.STEP' | translate}}: {{caseHistory.stepOrder}}</b>
                        </span>
                        <!-- style="white-space: pre-line; display: flex;" -->
                        <span class="ml-01">
                            {{ 'TESTMANAGEMENT.STEPEXPRESULTCHANGEDFROM' | translate }}
                            <span class="ml-01">
                                <b *ngIf="caseHistory?.oldValue && caseHistory?.oldValue.length > 0">
                                    {{caseHistory?.oldValue}}</b>
                                <b *ngIf="caseHistory?.oldValue == null || caseHistory?.oldValue == ''">
                                    N/A</b>
                            </span>
                            {{ 'BILLINGMANAGEMENT.SMALLTO' | translate }}
                            <span class="ml-01">
                                <b *ngIf="caseHistory?.newValue && caseHistory?.newValue.length > 0">
                                    {{caseHistory?.newValue}}</b>
                                <b *ngIf="caseHistory?.newValue == null || caseHistory?.newValue == ''">
                                    N/A</b>
                            </span>
                            {{ 'BILLINGMANAGEMENT.DONE' | translate }}
                        </span>
                    </span>
                </div>
               
                <div class="mb-05" fxLayout="row" *ngIf="caseHistory.description == 'RemovedFromTestRun'">
                    <span>
                        <b>{{'TESTMANAGEMENT.THISTESTCASEWASREMOVEDFROM' | translate}}</b>&nbsp;
                        <b><i>{{caseHistory.testRunName}}&nbsp;{{'TESTMANAGEMENT.TESTRUNFORHISTORY' | translate}}&nbsp;</i>{{'TESTMANAGEMENT.THISTESTCASEWASREMOVEDFROMEND' | translate}}</b>
                    </span>
                </div>
            </div>
        </div>
        <div fxLayout="row wrap" fxLayoutGap="10px"
            [hidden]="!(isCaseViewed && caseHistory.fieldName == 'TestCaseViewed' && caseHistory.fieldName != 'TestCaseUpdated' && caseHistory.userStoryId == null)">
            <div mat-card-avatar fxFlex="5" fxFlex.gt-lg="3" fxFlex.xs="13">
                <app-avatar matTooltip="{{ caseHistory.testedByName }}"
                    [name]="caseHistory.testedByName | removeSpecialCharacters"
                    [src]="caseHistory.testedByProfileImage | fetchSizedAndCachedImage: '20':''" [isRound]="true"
                    size="20">
                </app-avatar>
            </div>
            <div fxFlex fxLayout="column" fxLayoutGap="5px">
                <div fxLayout="row">
                    <div fxFlex="50" fxFlex.gt-lg="20" fxFlex.lg="30" fxFlex.md="45">
                        <b>{{caseHistory.testedByName}}</b>
                    </div>
                    <div fxFlex>
                        <span class="pull-right"
                            matTooltip="{{caseHistory.createdDateTime| date:'dd-MM-yyyy, h:mm a ' }}">{{caseHistory.createdDateTime | utcToLocalTime | timeago }}</span>
                    </div>
                </div>
                <div class="mb-05" fxLayout="row">
                    <span>
                        <b>{{ caseHistory.testedByName }}&nbsp;{{'TESTMANAGEMENT.HADSEENTHISTESTCASE' | translate}}</b>
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>