<div class="ml-1 mb-05 mt-1" fxLayout="row">
    <mat-checkbox *ngIf="(canAccess_entityType_feature_AddOrUpdateStatus) && (casesCount > 0) && !testRunCompleted"
        class="mr-05" [(ngModel)]="isMultiCasesSelected" (change)="changeStatus($event.checked)"
        style="position: relative; top: 3px;">
    </mat-checkbox>
    <b class="word-break user-select-text"
        matTooltip="{{'TESTMANAGEMENT.SECTIONNAME' | translate}}">{{hierarchicalData.sectionName}}</b>
    <span matTooltip="{{'TESTMANAGEMENT.CASESCOUNT' | translate}}"
        class="ml-05 badge-item test-run-case-count-number">{{casesCount}}</span>
    <span *ngIf="totalEstimate > 0">
        <mat-icon icon="clock" class="ml-05 mr-05 mat-color-accent clock-icon"
            matTooltip="{{totalEstimate | estimationTime}}">access_time</mat-icon>
    </span>
    <span *ngIf="totalEstimate == 0">
        <mat-icon icon="clock" class="ml-05 mr-05 mat-color-accent clock-icon" matTooltip="0h">access_time</mat-icon>
    </span>
    <!-- <span class="ml-05"
        *ngIf="isAnyOfCasesSelected && (canAccess_entityType_feature_AddOrUpdateStatus) && !testRunCompleted">
        <fa-icon class="update-status" icon="user" matTooltip="{{ 'TESTMANAGEMENT.UPDATEASSIGNTO' | translate }}"
            (click)="openAssigneePopover(updateAssigneesPopover)" [satPopoverAnchorFor]="updateAssigneePopover"
            #updateAssigneesPopover="satPopoverAnchor">
        </fa-icon>
        <fa-icon class="ml-05 update-status" icon="battery-three-quarters"
            matTooltip="{{ 'TESTMANAGEMENT.UPDATESTATUS' | translate }}"
            (click)="openStatusPopover(updateStatusesPopover)" [satPopoverAnchorFor]="updateStatusPopover"
            #updateStatusesPopover="satPopoverAnchor">
        </fa-icon>
    </span> -->
</div>
<div class="ml-1 mb-1" *ngIf="hierarchicalData.description != null && hierarchicalData.description.length > 0">
    <span class="section-description word-break user-select-text"
        matTooltip="{{'TESTMANAGEMENT.SECTIONDESCRIPTION' | translate}}">{{hierarchicalData.description}}</span>
</div>
<mat-card-content class="p-0">
    <mat-list class="compact-list ml-02 mb-1">
        <mat-divider class="mat-divider-position">
        </mat-divider>
        <mat-list-item *ngFor="let case of (testCases$ | async)">
            <testrun-case class="full-width" (click)="handleClick(case)" (caseSelection)="getCaseSelection($event)"
                (casesSelected)="getCasesSelected($event)"
                (caseStatusPreviewDetails)="getCaseStatusPreviewDetails($event)" [allCasesSelect]="selection"
                [caseSelected]="case.testCaseId === selectedCaseId" [testRunId]="testRunId" [projectId]="projectId"
                [caseDetails]="case" [testRunIsCompleted]="testRunCompleted" [isBugBoardEnable]="isBugBoardEnable">
            </testrun-case>
        </mat-list-item>
    </mat-list>
</mat-card-content>
<div class="ml-08 mb-05 hierarchical-subsection-border"
    *ngIf="!(hierarchicalData.subSections == null) && hierarchicalData.subSections.length > 0">
    <div class="ml-05" *ngFor="let subSection of hierarchicalData.subSections">
        <hierarchical-run-cases (caseStatusPreviewDetails)="getCaseStatusPreviewDetails($event)"
            (caseSelection)="getCaseSelection($event)" (casesSelected)="getCasesSelected($event)"
            [hierarchicalData]="subSection" [testSuiteId]="testSuiteId" [testRunId]="testRunId" [casesData]="testCases"
            [hierarchicalSectionId]="hierarchicalSectionId" [testRunCompleted]="testRunCompleted"
            [projectId]="projectId" [allCasesSelect]="selection" [selectedCase]="testCaseFromPreview"
            [isBugBoardEnable]="isBugBoardEnable">
        </hierarchical-run-cases>
    </div>
</div>

<sat-popover backdropClass="backdrop-color" #updateAssigneePopover verticalAlign="below" hasBackdrop
    [interactiveClose]="false" horizontalAlign="end">
    <mat-card class="filter-data p-0">
        <mat-card-title class="text-center">
            <div class="card-title-text mat-bg-primary p-05">
                {{'TESTMANAGEMENT.UPDATEASSIGNTO' | translate}}
            </div>
        </mat-card-title>
        <mat-card-content *ngIf="loadAssignForm">
            <form [formGroup]="assignToForm" novalidate (submit)="assignToForm.valid && updateMultipleAssignTo()">
                <mat-form-field class="full-width">
                    <mat-select placeholder="{{'TESTMANAGEMENT.ASSIGNTO' | translate}}" formControlName="assignToId"
                        required>
                        <mat-option *ngFor="let user of (usersList$ | async)" [value]="user.id">
                            {{user.value}}
                        </mat-option>
                    </mat-select>
                    <mat-hint>{{'TESTMANAGEMENT.ASSIGNTOHINT' | translate}}</mat-hint>
                    <mat-error *ngIf="assignToForm.get('assignToId').hasError('required')">
                        {{'TESTMANAGEMENT.PLEASESELECTUSER' | translate}}
                    </mat-error>
                </mat-form-field>
                <div class="text-center mt-05">
                    <button class="mr-1" type="submit" mat-button mat-raised-button color="primary"
                        [disabled]="disableUpdate">
                        <fa-icon icon="sync" class="mr-05"></fa-icon> {{'TESTMANAGEMENT.UPDATE' | translate}}
                    </button>
                    <button type="button" mat-button mat-raised-button (click)="closeAssigneePopover()">
                        <fa-icon icon="times" class="mr-05"></fa-icon>
                        {{'TESTMANAGEMENT.CANCEL' | translate}}
                    </button>
                </div>
            </form>
        </mat-card-content>
    </mat-card>
</sat-popover>

<sat-popover backdropClass="backdrop-color" #updateStatusPopover verticalAlign="below" hasBackdrop
    [interactiveClose]="false" horizontalAlign="end">
    <mat-card class="filter-data p-0">
        <mat-card-title class="text-center">
            <div class="card-title-text mat-bg-primary p-05">
                {{'TESTMANAGEMENT.UPDATESTATUS' | translate}}
            </div>
        </mat-card-title>
        <mat-card-content class="testrun-external-editor" *ngIf="loadStatusForm">
            <form [formGroup]="statusForm" novalidate (submit)="statusForm.valid && updateMultipleStatus()">
                <mat-form-field class="full-width mt-05">
                    <mat-select placeholder="{{'TESTMANAGEMENT.STATUS' | translate}}" formControlName="statusId"
                        required>
                        <mat-option *ngFor="let status of (statusList$ | async)" [value]="status.id">
                            {{status.value}}
                        </mat-option>
                    </mat-select>
                    <mat-hint>{{'TESTMANAGEMENT.STATUSHINT' | translate}}</mat-hint>
                    <mat-error *ngIf="statusForm.get('statusId').hasError('required')">
                        {{'TESTMANAGEMENT.PLEASESELECTSTATUS' | translate}}
                    </mat-error>
                </mat-form-field>
                <editor class="mt-05 dfree-header mce-content-body logtime-comment"
                    apiKey="ewi2adl9u4cmc1lic9wcz3zq03696a3ihlodo4n1oaveo3kk" placeholder="Add comment" menubar="false"
                    [init]="initSettings" inline="true" resize="false" background="white" height="100"
                    formControlName="statusComment">
                </editor>
                <mat-hint>{{'TESTMANAGEMENT.STATUSCOMMENTHINT' | translate}}</mat-hint>
                <div class="text-center mt-05">
                    <button class="mr-1" type="submit" mat-button mat-raised-button color="primary"
                        [disabled]="disableUpdate">
                        <fa-icon icon="sync" class="mr-05"></fa-icon> {{'TESTMANAGEMENT.UPDATE' | translate}}
                    </button>
                    <button type="button" mat-button mat-raised-button (click)="closeStatusPopover()">
                        <fa-icon icon="times" class="mr-05"></fa-icon>
                        {{'TESTMANAGEMENT.CANCEL' | translate}}
                    </button>
                </div>
            </form>
        </mat-card-content>
    </mat-card>
</sat-popover>