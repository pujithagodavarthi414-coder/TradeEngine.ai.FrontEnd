<div class="p-0 m-0 full-height">
    <mat-card class="p-0 m-0">
        <mat-card-title class="data-table-header drag-handler">
            <div fxLayout="row wrap" fxLayoutGap="0">
                <div fxFlex fxLayoutAlign="start center">
                    <div class="card-title-text pl-05 ml-05">{{ 'PURCHASE.CONFIGCONTRACT' | translate |
                        titlecase}}
                    </div>
                </div>
                <!-- <div fxFlex="50px">
                    <button mat-icon-button matTooltip="{{ 'PURCHASE.ADDNEWCONFIGURATION' | translate }}"
                        (click)="openAddNewConfiguration(null,true)" class="mt-02">
                        <fa-icon icon="plus" class="filter mat-color-accent">
                        </fa-icon>
                    </button>
                </div> -->
                <div fxFlex="210px" fxFlex.xs="60px" class="search_goalinput ml-1" fxLayoutAlign="end center"
                    fxLayoutAlign.xs="start center">
                    <div fxLayoutAlign="end center" fxLayoutAlign.xs="start center">
                        <mat-form-field class="full-width">
                            <input class="search_goal" matInput placeholder="{{'HRMANAGAMENT.SEARCH' | translate}}"
                                [(ngModel)]="searchText" (input)="filterByName($event)">
                        </mat-form-field>
                    </div>
                    <span class="mr-1 shift-timing-close" fxLayoutAlign="end center" fxLayoutAlign.xs="start center">
                        <span *ngIf="!searchText"></span>
                        <mat-icon *ngIf="searchText" class="icon-button mr-05" aria-hidden="false"
                            (click)="closeSearch()" style="cursor:pointer">
                            close</mat-icon>
                    </span>
                    <button mat-icon-button matTooltip="{{ 'PURCHASE.ADDNEWCONFIGURATION' | translate }}"
                        (click)="openAddNewConfiguration(null,true)" class="mt-02">
                        <fa-icon icon="plus" class="filter mat-color-accent">
                        </fa-icon>
                    </button>
                    <div fxFlex="36px"></div>
                </div>
            </div>
            <mat-divider></mat-divider>
        </mat-card-title>
    </mat-card>
    <div class="no-drag" *ngIf="performanceConfigurations.length > 0 && (canAccess_feature_ManagePurchaseContract)">
        <kendo-grid [data]="performanceConfigurationsList" [pageSize]="state.take" [skip]="state.skip" [pageable]="true"
            [sortable]="true" [sort]="state.sort" [filterable]="false" [loading]="isAnyOperationIsInprogress"
            (dataStateChange)="dataStateChange($event)">
            <kendo-grid-column field="purchaseName" title="{{'PURCHASE.PURCHASEENAME' | translate}}">
                <ng-template kendoGridCellTemplate let-dataItem>
                    <b>
                        {{ dataItem.purchaseName }}
                    </b>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="isDraft" title="{{'PURCHASE.ISDRAFT' | translate}}">
                <ng-template kendoGridCellTemplate let-dataItem>
                    <div *ngIf="dataItem.isDraft == false">
                        {{ 'ROSTER.NO' | translate }}
                    </div>
                    <div *ngIf="dataItem.isDraft == true">
                        {{ 'YES' | translate }}
                    </div>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="roleNames" title="{{'ACTIVITYAPPS.ROLES' | translate}}">
                <ng-template kendoGridCellTemplate let-dataItem>
                    <div>
                        {{ dataItem.roleNames }}
                    </div>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="createdBy" title="{{'PURCHASE.CREATEDBY' | translate}}">
                <ng-template kendoGridCellTemplate let-dataItem>
                    <div>
                        {{ dataItem.createdBy }}
                    </div>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="createdOn" title="{{'PURCHASE.CREATEDON' | translate}}">
                <ng-template kendoGridCellTemplate let-dataItem>
                    <div>
                        {{ dataItem.createdDatetime | utcToLocalTime | date: 'dd-MMM-yyyy HH:mm' }}
                    </div>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-command-column title="{{'PURCHASE.ACTIONS' | translate}}">
                <ng-template kendoGridCellTemplate let-dataItem>
                    <fa-icon class="mat-color-accent cursor-pointer mr-1" icon="eye"
                        matTooltip="{{ 'PURCHASE.PREVIEWFORM' | translate}}"
                        (click)="openAddNewConfiguration(dataItem,false)">
                    </fa-icon>
                    <fa-icon class="mat-color-accent cursor-pointer mr-1" icon="edit"
                        matTooltip="{{ 'PURCHASE.EDITCONFIGURATION' | translate}}"
                        (click)="openAddNewConfiguration(dataItem,true)"></fa-icon>
                    <fa-icon class="mat-color-accent cursor-pointer mr-1"
                        [satPopoverAnchorFor]="deleteConfigurationPopover" #deleteConfigurationPopup="satPopoverAnchor"
                        matTooltip="{{ 'PURCHASE.DELETECONFIGURATION' | translate}}"
                        (click)="openDeletePopup(dataItem,deleteConfigurationPopup)" icon="trash">
                    </fa-icon>
                </ng-template>
            </kendo-grid-command-column>
        </kendo-grid>
    </div>
    <app-common-message-box class="no-drag"
        *ngIf="!isAnyOperationIsInprogress && performanceConfigurations.length === 0 && (canAccess_feature_ManagePurchaseContract)"
        textToDisplay="{{'PURCHASE.YOUDONTHAVEANYCREATEDCONFIGURATIONS' | translate}}">
        <ng-template ng-message-tmp>
            <button mat-button mat-raised-button class="mr-05 text-center mt-1" color="primary"
                (click)="openAddNewConfiguration(null,true)">
                <fa-icon class="mr-05" icon="plus"></fa-icon>{{'PURCHASE.CREATENEWCONFIGURATION' | translate}}
            </button>
        </ng-template>
    </app-common-message-box>
</div>

<sat-popover #deleteConfigurationPopover hasBackdrop horizontalAlign="end">
    <mat-card class="p-1">
        <mat-card-title class="text-center">
            <div class="card-title-text mb-1">{{ 'PURCHASE.AREYOUSUREWANTTODELETETHECONFIGURATION' | translate }}
            </div>
        </mat-card-title>
        <div class="text-center">
            <button mat-button mat-raised-button color="primary" class="mr-1" (click)="deleteConfiguration();">
                <fa-icon icon="check" class="mr-05"> </fa-icon> {{ 'YES' | translate }} &nbsp;
            </button>
            <button mat-button mat-raised-button (click)="closeDeletePopup();">
                <fa-icon class="mr-05" icon="times"></fa-icon> {{ 'ROSTER.NO' | translate }}
            </button>
        </div>
    </mat-card>
</sat-popover>

<ng-template #uniquePurchaseDialog let-data>
    <purchase-dialog [data]=[data]></purchase-dialog>
</ng-template>

<app-common-message-box textToDisplay="{{ 'PERMISSIONMESSAGE' | translate }}"
    *ngIf="!(canAccess_feature_ManagePurchaseContract)  && !(roleFeaturesIsInProgress$|async)"
    textToDisplay="{{ 'PERMISSIONMESSAGE' | translate }}">
</app-common-message-box>