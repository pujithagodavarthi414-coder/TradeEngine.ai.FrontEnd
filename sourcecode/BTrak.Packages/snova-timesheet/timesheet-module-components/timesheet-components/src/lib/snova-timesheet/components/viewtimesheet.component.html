<!-- <app-profile-component-viewTimeSheet> </app-profile-component-viewTimeSheet> -->
<ng-container *ngIf="canAccess_feature_ViewTodaysTimesheet">
  <div class="full-height">
    <mat-card class="p-0 m-0 time-sheet">
      <mat-card-title class="data-table-header drag-handler">
        <div fxLayout="row wrap" fxLayout.xs="column" fxLayoutGap="0">
          <div fxFlex fxFlex.xs="100" fxLayoutAlign="start center" fxLayoutAlign.xs="center center">
            <div class="card-title-text p-05">{{'TIMESHEET.VIEWTIMESHEET' | translate | titlecase}}
            </div>
          </div>
          <div fxFlex fxFlex.xs="100" fxLayoutAlign="center center">
            <div>
              <fa-icon matTooltip="{{'TIMESHEET.ONEWEEKBACKWARD' | translate}}"
                (click)="timeSheetDetailsForDay('backward','week')" class="mr-05 style-pointer"
                icon="angle-double-left"></fa-icon>
              <fa-icon matTooltip="{{'TIMESHEET.ONEDAYBACKWARD' | translate}}"
                (click)="timeSheetDetailsForDay('backward','day')" class="mr-05 style-pointer" icon="chevron-left">
              </fa-icon>
              <input matInput [matDatepicker]="picker1" (dateChange)="onDateChange2($event)"
                class="custom-date-picker-width style-pointer" (click)="picker1.open()" [(ngModel)]="dateFrom2"
                [readonly]="true">
              <mat-datepicker #picker1></mat-datepicker>
              <fa-icon matTooltip="{{'TIMESHEET.ONEDAYFORWARD' | translate}}"
                (click)="timeSheetDetailsForDay('forward','day')" class="ml-05 style-pointer" icon="chevron-right">
              </fa-icon>
              <fa-icon matTooltip="{{'TIMESHEET.ONEWEEKFORWARD' | translate}}"
                (click)="timeSheetDetailsForDay('forward','week')" class="ml-05 style-pointer"
                icon="angle-double-right"></fa-icon>
            </div>
            <button mat-button matTooltip="{{'PROJECTS.TODAY' | translate}}" class="ml-05" (click)="getTodaysData()">
              <b>{{'PROJECTS.TODAY' | translate}}</b>
            </button>
          </div>
          <div class="ml-05 mr-05 search_goalinput" fxFlex fxLayoutAlign="end center" fxLayoutAlign.xs="center start"
            fxFlexOffset.xs="10px" fxLayout="row wrap">
            <div fxFlex.gt-xs="150px" fxFlex.lt-lg="100px" class="ml-05 mr-05 search_goalinput"
              fxLayoutAlign="end center" fxLayoutAlign.xs="center center">
              <mat-form-field ngClass.xs="full-width">
                <input class="search_goal" matInput placeholder="{{'SEARCH' | translate}}" [(ngModel)]="searchText"
                  (input)="search()">
              </mat-form-field>
              <span class="close_icon" style="right: 5px !important;">
                <span
                  *ngIf="!searchText">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <mat-icon *ngIf="searchText" class="icon-button" aria-hidden="false" (click)="closeSearch()"
                  style="cursor:pointer">
                  close</mat-icon>
              </span>
            </div>
            <!-- <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center" class="ml-02" *ngIf="!showFilters">
              <button matTooltip="{{ 'GOALS.SHOWFILTERS' | translate }}" mat-icon-button
                (click)="showFilters = !showFilters">
                <fa-icon icon="eye" class="filter mat-color-accent">
                </fa-icon>
              </button>
            </div>
            <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center" class="ml-02" *ngIf="showFilters">
              <button matTooltip="{{ 'GOALS.HIDEFILTERS' | translate }}" mat-icon-button
                (click)="showFilters = !showFilters">
                <fa-icon icon="eye-slash" class="filter mat-color-accent">
                </fa-icon>
              </button>
            </div> -->
            <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center" class="ml-02">
              <button mat-icon-button type="button" [satPopoverAnchorFor]="downloadTimesheetPopover"
                (click)="dateFilterType('day');downloadTimesheetPopover.open()">
                <fa-icon class="icon-button mat-color-accent" icon="download"
                  matTooltip="{{'TIMESHEET.DOWNLOADTIMESHEET' | translate}}"></fa-icon>
                <mat-progress-bar color="primary" mode="indeterminate" *ngIf="downloadInProgress">
                </mat-progress-bar>
              </button>
            </div>
            <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center" class="ml-02">
              <button mat-icon-button matTooltip="{{'BILLINGDASHBOARD.REFRESH' | translate}}" (click)="refreshData()">
                <fa-icon class="filter mat-color-accent" icon="undo"></fa-icon>
              </button>
            </div>
            <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center">
              <button type="submit" mat-icon-button class="pull-right" (click)="filterClick()"
                [matMenuTriggerFor]="filterMenu" matTooltip=" {{'HRMANAGAMENT.ADVANCESEARCH' | translate}}">
                <fa-icon icon="user-cog" class="filter mat-color-accent">
                </fa-icon>
              </button>
            </div>

          </div>
        </div>
      </mat-card-title>
      <mat-divider></mat-divider>
    </mat-card>

    <mat-menu #filterMenu="matMenu" xPosition="before" class="custom-matpanel">
      <mat-card class="filter-data" (click)="$event.stopPropagation()">
        <mat-form-field (click)="$event.stopPropagation()" class="full-width" *ngIf="entities?.length > 1">
          <mat-select placeholder="{{ 'WIDGETS.SELECTBRANCH' | translate }}" [(ngModel)]="selectedEntity"
            (selectionChange)="entityValues($event.value)">
            <mat-option *ngFor="let entity of entities" [value]="entity.id">
              {{entity.name}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field (click)="$event.stopPropagation()" class="full-width">
          <mat-select placeholder="{{ 'TIMESHEET.SHOWTIMEBASEDON' | translate }}" [(ngModel)]="selectedTimeZoneType"
            (selectionChange)="getUserCurrentTimeZone($event.value)">
            <mat-option [value]=0>{{ 'TIMESHEET.ACTUALTIMEZONE' | translate }}</mat-option>
            <mat-option [value]=1>{{ 'TIMESHEET.USERTIMEZONE' | translate }}</mat-option>
          </mat-select>
        </mat-form-field>
      </mat-card>
    </mat-menu>
    <!-- class="activity-data filter-margin viewtimesheet-rows-cursor-pointer m-0 no-drag" -->
    <div class="activity-data filter-margin m-0  viewtimesheet-rows-cursor-pointer app-height-search-2 no-drag"
      id="style-1"
      [ngClass]="fullHeight ?  gridSettings.gridData.total == 0 ? 'timesheet-height2' : 'timesheet-height1' : ''">
      <mat-progress-bar color="primary" mode="indeterminate" *ngIf="downloadExcel">
      </mat-progress-bar>
      <kendo-grid #grid [data]="gridSettings.gridData" [height]="100" [style.cursor]="cursor"
        (cellHover)="cursor = 'pointer'" (cellLeave)="cursor = 'default'" [scrollable]="true"
         (remove)="removeHandler()"
        [pageable]="gridSettings.gridData.total == 0 ? false : true"
        [pageSize]="gridSettings.state ? gridSettings.state.take : 0 " [reorderable]="true"
        (columnReorder)="onReorder($event)" [skip]="gridSettings.state ? gridSettings.state.skip : 0"
        (pageChange)="pageChange($event)" [filterable]="showFilters"
        [filter]="gridSettings.state ? gridSettings.state.filter : null" [sortable]="true"
        [sort]="gridSettings.state ? gridSettings.state.sort : null" [resizable]="true" [columnMenu]="true"
        (dataStateChange)="dataStateChange($event)" (columnVisibilityChange)="onVisibilityChange($event)"
        (columnResize)="onResize($event)">
        <kendo-grid-messages sortAscending="{{ 'KENDOGRIDMESSAGES.SORTASCENDING' | translate }}"
          sortDescending="{{ 'KENDOGRIDMESSAGES.SORTDESCENDING' | translate }}"
          columnsReset="{{ 'KENDOGRIDMESSAGES.COLUMNSRESET' | translate }}"
          columnsApply="{{ 'KENDOGRIDMESSAGES.COLUMNSAPPLY' | translate }}"
          columns="{{ 'KENDOGRIDMESSAGES.COLUMNS' | translate }}"
          filterEqOperator="{{ 'KENDOGRIDMESSAGES.ISEQUALTO' | translate }}"
          filterNotEqOperator="{{ 'KENDOGRIDMESSAGES.ISNOTEQUALTO' | translate }}"
          filterContainsOperator="{{ 'KENDOGRIDMESSAGES.CONTAINS' | translate }}"
          filterNotContainsOperator="{{ 'KENDOGRIDMESSAGES.DOESNOTCONTAIN' | translate }}"
          filterStartsWithOperator="{{ 'KENDOGRIDMESSAGES.STARTSWITH' | translate }}"
          filterEndsWithOperator="{{ 'KENDOGRIDMESSAGES.ENDSWITH' | translate }}"
          filterIsNullOperator="{{ 'KENDOGRIDMESSAGES.ISNULL' | translate }}"
          filterIsNotNullOperator="{{ 'KENDOGRIDMESSAGES.ISNOTNULL' | translate }}"
          filterIsEmptyOperator="{{ 'KENDOGRIDMESSAGES.ISEMPTY' | translate }}"
          filterIsNotEmptyOperator="{{ 'KENDOGRIDMESSAGES.ISNOTEMPTY' | translate }}"
          filterAndLogic="{{ 'KENDOGRIDMESSAGES.AND' | translate }}"
          filterOrLogic="{{ 'KENDOGRIDMESSAGES.OR' | translate }}"
          filterClearButton="{{ 'KENDOGRIDMESSAGES.CLEAR' | translate }}"
          filterFilterButton="{{ 'KENDOGRIDMESSAGES.FILTERBUTTON' | translate }}"
          filter="{{ 'KENDOGRIDMESSAGES.FILTER' | translate }}" pagerItems="{{ 'LEAVESLIST.ITEMS' | translate }}"
          noRecords="{{ 'LEAVESLIST.NODATATODISPLAY' | translate }}">
        </kendo-grid-messages>
        <ng-container *ngFor=" let col of columns">
          <kendo-grid-column [field]="col.field" [title]="col.title | translate | softLabelsPipe : softLabels"
            [hidden]="checkVisibility(col.field)" [filter]="col.type" [filterable]="true" [width]="col.width"
            *ngIf="col.field != 'actions'">
            <!-- <kendo-grid-column [field]="col.field" [title]="col.title | translate | softLabelsPipe : softLabels"
            [hidden]="col.hidden" [filter]="col.type" [filterable]="true" [width]="col.width"
            *ngIf="col.field != 'actions' && col.field != 'activeTimeInMin' && col.field != 'totalActiveTimeInMin' && col.field != 'activitygroup' && col.field != 'productiveTimeInMin' && col.field != 'totalIdleTime' && col.field != 'screenshots'"> -->

            <ng-template kendoGridHeaderTemplate let-column="col">
              <span *ngIf="col.title != 'ACTIVITYTRACKER.SYSTEMUSAGETIME'"
                matTooltip="{{col.title | translate | softLabelsPipe : softLabels}}">{{col.title | translate |
                softLabelsPipe : softLabels}}</span>
              <span *ngIf="col.title == 'ACTIVITYTRACKER.SYSTEMUSAGETIME'"
                matTooltip="as of {{ latestInsertedTrackerDate | utcToLocalTime | date: 'dd MMM yyyy HH:mm' }}">{{col.title |
                translate |
                softLabelsPipe : softLabels}}</span>
            </ng-template>

            <ng-template kendoGridCellTemplate let-dataItem>
              <div *ngIf="col.field == 'employeeName'" class="icon-button cursor-pointer" fxLayout="row"
                (click)="$event.stopPropagation();openDialog(dataItem);">
                <div *ngIf="dataItem.userProfileImage != null && dataItem.userProfileImage != ''">
                  <app-profile-avatar [src]="dataItem.userProfileImage | fetchSizedAndCachedImage: '30':''"
                    [isRound]="true" size="30">
                  </app-profile-avatar>
                </div>
                <div *ngIf="dataItem.userProfileImage == null || dataItem.userProfileImage == ''">
                  <app-profile-avatar [name]="dataItem.employeeName | removeSpecialCharacters" [isRound]="true"
                    size="30">
                  </app-profile-avatar>
                </div>
                <span class="ml-05 mt-02 hide-content-overflow" matTooltip="{{dataItem.employeeName}}"
                  matTooltipShowDelay="400" fxFlex>
                  {{ dataItem?.employeeName }}
                </span>
              </div>
              <div [ngStyle]="{ 'background' : dataItem.leaveStatusColor }" *ngIf="col.field == 'leaveTypeName' && dataItem.leaveTypeName != null"
                    style="border-radius: 15px;text-align: center;" class="cursor-pointer"
                    fxLayoutAlign="center center">
                    <span matTooltip="{{ dataItem.leaveTypeName | translate }}">{{  dataItem.leaveTypeName | translate }}</span>
                </div>
                <div [ngStyle]="{ 'background' : dataItem.leaveStatusColor }" *ngIf="col.field == 'leaveSessionName' && dataItem.leaveSessionName != null"
                    style="border-radius: 15px;text-align: center;" class="cursor-pointer"
                    fxLayoutAlign="center center">
                    <span matTooltip="{{ dataItem.leaveSessionName | translate }}">{{  dataItem.leaveSessionName | translate }}</span>
                </div>
              <div *ngIf="col.field == 'inTime' && dataItem.inTime != null" class="text-underline"
                (click)="openDialog(dataItem);$event.stopPropagation();"
                [ngClass]="{ 'bold-time-sheet': dataItem.isMorningLate }"
                matTooltip="{{ dataItem?.inTime | timeZoneData: 'dd MMM yyyy HH:mm' : currentUserTimeZoneOffset }} {{ dataItem.inTimeAbbreviation | timeZoneName : currentUserTimeZoneAbbr}}">
                {{ dataItem.inTime | timeZoneData: "HH:mm" : currentUserTimeZoneOffset }} <span
                  matTooltip="{{ dataItem.inTimeTimeZone | timeZoneName : currentUserTimeZoneName }}"
                  matTooltipShowDelay="500">{{ dataItem.inTimeAbbreviation | timeZoneName : currentUserTimeZoneAbbr
                  }}</span>
              </div>
              <div *ngIf="col.field == 'outTime' && dataItem.outTime != null" class="text-underline"
                (click)="openDialog(dataItem);$event.stopPropagation();"
                matTooltip="{{dataItem?.outTime | timeZoneData: 'dd MMM yyyy HH:mm' : currentUserTimeZoneOffset }} {{ dataItem.outTimeAbbreviation | timeZoneName : currentUserTimeZoneAbbr }}">
                {{ dataItem.outTime | timeZoneData: "HH:mm" : currentUserTimeZoneOffset }} <span
                  matTooltip="{{dataItem.outTimeTimeZone | timeZoneName : currentUserTimeZoneName }}"
                  matTooltipShowDelay="500">{{ dataItem.outTimeAbbreviation | timeZoneName : currentUserTimeZoneAbbr
                  }}</span>
              </div>
              <div *ngIf="col.field == 'lunchBreakDiff'" (mouseover)="checkLunchBreakTooltip(dataItem)"
                [ngClass]="{ 'bold-time-sheet': dataItem.isAfterNoonLate }" class="text-underline"
                (click)="openDialog(dataItem);$event.stopPropagation();">
                <span [matTooltip]="showLunchBreakTooltip ? lunchToolTipValue : ''" matTooltipClass="tooltip-overflow"
                  matTooltipShowDelay="200"
                  *ngIf="dataItem.lunchBreakEndTime != null">{{dataItem?.lunchBreakDiff}}</span>
                <span [matTooltip]="showLunchBreakTooltip ? lunchToolTipValue : ''" matTooltipClass="tooltip-overflow"
                  matTooltipShowDelay="200"
                  *ngIf="dataItem.lunchBreakEndTime == null && dataItem.lunchBreakStartTime != null">
                  {{dataItem?.lunchBreakStartTime | timeZoneData: "HH:mm" : currentUserTimeZoneOffset }} <span
                    matTooltip="{{dataItem.lunchStartTimeZone | timeZoneName : currentUserTimeZoneName }}"
                    matTooltipShowDelay="500">{{
                    dataItem.lunchStartAbbreviation | timeZoneName : currentUserTimeZoneAbbr }}</span>
                </span>
              </div>
              <div *ngIf="col.field == 'userBreaks' && dataItem.userBreaks != null"
                class="cursor-pointer text-underline" [ngClass]="{ 'bold-time-sheet': dataItem.isBreaksBold }"
                [matTooltip]="dataItem.userBreaksCount > 0 ? ('FEEDTIMESHEET.VIEWBREAKDETAILS' | translate) : ''"
                (click)="$event.stopPropagation();viewUserBreakDetails(dataItem);">
                <span *ngIf="dataItem.userBreaksCount > 0">{{ dataItem.usersBreakTime }}
                  ({{ dataItem.userBreaksCount }})</span>
              </div>
              <div *ngIf="col.field == 'loggedTime'" class="text-underline"
                (click)="openWorkDrillDown(dataItem);$event.stopPropagation();">
                {{ dataItem?.loggedTime | hoursAndMinutes}}
              </div>
              <div *ngIf="col.field == 'leaveReason'"
                matTooltip="{{dataItem?.leaveTypeName}}&nbsp;({{dataItem?.leaveReason}})&nbsp;for&nbsp;{{dataItem?.leaveSessionName}}">
                <span
                  *ngIf="(dataItem.leaveTypeName != null || dataItem.leaveReason != null || dataItem.leaveSessionName != null)">
                  {{ 'YES' | translate }}
                </span>
              </div>
              <div *ngIf="col.field == 'spentTimeDiff'" (click)="openDialog(dataItem);$event.stopPropagation()"
                class="text-underline">
                {{ dataItem?.spentTimeDiff }}
              </div>
              <div *ngIf="col.field == 'activeTimeInMin'" class="text-underline"
                (click)="$event.stopPropagation();openActivityTrackerDetails(dataItem, null)">
                {{ dataItem?.activeTimeInMin | hoursAndMinutes}}
              </div>
              <div *ngIf="col.field == 'productiveTimeInMin'" class="text-underline"
                (click)="$event.stopPropagation();openActivityTrackerDetails(dataItem, 'Productive')">
                {{ dataItem?.productiveTimeInMin | hoursAndMinutes}}
              </div>
              <div *ngIf="col.field == 'totalIdleTime'" class="text-underline"
                (click)="$event.stopPropagation();openActivityTrackerDetails(dataItem, 'SystemBreaks')">
                {{ dataItem?.totalIdleTime | hoursAndMinutes}}
              </div>
              <div *ngIf="col.field == 'screenshots' && canAccess_feature_ViewActivityScreenshots"
                class="text-underline"
                (click)="$event.stopPropagation();openActivityTrackerDetails(dataItem, 'Screenshots')">
                {{ dataItem?.screenshots}}
              </div>
              <div *ngIf="col.field == 'statusName'" [ngStyle]="{ 'background' : dataItem?.statusColour }" style="width :fit-content"
                fxLayoutAlign="center center">
                <span style="width: 150px;" fxFlex fxLayoutAlign="center center" class="hide-content-overflow"><b>{{
                    dataItem.statusName }}</b></span>
              </div>
              <!-- <div *ngIf="col.field == 'createdDateTime' && dataItem.createdDateTime != null">
                {{ dataItem.createdDateTime | utcToLocalTime | date: "HH:mm"}}
              </div> -->
            </ng-template>
          </kendo-grid-column>
          <!-- <kendo-grid-column-group [title]="col.title | translate | softLabelsPipe : softLabels" [hidden]="col.hidden"
            *ngIf="col.field == 'activitygroup'" [columnMenu]="false">
            <ng-container *ngFor=" let groupcol of gridSettings.columnsConfig">
              <kendo-grid-column [field]="groupcol.field" [width]="groupcol.width"
                [title]="groupcol.title | translate | softLabelsPipe : softLabels" [hidden]="groupcol.hidden"
                [filter]="groupcol.type" [filterable]="true" [reorderable]="false"
                *ngIf="groupcol.field == 'activeTimeInMin' || groupcol.field == 'productiveTimeInMin' || groupcol.field == 'totalIdleTime' || (groupcol.field == 'screenshots' && canAccess_feature_ViewActivityScreenshots)">
                <ng-template kendoGridCellTemplate let-dataItem>
                  <div *ngIf="groupcol.field == 'totalActiveTimeInMin'" class="text-underline"
                    (click)="$event.stopPropagation();openActivityTrackerDetails(dataItem)">
                    {{ dataItem?.totalActiveTimeInMin | hoursAndMinutes}}
                    
                  </div>
                  <div *ngIf="groupcol.field == 'activeTimeInMin'" class="text-underline"
                    (click)="$event.stopPropagation();openActivityTrackerDetails(dataItem, null)">
                    {{ dataItem?.activeTimeInMin | hoursAndMinutes}}
                  </div>
                  <div *ngIf="groupcol.field == 'productiveTimeInMin'" class="text-underline"
                    (click)="$event.stopPropagation();openActivityTrackerDetails(dataItem, 'Productive')">
                    {{ dataItem?.productiveTimeInMin | hoursAndMinutes}}
                  </div>
                  <div *ngIf="groupcol.field == 'totalIdleTime'" class="text-underline"
                    (click)="$event.stopPropagation();openActivityTrackerDetails(dataItem, 'SystemBreaks')">
                    {{ dataItem?.totalIdleTime | hoursAndMinutes}}
                  </div>
                  <div *ngIf="groupcol.field == 'screenshots' && canAccess_feature_ViewActivityScreenshots"
                    class="text-underline"
                    (click)="$event.stopPropagation();openActivityTrackerDetails(dataItem, 'Screenshots')">
                    {{ dataItem?.screenshots}}
                  </div>
                </ng-template>
              </kendo-grid-column>
            </ng-container>
          </kendo-grid-column-group> -->
        </ng-container>
        <kendo-grid-command-column title="{{ 'ACTIONS' | translate}}" [width]="100"
          *ngIf="(canAccess_feature_AddOrUpdateTimesheetentry || canAccess_feature_AddPermission)">
          <ng-template kendoGridCellTemplate let-dataItem>
            <button class="text-center" title="{{ 'TIMESHEET.EDIT' | translate}}"
              *ngIf="canAccess_feature_AddOrUpdateTimesheetentry"
              (click)="$event.stopPropagation(); editFeedTimeSheetPopupOpen(dataItem, feedTimeSheetpopup)"
              [satPopoverAnchorFor]="feedTimeSheetPopover" #feedTimeSheetpopup="satPopoverAnchor" mat-icon-button>
              <fa-icon icon="edit" class="mat-color-accent" style="cursor: pointer;"></fa-icon>
            </button>
            <button class="text-center" matTooltip="{{ 'TIMESHEET.PERMISSION' | translate}}"
              *ngIf="canAccess_feature_AddPermission"
              (click)="$event.stopPropagation(); permissionPopupOpen(dataItem, permissionpopup)"
              [satPopoverAnchorFor]="permissionPopover" #permissionpopup="satPopoverAnchor" mat-icon-button>
              <fa-icon icon="clock" class="mat-color-accent" style="cursor: pointer;"></fa-icon>
            </button>
          </ng-template>
        </kendo-grid-command-column>
      </kendo-grid>
      <div [ngClass]="{'k-i-loading': timeSheetLoading}"></div>
    </div>
  </div>
</ng-container>

<sat-popover #feedTimeSheetPopover [autoFocus]="false" hasBackdrop backdropClass="backdrop-color" [restoreFocus]="false"
  [interactiveClose]="false" scrollStrategy="reposition" verticalAlign="below" horizontalAlign="end">
  <mat-card class="p-0 mr-0">
    <app-ts-component-feedtimesheet *ngIf="isEditForFeedTimeSheet" [feedtimesheetpopupdata]="feedtimesheetpopupdata"
      [feedtimesheeteditpopup]="feedtimesheeteditpopup" (closefeedtimesheetPopup)="closeFeedTimeSheetPopover()"
      (submitclosefeedtimesheetPopup)="submitcloseFeedTimeSheetPopover()"
      closetimesheetMonthlyPopup="closetimesheetMonthlyPopup()">
    </app-ts-component-feedtimesheet>
  </mat-card>
</sat-popover>

<sat-popover #absentPopover [autoFocus]="false" hasBackdrop backdropClass="backdrop-color" [restoreFocus]="false"
  [interactiveClose]="false" scrollStrategy="reposition" verticalAlign="below" horizontalAlign="end">
  <mat-card class="p-0 mr-0">
    <app-ts-component-feedtimesheet *ngIf="isEditForAbsentFeedTimeSheet" [absentpopupdata]="absentpopupdata"
      [absentpopup]="absentpopup" (closeabsentPopup)="closeabsentPopover()"
      (submitcloseabsentPopup)="submitcloseabsentPopover()">
    </app-ts-component-feedtimesheet>
  </mat-card>
</sat-popover>

<sat-popover #permissionPopover [autoFocus]="false" hasBackdrop backdropClass="backdrop-color" [restoreFocus]="false"
  [interactiveClose]="false" scrollStrategy="reposition" verticalAlign="below" horizontalAlign="end">
  <mat-card class="p-0 mr-0" style="width: 75%;left: 22%;">
    <app-ts-component-feedtimesheet *ngIf="isEditForPermissionFeedTimeSheet" [permissionpopupdata]="permissionpopupdata"
      [permissionpopup]="permissionpopup" (closepermissionPopup)="closepermissionPopover()">
    </app-ts-component-feedtimesheet>
  </mat-card>
</sat-popover>

<sat-popover #downloadTimesheetPopover [autoFocus]="false" hasBackdrop backdropClass="backdrop-color"
  [restoreFocus]="false" [interactiveClose]="false" scrollStrategy="reposition" verticalAlign="below"
  horizontalAlign="end">
  <mat-card class="filter-data p-0" fxFlex="320px">
    <mat-card-title class="text-center">
      <div class="card-title-text mat-bg-primary p-05">{{'TIMESHEET.DOWNLOADTIMESHEET' | translate}}
      </div>
    </mat-card-title>

    <div class="card-content p-05 mt-05">

      <!-- DAY / WEEK / MONTH FILTER -->
      <div fxLayout="row wrap" fxLayoutAlign="center center" fxFlex.xs="100">
        <div class="mb-05">
          <button mat-raised-button (click)="dateFilterType('day')" color="{{primaryDay}}">{{'ACTIVITYTRACKER.DAY' |
            translate}}</button>
        </div>
        <div class="mb-05">
          <button mat-raised-button (click)="dateFilterType('week')" color="{{primaryWeek}}">{{'ACTIVITYTRACKER.WEEK' |
            translate}}</button>
        </div>
        <div class="mb-05" *ngIf="false">
          <button mat-raised-button (click)="dateFilterType('month')" color="{{primaryMonth}}">{{'ACTIVITYTRACKER.MONTH'
            | translate}}</button>
        </div>
        <div class="mb-05">
          <button mat-raised-button (click)="dateFilterType('daterange')"
            color="{{primaryDateRange}}">{{'ACTIVITYTRACKER.DATERANGE' | translate}}
          </button>
        </div>
      </div>

      <div fxLayout="row wrap" fxLayout.xs="column" fxLayoutGap="0">

        <div *ngIf="day" fxFlex fxLayoutAlign="center center">

          <fa-icon matTooltip="{{'TIMESHEET.ONEWEEKBACKWARD' | translate}}" (click)="navigateTo('backward','week')"
            class="mr-05 style-pointer" icon="angle-double-left"></fa-icon>
          <fa-icon matTooltip="{{'TIMESHEET.ONEDAYBACKWARD' | translate}}" (click)="navigateTo('backward','day')"
            class="mr-05 style-pointer" icon="chevron-left">
          </fa-icon>
          <div fxFlex="29">
            <input matInput [matDatepicker]="picker1" (dateChange)="onDateChange($event)"
              class="custom-date-picker-width style-pointer" (click)="picker1.open()" [(ngModel)]="dateToday"
              [readonly]="true">
            <mat-datepicker #picker1></mat-datepicker>
          </div>
          <fa-icon matTooltip="{{'TIMESHEET.ONEDAYFORWARD' | translate}}" (click)="navigateTo('forward','day')"
            class="ml-05 style-pointer" icon="chevron-right">
          </fa-icon>
          <fa-icon matTooltip="{{'TIMESHEET.ONEWEEKFORWARD' | translate}}" (click)="navigateTo('forward','week')"
            class="ml-05 style-pointer" icon="angle-double-right"></fa-icon>

        </div>

        <div *ngIf="week" fxFlex fxLayoutAlign="center center">
          <fa-icon (click)="getWeekBasedOnDate('left')" class="icon-button" icon="chevron-left"></fa-icon>
          <span class="month-display-elsement">&nbsp;&nbsp;&nbsp;&nbsp;{{selectedWeek | date: "MMM -
            yyyy"}}&nbsp;&nbsp;</span><span *ngIf="weekNumber"
            class="month-display-elsement">W{{weekNumber}}&nbsp;&nbsp;&nbsp;&nbsp;</span>
          <fa-icon (click)="getWeekBasedOnDate('right')" class="icon-button" icon="chevron-right">
          </fa-icon>
        </div>
        <div *ngIf="month" fxFlex fxLayoutAlign="center center">
          <fa-icon (click)="getMonthBasedOnDate('left')" class="icon-button" icon="chevron-left">
          </fa-icon>
          <span class="month-display-elsement">&nbsp;&nbsp;&nbsp;&nbsp;{{selectedMonth | date:
            "MMM-yyyy"}}&nbsp;&nbsp;&nbsp;&nbsp;</span>
          <fa-icon (click)="getMonthBasedOnDate('right')" class="icon-button" icon="chevron-right">
          </fa-icon>
        </div>
        <div *ngIf="dateRange">
          <mat-form-field class="full-width" (click)="$event.stopPropagation();">
            <mat-label>{{ 'PERMISSIONHISTORY.FROMDATE' | translate }}</mat-label>
            <input matInput [matDatepicker]="picker1" autocomplete="off" (click)="picker1.open()"
              (dateChange)="dateFromChanged($event)" class="date-picker" [(ngModel)]="fromDate" [readonly]="true">
            <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
            <mat-datepicker #picker1></mat-datepicker>
          </mat-form-field>

          <mat-form-field class="full-width" (click)="$event.stopPropagation();">
            <mat-label>{{ 'PERMISSIONHISTORY.TODATE' | translate }}</mat-label>
            <input matInput [matDatepicker]="picker2" autocomplete="off" (click)="picker2.open()"
              (dateChange)="dateToChanged($event)" class="date-picker" [(ngModel)]="toDate" [min]="fromDate"
              [readonly]="true">
            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
            <mat-datepicker #picker2></mat-datepicker>
          </mat-form-field>
        </div>

      </div>
      <!-- DAY / WEEK / MONTH FILTER -->

      <!-- 
      <mat-form-field class="full-width" (click)="$event.stopPropagation();">
        <mat-label>{{ 'PERMISSIONHISTORY.FROMDATE' | translate }}
        </mat-label>
        <input matInput [matDatepicker]="picker1" autocomplete="off" (click)="picker1.open()" class="date-picker"
          [(ngModel)]="downloadfromDate" [readonly]="true">
        <mat-datepicker-toggle matSuffix [for]="picker1">
        </mat-datepicker-toggle>
        <mat-datepicker #picker1></mat-datepicker>
      </mat-form-field>
      <mat-form-field class="full-width" (click)="$event.stopPropagation();">
        <mat-label>{{ 'PERMISSIONHISTORY.TODATE' | translate }}
        </mat-label>
        <input matInput [matDatepicker]="picker2" autocomplete="off" (click)="picker2.open()" [min]="downloadfromDate"
          class="date-picker" [(ngModel)]="downloadtoDate" [readonly]="true">
        <mat-datepicker-toggle matSuffix [for]="picker2">
        </mat-datepicker-toggle>
        <mat-datepicker #picker2></mat-datepicker>
      </mat-form-field>
    -->

    </div>
    <div class="text-center mb-1 mt-05">
      <button type="button" mat-button mat-raised-button (click)="downloadFile();downloadTimesheetPopover.close()"
        class="mr-05" color="primary">
        <fa-icon class="mr-05" icon="download"></fa-icon> {{ 'APP.EXPORTDATATOEXCEL' | translate}}
      </button>
      <button type="button" mat-button mat-raised-button (click)="downloadTimesheetPopover.close()">
        <fa-icon class="mr-05" icon="times"></fa-icon> {{'CANCEL' | translate}}
      </button>
    </div>
  </mat-card>
</sat-popover>

<ng-template #openBreakDialogComponent let-data>
  <app-break-timings-display [data]=[data]></app-break-timings-display>
</ng-template>

<ng-template #openMonthlyTimesheetDialogComponent let-data>
  <timesheet-monthly-component-viewTimeSheetMonthly [data]=[data]></timesheet-monthly-component-viewTimeSheetMonthly>
</ng-template>

<ng-template #activityTrackerDialog let-data>
  <app-activity-tracker-dialog [data]=[data]></app-activity-tracker-dialog>
</ng-template>

<ng-template #workDrillDownDialog let-data>
  <app-work-log-drill-down [data]=[data]></app-work-log-drill-down>
</ng-template>

<app-common-message-box *ngIf="!canAccess_feature_ViewTodaysTimesheet"
  textToDisplay="{{ 'MYPROFILE.ALERTMESSAGE' | translate }}">
</app-common-message-box>