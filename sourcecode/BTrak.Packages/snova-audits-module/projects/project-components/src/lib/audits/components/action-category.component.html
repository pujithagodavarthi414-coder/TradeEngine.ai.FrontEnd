<div [ngClass]="{'full-height': canAccess_feature_ViewActionCategory}">
    <mat-card class="p-0 m-0 time-sheet">
        <mat-card-title class="data-table-header drag-handler">
            <div fxLayout="row wrap" fxLayout.xs="column" fxLayoutGap="0">
                <div fxFlex fxFlex.xs="100" fxLayoutAlign="start center" fxLayoutAlign.xs="center center">
                    <div class="card-title-text p-05">{{'AUDIT.ACTIONCATEGORY' | translate | softLabelsPipe :softLabels }}
                    </div>
                </div>
                <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center" class="mr-05">
                    <mat-slide-toggle
                        [matTooltip]="(isArchived == true) ? ('SWITCHTOUNARCHIVE' | translate) : ('SWITCHTOARCHIVE' | translate)"
                        class="archive-switch" [(ngModel)]="isArchived" [checked]="isArchived"
                        (change)="changeArchiveCategory(isArchived)">
                    </mat-slide-toggle>
                </div>
                <div class="h-75" fxFlex="40px" fxFlex.xs="25px" fxFlexOffset.xs="40px" fxLayoutAlign="end center"
                    *ngIf="canAccess_feature_AddOrUpdateActionCategory && canAccess_feature_ViewActionCategory && !isArchived">
                    <button mat-icon-button color="primary" matTooltip="{{'AUDIT.ADDCATEGORY' | translate}}"
                        [satPopoverAnchorFor]="editCategoryPopover" #editCategoryPopUp="satPopoverAnchor"
                        (click)="$event.stopPropagation();openAddPopover(editCategoryPopUp)">
                        <fa-icon class="mat-color-accent icon-button" icon="plus"></fa-icon>
                    </button>
                </div>
                <div fxFlex="135px" fxLayoutAlign="end center" class="search_goalinput mr-05" fxLayout="row wrap"
                    *ngIf="canAccess_feature_ViewActionCategory">
                    <mat-form-field class="full-width">
                        <input class="search_goal" matInput placeholder="{{'BILLINGMANAGEMENT.SEARCH' | translate}}"
                            [(ngModel)]="searchText" (keyup)="searchByInput(searchText)" trim>
                    </mat-form-field>
                    <div fxFlex="20px">
                        <span class="close_icon close_icon_billing" fxLayoutAlign="end center"
                            fxLayoutAlign.xs="start center">
                            <span *ngIf="!searchText"></span>
                            <mat-icon *ngIf="searchText" class="icon-button mr-05" aria-hidden="false"
                                (click)="closeSearch()" style="cursor:pointer">
                                close</mat-icon>
                        </span>
                    </div>
                </div>
            </div>
        </mat-card-title>
        <div class="full-height" *ngIf="canAccess_feature_ViewActionCategory">
            <kendo-grid #grid [kendoGridBinding]="searchText ? tempData : actionCategories" [sortable]="true"
                [pageable]="false" [filterable]="false" [selectable]="true">
                <kendo-grid-messages noRecords="{{'NODATATODISPLAY' | translate}}" pagerItems="{{'ITEMS' | translate}}"
                    pagerOf="{{'OF' | translate}}">
                </kendo-grid-messages>
                <kendo-grid-column field="actionCategoryName">
                    <ng-template kendoGridHeaderTemplate let-column let-columnIndex="columnIndex">
                        {{ 'AUDIT.CATEGORY' | translate }}
                    </ng-template>
                    <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                        <div class="icon-button" fxLayout="row">
                            <span class="hide-content-overflow" matTooltip="{{dataItem.actionCategoryName}}"
                                matTooltipShowDelay="500" fxFlex>
                                {{ dataItem?.actionCategoryName }}
                            </span>
                        </div>
                    </ng-template>
                </kendo-grid-column>
                <kendo-grid-column field="actions" title="{{'ACTIONS' | translate | softLabelsPipe :softLabels }}"
                    *ngIf="(canAccess_feature_AddOrUpdateActionCategory || canAccess_feature_ArchiveOrUnarchiveActionCategory)">
                    <ng-template kendoGridCellTemplate let-dataItem>
                        <button class="text-center mr-05" title="{{'AUDIT.EDITCATEGORY' | translate}}" mat-icon-button
                            [satPopoverAnchorFor]="editCategoryPopover" #editCategoryPopUp="satPopoverAnchor"
                            (click)="editActionCategory(dataItem,editCategoryPopUp)"
                            *ngIf="canAccess_feature_AddOrUpdateActionCategory && !isArchived">
                            <fa-icon icon="edit" style="cursor: pointer;" class="mat-color-accent"></fa-icon>
                        </button>
                        <button *ngIf="(canAccess_feature_ArchiveOrUnarchiveActionCategory) && !isArchived"
                            class="text-center" title="{{ 'AUDIT.ARCHIVECATEGORY' | translate }}"
                            [satPopoverAnchorFor]="deleteCatgeory" #deleteCategoryPopover="satPopoverAnchor"
                            (click)="$event.stopPropagation();deleteCategoryItem(dataItem,deleteCategoryPopover)"
                            mat-icon-button>
                            <!-- <fa-icon icon="archive" style="cursor: pointer;" class="mat-color-accent"></fa-icon> -->
                            <mat-icon style="cursor: pointer;" class="mat-color-accent">archive</mat-icon>
                        </button>
                        <button *ngIf="(canAccess_feature_ArchiveOrUnarchiveActionCategory) && isArchived"
                            class="text-center" title="{{ 'AUDIT.UNARCHIVECATEGORY' | translate }}"
                            [satPopoverAnchorFor]="deleteCatgeory" #deleteCategoryPopover="satPopoverAnchor"
                            (click)="$event.stopPropagation();deleteCategoryItem(dataItem,deleteCategoryPopover)"
                            mat-icon-button>
                            <!-- <fa-icon icon="archive" style="cursor: pointer;" class="mat-color-accent"></fa-icon> -->
                            <mat-icon style="cursor: pointer;" class="mat-color-accent">unarchive</mat-icon>
                        </button>
                    </ng-template>
                </kendo-grid-column>
            </kendo-grid>
            <div [ngClass]="{'k-i-loading': anyOperationIsInprogress}"></div>
        </div>
        <app-common-message-box *ngIf="!(canAccess_feature_ViewActionCategory)"
            textToDisplay="{{ 'PERMISSIONMESSAGE' | translate }}">
        </app-common-message-box>
    </mat-card>
</div>

<sat-popover #editCategoryPopover [autoFocus]="false" hasBackdrop backdropClass="backdrop-color" [restoreFocus]="false"
    [interactiveClose]="false" scrollStrategy="reposition" verticalAlign="below" horizontalAlign="end">
    <mat-card class="filter-data p-0">
        <mat-card-title class="text-center">
            <div class="card-title-text mat-bg-primary p-05">
                <span *ngIf="isEdit">
                    {{'AUDIT.EDITCATEGORY' | translate}}
                </span>
                <span *ngIf="!isEdit">
                    {{'AUDIT.ADDCATEGORY' | translate}}
                </span>
            </div>
        </mat-card-title>
        <form [formGroup]="actionCategoryForm" novalidate #formDirective="ngForm"
            (submit)="actionCategoryForm.valid && upsertActionCategory()">
            <div class="mobile-view-popover p-1">
                <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="10px" fxLayoutGap.xs="0px">
                    <div fxFlex="100" fxFlex.xs="100">
                        <mat-form-field class="full-width">
                            <input formControlName="actionCategoryName" matInput required
                                placeholder="{{'AUDIT.CATEGORYNAME' | translate}}">
                            <mat-error *ngIf="actionCategoryForm.get('actionCategoryName').hasError('required') &&
                            actionCategoryForm.get('actionCategoryName').touched">
                                {{'AUDIT.PLEASEENTERCATEGORY' | translate }}
                            </mat-error>
                            <mat-error *ngIf="actionCategoryForm.get('actionCategoryName').hasError('maxlength')">
                                {{'AUDIT.CATEGORYNAMEEXCEED50' | translate }}
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
            </div>
            <div class="text-center mb-1 prl-1">
                <button mat-raised-button color="primary" type="submit" class="mr-05" [disabled]="upsertInProgress"
                    (click)="$event.stopPropagation()">
                    <mat-progress-bar color="primary" mode="indeterminate" *ngIf="upsertInProgress">
                    </mat-progress-bar>
                    <fa-icon icon="save" class="mr-05"></fa-icon> {{'SAVE' | translate}}
                </button>
                <button mat-raised-button (click)="closePopup()" type="button">
                    <fa-icon icon="times" class="mr-05"></fa-icon> {{'CANCEL' | translate}}
                </button>
            </div>
        </form>
    </mat-card>
</sat-popover>

<!--Delete dialog-->
<sat-popover #deleteCatgeory hasBackdrop backdropClass="backdrop-color" verticalAlign="below" horizontalAlign="end"
    [interactiveClose]="false">
    <mat-card class="p-0">
        <mat-card-title class="text-center mat-bg-primary">
            <div class="card-title-text p-05">{{'TESTMANAGEMENT.CONFIRMATION' | translate}}</div>
        </mat-card-title>
        <mat-card-content>
            <mat-progress-bar color="primary" mode="indeterminate" *ngIf="deleteOperationIsInprogress">
            </mat-progress-bar>
            <div class="card-content p-05" *ngIf="!isArchived">
                {{'AUDIT.AREYOUSUREWANTTOARCHIVEACTIONCATEGORY' | translate | softLabelsPipe :softLabels }}
            </div>
            <div class="card-content p-05" *ngIf="isArchived">
                {{'AUDIT.AREYOUSUREWANTTOUNARCHIVEACTIONCATEGORY' | translate | softLabelsPipe :softLabels }}
            </div>
            <div class="text-center">
                <button *ngIf="!isArchived" class="mr-05" mat-button mat-raised-button color="primary"
                    (click)="removeCategoryAtIndex(true)" [disabled]="deleteOperationIsInprogress">
                    <mat-icon style="cursor: pointer;" class="mr-05">archive</mat-icon>
                    {{'TESTCASETYPE.ARCHIVE' | translate}}
                </button>
                <button *ngIf="isArchived" class="mr-05" mat-button mat-raised-button color="primary"
                    (click)="removeCategoryAtIndex(false)" [disabled]="deleteOperationIsInprogress">
                    <mat-icon style="cursor: pointer;" class="mr-05">unarchive</mat-icon>
                    {{'TESTCASETYPE.UNARCHIVE' | translate}}
                </button>
                <button mat-button mat-raised-button (click)="closeDeleteCategoryDialog();">
                    <fa-icon class="mr-05" icon="times"></fa-icon> {{'TESTMANAGEMENT.CANCEL' | translate}}
                </button>
            </div>
        </mat-card-content>
    </mat-card>
</sat-popover>
<!--Delete dialog-->