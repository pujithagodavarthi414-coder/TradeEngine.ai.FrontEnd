<mat-card class="custom-box mb-0 mt-03 p-0">
    <mat-progress-bar color="primary" mode="indeterminate" *ngIf="(anyOperationInProgress$ | async)">
    </mat-progress-bar>
    <div class="p-0 m-0 audits-category-question-list fit-content-conduct-question-list" id="style-1">
        <div class="p-0 audits-category-questions" *ngIf="loadConductRelatedData">
            <div class="column">
                <div class="testsuite-description">
                    <!-- <div class="ml-05 pull-right" fxLayout="row">
                        <div class="mt-05 mr-05" fxFlex>
                            <span class="pull-right">
                                <fa-icon *ngIf="categorySelected" style="cursor: pointer;"
                                    matTooltip="{{'TESTMANAGEMENT.CLICKHERETOADVANCESEARCH' | translate}}" icon="filter"
                                    class="ml-1 mat-color-accent filter-operation" (click)="filterOpen = !filterOpen">
                                </fa-icon>
                            </span>
                        </div>
                    </div> -->

                    <div class="p-05" fxLayout="row" fxFlex="100" *ngIf="isConductLoaded">
                        <div fxFlex="50">
                            <span>
                                <b>
                                    <span class="word-break user-select-text testsuite-text"
                                        matTooltip="{{'AUDIT.CONDUCTNAME' | translate | softLabelsPipe :softLabels}}">{{selectedConduct.auditConductName}}
                                    </span>
                                    <span class="ml-02 audit-description" *ngIf="selectedConduct.auditDescription &&
                                selectedConduct.auditDescription.length > 0">
                                        (<span class="word-break user-select-text"
                                            [innerHTML]="selectedConduct.auditDescription">
                                        </span>)
                                    </span>
                                </b>
                            </span>
                        </div>
                        <div class="ml-1" fxFlex fxLayoutAlign="end center">
                            <span
                                *ngIf="canAccess_entityType_feature_CanSubmitAuditConduct && isConductSubmitted == false && !isConductArchived">
                                <button *ngIf="categorySelected && isConductEditable" style="height: 35px;"
                                    type="button" mat-button mat-raised-button color="primary"
                                    [satPopoverAnchorFor]="conductSubmit" (click)="openConductSubmitPopover()">
                                    {{'AUDIT.SUBMITCONDUCT' | translate | softLabelsPipe :softLabels}}
                                </button>
                            </span>
                            <span *ngIf="!(isConductSubmitted == false)">
                                <span *ngIf="categorySelected"
                                    class="section-description">{{'RESIDENT.SUBMITTEDBY' | translate}}
                                    <b>{{selectedConduct.updatedByUserName}}</b> -
                                    {{selectedConduct.updatedDateTime | utcToLocalTime | date:'medium'}}
                                </span>
                                <br>
                                <span *ngIf="categorySelected && selectedConduct.auditRatingName"
                                    class="section-description">
                                    <b>{{'AUDIT.RATING' | translate}}</b> -
                                    {{selectedConduct.auditRatingName}}
                                </span>
                            </span>
                        </div>
                        <div fxLayoutAlign="end center">
                            <span class="pull-right">
                                <fa-icon style="cursor: pointer;" matTooltip="{{'AUDIT.AUDITDOCUMENTS' | translate | softLabelsPipe :softLabels}}"
                                    icon="cloud-upload-alt" class="ml-1 mr-1 mat-color-accent filter-operation"
                                    (click)="openAuditDocuments()"
                                    *ngIf="canAccess_entityType_feature_CanAddAndViewAuditLevelDocuments && categorySelected && !isConductArchived">
                                </fa-icon>
                                <fa-icon style="cursor: pointer;" matTooltip="{{'AUDIT.CONDUCTDOCUMENTS' | translate | softLabelsPipe :softLabels}}"
                                    icon="cloud-upload-alt" class="mat-color-accent filter-operation"
                                    (click)="openConductDocuments()"
                                    *ngIf="canAccess_entityType_feature_CanAddAndViewConductLevelDocuments && categorySelected && !isConductArchived">
                                </fa-icon>
                                <fa-icon *ngIf="categorySelected" style="cursor: pointer;"
                                    matTooltip="{{'TESTMANAGEMENT.CLICKHERETOADVANCESEARCH' | translate}}" icon="filter"
                                    class="ml-1 mat-color-accent filter-operation" (click)="filterOpen = !filterOpen">
                                </fa-icon>
                            </span>
                        </div>
                    </div>
                    <div class="p-05">
                        <mat-chip disableRipple matRipple class="mr-08" *ngIf="tagNames">
                            <b>{{'APP.TAGS' | translate}}:&nbsp;</b>
                            {{ tagNames }}
                        </mat-chip>
                    </div>
                </div>
            </div>
            <questions-filter *ngIf="filterOpen" [auditId]="selectedConduct.auditId"
                [conductId]="selectedConduct.conductId" [selectedCategoryData]="categorySelected.auditCategoryId"
                [isAudit]="isAuditOrNot" [isHierarchical]="isHierarchical" [isQuestionsFilter]="questionsFilter">
            </questions-filter>
            <div *ngIf="!(anyOperationInProgress$ | async)">
                <mat-card *ngIf="loadConductCategoryRelatedData != null && !loadConductCategoryRelatedData"
                    class="p-0 mt-05 test-display" fxFlex="100" fxFlex.gt-sm="100">
                    <div fxLayout="row" fxFlex="100">
                        <div fxFlex="100" fxFlex.gt-sm="5" class="p-05">
                            <fa-icon icon="info-circle"></fa-icon>
                        </div>
                        <div fxFlex="100" fxFlex.gt-sm="95" class="p-05">
                            <p class="m-0">
                                {{'AUDIT.THREEARENOCATEGORIESAVILABLEINCONDUCT' | translate | softLabelsPipe :softLabels}}
                            </p>
                        </div>
                    </div>
                </mat-card>
                <div *ngIf="loadConductCategoryRelatedData">
                    <div *ngIf="!isHierarchical">
                        <div class="ml-1 mt-05 testsuite-text" fxLayout="row" *ngIf="isConductCategoryLoaded">
                            <span *ngIf="!categoryName" class="word-break user-select-text"
                                matTooltip="{{'AUDIT.CATEGORYNAME' | translate}}">{{categorySelected.auditCategoryName}}</span>
                            <span *ngIf="categoryName" class="word-break user-select-text"
                                matTooltip="{{'AUDIT.CATEGORYNAME' | translate}}">{{categoryName}}</span>
                            <span matTooltip="{{'AUDIT.QUESTIONSCOUNT' | translate | softLabelsPipe :softLabels}}"
                                class="ml-05 badge-item test-case-count-number">{{questionsCount}}</span>
                        </div>
                        <div *ngIf="isConductCategoryLoaded">
                            <div class="ml-1">
                                <span
                                    *ngIf="!categoryDescription && categorySelected.auditCategoryDescription != null && categorySelected.auditCategoryDescription.length > 0"
                                    class="section-description word-break user-select-text mb-05"
                                    [innerHTML]="categorySelected.auditCategoryDescription"></span>
                                <span *ngIf="categoryDescription"
                                    class="section-description word-break user-select-text mb-05"
                                    [innerHTML]="categoryDescription"></span>
                            </div>
                        </div>
                        <mat-card-content class="p-0 mb-0" *ngIf="isConductCategoryLoaded">
                            <mat-list class="compact-list mb-05">
                                <mat-divider class="mat-divider-position">
                                </mat-divider>
                                <!-- <mat-list-item *ngFor="let question of sampleList" -->
                                <mat-list-item *ngFor="let question of (questions$ | async)">
                                    <question-conduct-case class="full-width" (click)="handleClick(question)"
                                        (questionPreview)="getQuestionStatusPreview($event)"
                                        [selectedConduct]="selectedConduct"
                                        [questionSelected]="question.questionId === selectedQuestionId"
                                        [questionDetails]="question">
                                    </question-conduct-case>
                                </mat-list-item>
                            </mat-list>
                        </mat-card-content>
                    </div>
                    <div class="mt-1" *ngIf="isHierarchical && loadHierarchicalQuestions">
                        <hierarchical-conduct-questions (questionPreview)="getQuestionStatusPreview($event)"
                            [hierarchicalData]="hierarchicalCategoryData" [questionsData]="(questions$ | async)"
                            [selectedConduct]="selectedConduct" [selectedQuestion]="questionFromPreview">
                        </hierarchical-conduct-questions>
                    </div>
                </div>
            </div>
        </div>
        <mat-card *ngIf="isConductLoaded == false" class="p-0 test-display" fxFlex="100" fxFlex.gt-sm="100">
            <div fxLayout="row" fxFlex="100">
                <div fxFlex="100" fxFlex.gt-sm="5" class="p-05">
                    <fa-icon icon="info-circle"></fa-icon>
                </div>
                <div fxFlex="100" fxFlex.gt-sm="95" class="p-05 ml-1">
                    <p class="m-0">
                        {{'AUDIT.SELECTCONDUCTTOVIEWCONTENTS' | translate | softLabelsPipe :softLabels}}
                    </p>
                </div>
            </div>
        </mat-card>
    </div>
</mat-card>

<!-- Submit conduct -->
<sat-popover #conductSubmit hasBackdrop backdropClass="backdrop-color" verticalAlign="below" horizontalAlign="end">
    <mat-card class="p-0">
        <mat-card-title class="text-center mat-bg-primary">
            <div class="card-title-text p-05">{{'TESTMANAGEMENT.CONFIRMATION' | translate}}</div>
        </mat-card-title>
        <mat-card-content class="p-05">
            <form [formGroup]="auditRatingForm" novalidate (submit)="auditRatingForm.valid && submitConduct()">
                <mat-form-field class="full-width mb-05">
                    <mat-select placeholder="{{'AUDIT.RATING' | translate}}" required formControlName="auditRatingId">
                        <mat-option *ngFor="let rating of auditRatings" [value]="rating.auditRatingId">
                            {{rating.auditRatingName}}
                        </mat-option>
                    </mat-select>
                    <mat-error
                        *ngIf="auditRatingForm.get('auditRatingId').hasError('required') && auditRatingForm.get('auditRatingId').touched">
                        {{'AUDIT.PLEASECHOOSERATING' | translate}}
                    </mat-error>
                </mat-form-field>
                <div class="card-content mb-1">
                    {{'AUDIT.AREYOUSURESUBMITCONDUCT' | translate | softLabelsPipe :softLabels}}
                </div>
                <div class="text-center">
                    <button type="submit" class="mr-1" mat-button mat-raised-button color="primary"
                        [disabled]="disableSubmit">
                        <mat-progress-bar color="primary" mode="indeterminate"
                            *ngIf="(submitOperationInProgress$ | async)">
                        </mat-progress-bar>
                        <fa-icon class="mr-05" icon="check"></fa-icon> {{'FEEDBACKS.SUBMIT' | translate}}
                    </button>
                    <button type="button" mat-button mat-raised-button (click)="closeConductSubmitDialog()">
                        <fa-icon class="mr-05" icon="times"></fa-icon> {{'TESTMANAGEMENT.CANCEL' | translate}}
                    </button>
                </div>
            </form>
        </mat-card-content>
    </mat-card>
</sat-popover>
<!-- Submit conduct -->