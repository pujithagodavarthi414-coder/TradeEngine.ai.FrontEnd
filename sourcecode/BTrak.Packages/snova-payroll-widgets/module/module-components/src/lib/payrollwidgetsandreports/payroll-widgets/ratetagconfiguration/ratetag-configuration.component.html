<div class="p-0 m-0 full-height" *ngIf="(canAccess_feature_ManageRateTagConfiguration)">
  <mat-card class="p-0 m-0 canteen-manage">
    <mat-card-title class="data-table-header drag-handler">
      <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="5px" fxLayoutGap.xs="0">
        <div fxFlex class="p-1" fxLayoutAlign.xs="center center">
          {{'RATETAGCONFIGURATION.RATETAGCONFIGURATION' | translate | titlecase}}
        </div>
        <div class="ml-05 mr-05  search_goalinput" fxFlex="33.333" fxLayoutAlign.xs="center center"
          fxLayoutAlign="end center">
          <div class="mt-05" fxFlex="calc(100% - 220px)" fxLayoutAlign="end center" fxLayoutAlign.xs="start center">
            <mat-slide-toggle
              [matTooltip]="(isArchivedType == true) ? ('SWITCHTOUNARCHIVE' | translate) : ('SWITCHTOARCHIVE' | translate)"
              class="mr-1 archive-switch" [(ngModel)]="isArchivedType" [checked]="isArchivedType"
              (change)="getRateTagRoleBranchConfigurations()">
            </mat-slide-toggle>
          </div>
          <button *ngIf="(canAccess_feature_ManageRateTagConfiguration) && !isArchivedType" mat-icon-button
            matTooltip="{{'RATETAGCONFIGURATION.ADDRATETAGCONFIGURATION' | translate}}"
            [satPopoverAnchorFor]="rateTagConfigurationPopover" #rateTagConfigurationPopUp="satPopoverAnchor"
            (click)="createRateTagConfigurationPopupOpen(rateTagConfigurationPopUp)">
            <fa-icon icon="plus" class="filter mat-color-accent">
            </fa-icon>
          </button>
        </div>
      </div>
      <mat-divider></mat-divider>
    </mat-card-title>
  </mat-card>
  <div class="activity-data no-drag" style="overflow-x: hidden;">
    <div fxLayout="row wrap" fxFlex="100">
      <div fxFlex="23" fxFlex.lt-sm="100" fxLayoutAlign="start start">
        <mat-card class="goalList-popup p-0 custom-box mat-card full-width rolebranch-ratetag-card" id="style-1"
          *ngIf="rateTagConfigurationList.length > 0 && !rateTagConfigurationsLoading">
          <mat-list class="compact-list ratetagconfigurations-list">
            <div fxLayout="row wrap" fxFlex="100" fxLayoutGap="2px"
              *ngFor="let rateTagConfiguration of rateTagConfigurationList" class="configuration-list"
              [ngStyle]="{ 'background-color': rateTagConfiguration.rateTagRoleBranchConfigurationId === rateTagRoleBranchConfigurationHighLightId ? '#e6f5ff': '' }">
              <div class="hide-content-overflow" fxFlex="78" fxFlex.lt-lg="70" fxFlex.lg="70" fxFlex.md="70"
                fxFlex.sm="100" fxFlex.xs="100" (click)="selectedRateTagConfiguration(rateTagConfiguration)">
                <p class="mat-body-2 pl-05">
                  <b>{{'PAYROLL.PAYROLLSTARTDATE' | translate}}: </b>
                  <span matTooltip="{{rateTagConfiguration.startDate | date: 'dd-MMM-yyyy'}}">
                    {{ rateTagConfiguration.startDate | date: "dd-MMM-yyyy" }}
                  </span>
                </p>
                <p class="mat-body-2 pl-05">
                  <b>{{'PAYROLL.PAYROLLENDDATE' | translate}}: </b>
                  <span matTooltip="{{rateTagConfiguration.endDate | date: 'dd-MMM-yyyy'}}">
                    {{ rateTagConfiguration.endDate | date: "dd-MMM-yyyy" }}
                  </span>
                </p>
                <p class="mat-body-2 pl-05">
                  <b>{{'PAYROLLCALCULATIONCONFIGURATIONS.BRANCH' | translate}}: </b>
                  <span matTooltip="{{rateTagConfiguration.branchName}}">{{ rateTagConfiguration.branchName }}</span>
                </p>
                <p class="mat-body-2 pl-05">
                  <b>{{'PAYROLLROLECONFIGURATION.ROLENAME' | translate}}: </b>
                  <span matTooltip="{{rateTagConfiguration.roleName}}">{{ rateTagConfiguration.roleName }}</span>
                </p>
                <p class="mat-body-2 pl-05">
                  <b>{{'TESTMANAGEMENT.PRIORITY' | translate}}: </b>
                  <span matTooltip="{{rateTagConfiguration.priority}}">{{ rateTagConfiguration.priority }}</span>
                </p>
              </div>
              <div class="hide-content-overflow" fxFlex="21" fxFlex.lt-lg="29" fxFlex.lg="29" fxFlex.md="29"
                fxFlex.sm="100" fxFlex.xs="100" fxLayoutAlign="end start">
                <button fxLayoutAlign="end center" *ngIf="isArchivedType != true" mat-icon-button
                  matTooltip="{{'RATETAGCONFIGURATION.EDITRATETAGCONFIGURATION' | translate}}"
                  [satPopoverAnchorFor]="rateTagConfigurationPopover" #rateTagConfigurationPopUp="satPopoverAnchor"
                  (click)="editRateTagConfigurationPopupOpen(rateTagConfiguration,rateTagConfigurationPopUp)">
                  <mat-icon style="cursor: pointer;font-size: 18px" class="mat-color-accent mr-05">edit</mat-icon>
                </button>
                <button fxLayoutAlign="end center" *ngIf="isArchivedType != true" mat-icon-button
                  [satPopoverAnchorFor]="deleteRateTagConfigurationPopover"
                  #deleteRateTagConfigurationPopUp="satPopoverAnchor"
                  matTooltip="{{'RATETAGCONFIGURATION.ARCHIVERATETAGCONFIGURATION' | translate }}"
                  (click)="deleteRateTagConfigurationPopUpOpen(rateTagConfiguration,deleteRateTagConfigurationPopUp);">
                  <mat-icon style="cursor: pointer; font-size: 18px;" class="mat-color-accent mr-05">archive</mat-icon>
                </button>
                <button *ngIf="isArchivedType == true" mat-icon-button
                  [satPopoverAnchorFor]="deleteRateTagConfigurationPopover"
                  #deleteRateTagConfigurationPopUp="satPopoverAnchor"
                  matTooltip="{{'RATETAGCONFIGURATION.UNARCHIVERATETAGCONFIGURATION' | translate }}"
                  (click)="deleteRateTagConfigurationPopUpOpen(rateTagConfiguration,deleteRateTagConfigurationPopUp);">
                  <mat-icon style="cursor: pointer;font-size: 18px" class="mat-color-accent mr-05">unarchive</mat-icon>
                </button>
              </div>
            </div>
          </mat-list>
        </mat-card>
        <app-common-message-box *ngIf="rateTagConfigurationList.length == 0 && !rateTagConfigurationsLoading"
          textToDisplay="{{'NODATATODISPLAY'|translate}}">
        </app-common-message-box>
        <app-common-message-box *ngIf="rateTagConfigurationsLoading" textToDisplay="{{'LOADING'|translate}}...">
        </app-common-message-box>
      </div>
      <div fxFlex="77" fxFlex.lg="77" fxFlex.md="60" fxFlex.lt-sm="100" class="activity-data no-drag">
        <mat-card class="p-0 m-0 canteen-manage">
          <mat-card-title class="data-table-header drag-handler">
            <div fxLayout.xs="column" fxLayoutGap="5px" fxLayoutGap.xs="0">
              <div fxFlex class="p-1" fxLayoutAlign.xs="center center">
                {{'RATETAG.RATETAGS' | translate}}
              </div>
              <div class="ml-05 mr-05 search_goalinput" fxFlex="33.333" fxLayoutAlign.xs="center center"
                fxLayoutAlign="end center">
                <mat-form-field ngClass.xs="full-width">
                  <input class="search_goal" matInput placeholder="{{'SEARCH' | translate}}" [(ngModel)]="searchText"
                    (input)="filterByName($event)">
                </mat-form-field>
                <span class="close_icon">
                  <span *ngIf="!searchText">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                  <mat-icon *ngIf="searchText" class="icon-button" aria-hidden="false" (click)="closeSearch()"
                    style="cursor:pointer">
                    close</mat-icon>
                </span>
                <button
                  *ngIf="(canAccess_feature_ManageRateTagConfiguration) && !isArchivedType && rateTagsListCount == 0"
                  mat-icon-button matTooltip="{{'RATETAG.ADDRATETAGS' | translate}}" (click)="openDialog(null)">
                  <fa-icon icon="plus" class="filter mat-color-accent">
                  </fa-icon>
                </button>
                <button
                  *ngIf="(canAccess_feature_ManageRateTagConfiguration) && !isArchivedType && (rateTagsListCount > 0)"
                  mat-icon-button matTooltip="{{'RATETAG.EDITRATETAGS' | translate}}"
                  (click)="openDialog(rateTagsList)">
                  <fa-icon icon="edit" class="filter mat-color-accent">
                  </fa-icon>
                </button>
              </div>
            </div>
            <mat-divider></mat-divider>
          </mat-card-title>
        </mat-card>
        <div>
          <ngx-datatable class="material bg-white" [rows]="rateTagsList" [columnMode]="'force'" [headerHeight]="35"
            [footerHeight]="35" [rowHeight]="35" [scrollbarH]="true" [loadingIndicator]="rateTagsLoading"
            [messages]="{emptyMessage:('NODATATODISPLAY' | translate), totalMessage: 'TOTAL' | translate}" [limit]="10">
            <ngx-datatable-column name="{{'RATETAG.RATETAGTITLENAME' | translate}}" [flexGrow]="1" [sortable]="true"
              prop="rateTagName">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row?.rateTagName }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="{{'RATETAG.RATETAGTYPE' | translate}}" [flexGrow]="1" [sortable]="true"
              prop="rateTagForNames">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row?.rateTagForNames }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="{{'RATETAG.RATEPERHOURSHORT' | translate}}" [flexGrow]="1" [sortable]="true"
              prop="ratePerHour">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row?.ratePerHour| currency: row.rateTagCurrencyCode }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="{{'RATETAG.RATEPERHOURMONSHORT' | translate}}" [flexGrow]="1" [sortable]="true"
              prop="ratePerHourMon">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row?.ratePerHourMon| currency: row.rateTagCurrencyCode }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="{{'RATETAG.RATEPERHOURTUESHORT' | translate}}" [flexGrow]="1" [sortable]="true"
              prop="ratePerHourTue">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row?.ratePerHourTue| currency: row.rateTagCurrencyCode }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="{{'RATETAG.RATEPERHOURWEDSHORT' | translate}}" [flexGrow]="1" [sortable]="true"
              prop="ratePerHourWed">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row?.ratePerHourWed| currency: row.rateTagCurrencyCode }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="{{'RATETAG.RATEPERHOURTHUSHORT' | translate}}" [flexGrow]="1" [sortable]="true"
              prop="ratePerHourThu">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row?.ratePerHourThu| currency: row.rateTagCurrencyCode }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="{{'RATETAG.RATEPERHOURFRISHORT' | translate}}" [flexGrow]="1" [sortable]="true"
              prop="ratePerHourFri">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row?.ratePerHourFri | currency: row.rateTagCurrencyCode}}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="{{'RATETAG.RATEPERHOURSATSHORT' | translate}}" [flexGrow]="1" [sortable]="true"
              prop="ratePerHourSat">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row?.ratePerHourSat| currency: row.rateTagCurrencyCode }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="{{'RATETAG.RATEPERHOURSUNSHORT' | translate}}" [flexGrow]="1" [sortable]="true"
              prop="ratePerHourSun">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row?.ratePerHourSun| currency: row.rateTagCurrencyCode }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="{{'RATETAG.PRIORITY' | translate}}" [flexGrow]="1" [sortable]="true"
              prop="priority">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row?.priority }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="{{ 'ACTIONS' | translate }}" [flexGrow]="1" [sortable]="false" [width]="150">
              <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                <button class="text-center" matTooltip="{{'RATETAG.DELETERATETAG' | translate}}"
                  (click)=" getRateTagDetailsId(row,deleteRateTagPopUp)" [satPopoverAnchorFor]="deleteRateTagPopover"
                  #deleteRateTagPopUp="satPopoverAnchor" mat-icon-button>
                  <fa-icon icon="trash" class="mat-color-accent"></fa-icon>
                </button>
              </ng-template>
            </ngx-datatable-column>
          </ngx-datatable>
        </div>
      </div>
    </div>
  </div>
</div>
<mat-card class="p-0 m-0 edit_employee full-height" *ngIf="!(canAccess_feature_ManageRateTagConfiguration)">
  <mat-card-title class="data-table-header drag-handler">
    <div class="p-1" fxLayout="row wrap">
      <div fxFlex>
        {{'RATETAG.RATETAGTITLE' | translate }}
      </div>
    </div>
    <mat-divider></mat-divider>
  </mat-card-title>
  <mat-card-content>
    <app-common-message-box textToDisplay="{{ 'PERMISSIONMESSAGE' | translate }}">
    </app-common-message-box>
  </mat-card-content>
</mat-card>
<app-common-message-box *ngIf="!(canAccess_feature_ManageRateTag)"
  textToDisplay="{{ 'PERMISSIONMESSAGE' | translate }}">
</app-common-message-box>
<sat-popover backdropClass="backdrop-color" #rateTagConfigurationPopover [autoFocus]="false" hasBackdrop
  [restoreFocus]="false" [interactiveClose]="false" scrollStrategy="reposition" verticalAlign="below"
  horizontalAlign="start">
  <mat-card class="p-0 mr-0" fxFlex.gt-sm="400px">
    <mat-card-title class="text-center">
      <div class="card-title-text  mat-bg-primary p-05 mb-1">
        {{ rateTagConfigurationText | translate}}
      </div>
    </mat-card-title>
    <mat-card-content class="P-05">
      <form [formGroup]="rateTagConfigurationForm" #formDirective="ngForm" novalidate
        (submit)="rateTagConfigurationForm.valid && UpsertRateTagRoleBranchConfiguration(formDirective)">
        <div>
          <div fxLayout="row wrap" fxLayoutGap="5px" class="p-05">
            <div fxFlex="98.5">
              <mat-form-field class="full-width">
                <mat-select placeholder="{{'PAYROLLBRANCHCONFIGURATION.BRANCHNAME' | translate}}"
                  formControlName="branchId">
                  <mat-option *ngFor="let branch of branchList" [value]="branch.branchId">
                    {{ branch.branchName }}
                  </mat-option>
                </mat-select>
                <mat-error class="P-06"
                  *ngIf="rateTagConfigurationForm.get('branchId').hasError('required') && rateTagConfigurationForm.get('branchId').touched">
                  {{ 'PAYROLLBRANCHCONFIGURATION.REQUIREDBRANCHERROR' | translate }}
                </mat-error>
              </mat-form-field>
            </div>
            <div fxFlex="98.5">
              <mat-form-field class="full-width">
                <mat-select placeholder="{{'PAYROLLROLECONFIGURATION.ROLENAME' | translate}}" formControlName="roleId">
                  <mat-option *ngFor="let role of rolesList" [value]="role.roleId">
                    {{ role.roleName }}
                  </mat-option>
                </mat-select>
                <mat-error class="P-06"
                  *ngIf="rateTagConfigurationForm.get('roleId').hasError('required') && rateTagConfigurationForm.get('roleId').touched">
                  {{ 'PAYROLLROLECONFIGURATION.REQUIREDROLEERROR' | translate }}
                </mat-error>
              </mat-form-field>
            </div>
            <div fxFlex="98.5">
              <mat-form-field class="full-width">
                <input matInput formControlName="startDate" [matDatepicker]="picker1" (click)="picker1.open()"
                  placeholder="{{'RATETAG.RATESTARTDATE' | translate}}" autocomplete="off" required>
                <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                <mat-datepicker #picker1></mat-datepicker>
              </mat-form-field>
            </div>
            <div fxFlex="98.5">
              <mat-form-field class="full-width">
                <input matInput formControlName="endDate" [matDatepicker]="picker2"
                  [min]="rateTagConfigurationForm.get('startDate').value" (click)="picker2.open()"
                  placeholder="{{'RATETAG.RATEENDDATE' | translate}}" autocomplete="off" required>
                <mat-datepicker-toggle matSuffix [for]="picker2"> </mat-datepicker-toggle>
                <mat-datepicker #picker2></mat-datepicker>
              </mat-form-field>
            </div>
            <div fxFlex="98.5">
              <mat-form-field class="full-width">
                <input matInput formControlName="priority" placeholder="{{ 'TESTMANAGEMENT.PRIORITY' | translate }}"
                  type="number" required>
                <mat-error
                  *ngIf="rateTagConfigurationForm.get('priority').hasError('required') && rateTagConfigurationForm.get('priority').touched">
                  {{ 'RATETAGCONFIGURATION.PRIORITYISREQUIRED' | translate }}
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div class="mt-1 mb-05 text-center">
            <button type="submit" mat-button mat-raised-button color="primary" class="mr-1"
              [disabled]="!rateTagConfigurationForm.valid||isAnyOperationIsInprogress">
              <mat-progress-bar color="primary" mode="indeterminate" *ngIf="isAnyOperationIsInprogress">
              </mat-progress-bar>
              <fa-icon class="mr-05" icon="check"></fa-icon> {{ 'SAVE' | translate }}
            </button>
            <button mat-button mat-raised-button (click)="closeUpsertRateTagConfigurationPopup(formDirective)"
              type="button">
              <fa-icon class="mr-05" icon="times"></fa-icon>
              {{ 'CANCEL' | translate }}
            </button>
          </div>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</sat-popover>

<sat-popover #deleteRateTagPopover [autoFocus]="false" hasBackdrop backdropClass="backdrop-color" [restoreFocus]="false"
  [interactiveClose]="false" scrollStrategy="reposition" verticalAlign="below" horizontalAlign="end">
  <mat-card class="p-0">
    <mat-card-title class="text-center">
      <div class="card-title-text mat-bg-primary p-05">{{'RATETAG.DELETERATETAGDETAILS' | translate}}</div>
    </mat-card-title>
    <div class="card-content p-1">
      <div class="text-center mb-1">{{'RATETAG.AREYOUSUREWANTTODELETE' | translate}}
      </div>
      <div fxLayoutAlign="space-around center">
        <button type="button" mat-button mat-raised-button class="mr-05" color="primary"
          (click)="deleteRateTagDetail();"><i class="fa fa-check"></i>{{'YES' | translate}}</button>
        <button type="button" mat-button mat-raised-button (click)="cancelRateTagDetails()"><i
            class="fa fa-times"></i>{{'NO' | translate}}</button>
      </div>
    </div>
  </mat-card>
</sat-popover>

<sat-popover backdropClass="backdrop-color" #deleteRateTagConfigurationPopover hasBackdrop
  backdropClass="backdrop-color" verticalAlign="below" horizontalAlign="end">
  <mat-card class="p-0">
    <mat-card-title class="text-center mat-bg-primary">
      <div class="card-title-text mb-1" *ngIf="!isArchivedType">
        {{'RATETAGCONFIGURATION.ARCHIVERATETAGCONFIGURATION' | translate}}</div>
      <div class="card-title-text mb-1" *ngIf="isArchivedType">
        {{'RATETAGCONFIGURATION.UNARCHIVERATETAGCONFIGURATION'| translate}}</div>
    </mat-card-title>
    <mat-card-content>
      <div class="card-content mb-1" *ngIf="!isArchivedType">
        {{'RATETAGCONFIGURATION.AREYOUSUREWANTTOARCHIVE'| translate}}
      </div>
      <div class="card-content mb-1" *ngIf="isArchivedType">
        {{'RATETAGCONFIGURATION.AREYOUSUREWANTTOUNARCHIVE' | translate}}
      </div>
      <div class="text-center">
        <button class="mr-1" mat-button mat-raised-button color="primary" *ngIf="!isArchivedType"
          [disabled]="isAnyOperationIsInprogress" (click)="archiveRateTagConfiguration();">
          <mat-icon style="cursor: pointer;">archive</mat-icon> {{ 'ARCHIVE' | translate }}
        </button>
        <button class="mr-1" mat-button mat-raised-button color="primary" *ngIf="isArchivedType"
          [disabled]="isAnyOperationIsInprogress" (click)="archiveRateTagConfiguration();">
          <fa-icon class="mr-05" icon="check"></fa-icon> {{ 'YES' | translate }}
        </button>
        <button [disabled]="isAnyOperationIsInprogress" mat-button mat-raised-button
          (click)="closeDeleteRateTagConfigurationPopUpOpen();">
          <fa-icon class="mr-05" icon="times"></fa-icon> {{ 'CANCEL' | translate }}
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</sat-popover>