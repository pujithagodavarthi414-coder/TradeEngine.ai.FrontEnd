<ng-container *ngIf="(canAccess_feature_ApproveOrRejectTimesheet)">
  <div class="full-height">
    <mat-card class="p-0 m-0 time-sheet">
      <mat-card-title class="data-table-header drag-handler">
        <div fxLayout="row wrap" fxLayout.xs="column" fxLayoutGap="0">
          <div fxFlex fxFlex.xs="100" fxLayoutAlign="start center" fxLayoutAlign.xs="center center">
            <div class="card-title-text p-05">{{'TIMESHEETSUBMISSION.TIMESHEETSWAITING' | translate | titlecase}}
            </div>
          </div>
          <div class="mr-05 search_goalinput" fxFlex="180px" fxFlex.xs="100" fxFlexOffset.xs="20px">
            <mat-form-field fxLayoutAlign="end center" fxLayoutAlign.xs="start center">
              <input class="search_goal" matInput placeholder="{{'SEARCH' | translate}}" [(ngModel)]="searchText"
                (input)="filterByName($event)">
            </mat-form-field>
            <span class="custom_close_icon">
              <span *ngIf="!searchText">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <mat-icon *ngIf="searchText" class="icon-button" aria-hidden="false" (click)="closeSearch()"
                style="cursor:pointer">
                close</mat-icon>
            </span>
          </div>
          <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center">
            <button type="submit" mat-icon-button (click)="filterClick()" [matMenuTriggerFor]="filterMenu">
              <fa-icon matTooltip="{{'WIDGETS.CONFIGUREAPPSETTINGS' | translate}}" icon="user-cog"
                class="filter mat-color-accent">
              </fa-icon>
            </button>
          </div>
          <mat-menu #filterMenu="matMenu" xPosition="before" class="custom-matpanel">
            <mat-card class="filter-data" (click)="$event.stopPropagation()">
              <mat-form-field class="full-width">
                <mat-select placeholder="{{ 'PRODUCTIVITYDASHBOARD.SELECTEMPLOYEE' | translate}}"
                  [(ngModel)]="selectedUser" (selectionChange)="statusValues($event.value)">
                  <mat-option *ngFor="let employee of userDropdown" value="option" [value]="employee.userId">
                    <app-avatar class="employee_img" *ngIf="!employee.profileImage"
                      (click)="goToUserProfile(employee.userId);$event.stopPropagation()"
                      [name]="employee.userName | removeSpecialCharacters" [isRound]="true" size="30">
                    </app-avatar>
                    <img class="employee_img" src="{{employee.profileImage}}"
                      (click)="goToUserProfile(employee.userId);$event.stopPropagation()" *ngIf="employee.profileImage">
                    {{employee.userName}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </mat-card>
          </mat-menu>
          <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center" class="ml-02">
            <button mat-icon-button (click)="reset()">
              <fa-icon matTooltip="{{'RESET' | translate}}" class="filter mat-color-accent" icon="undo"></fa-icon>
            </button>
          </div>
        </div>
      </mat-card-title>
    </mat-card>
    <div class="activity-data filter-margin viewtimesheet-rows-cursor-pointer m-0 no-drag">
      <kendo-grid [kendoGridBinding]="timeSheetSubmissions"  [filterable]="false"
        [selectable]="false" [pageSize]="state.take" [skip]="state.skip" [sort]="state.sort" [sortable]="true"
        [pageable]="true">
        <kendo-grid-column field="timeSheetTitle" title="{{'TIMESHEETSUBMISSION.TIMESHEETNAME' | translate}}"
          [style]="{'cursor':'default'}">
        </kendo-grid-column>
        <kendo-grid-column field="userName" title="{{'TIMESHEETSUBMISSION.EMPLOYEENAME' | translate}}"
          [style]="{'cursor':'default'}">
          <ng-template kendoGridHeaderTemplate let-column let-columnIndex="columnIndex">
            Employee name
          </ng-template>
          <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
            <div class="icon-button" fxLayout="row">
              <div *ngIf="dataItem.profileImage != null && dataItem.profileImage != ''"
                (click)="goToUserProfile(dataItem.userId);$event.stopPropagation()">
                <app-avatar [src]="dataItem.profileImage | fetchSizedAndCachedImage: '30':''" [isRound]="true"
                  size="30">
                </app-avatar>
              </div>
              <div *ngIf="dataItem.profileImage == null || dataItem.profileImage == ''"
                (click)="goToUserProfile(dataItem.userId);$event.stopPropagation()">
                <app-avatar [name]="dataItem.userName | removeSpecialCharacters" [isRound]="true" size="30">
                </app-avatar>
              </div>
              <span class="ml-05 hide-content-overflow" matTooltip="{{dataItem.userName}}" matTooltipShowDelay="400"
                fxFlex>
                {{ dataItem?.userName }}
              </span>
            </div>
          </ng-template>
        </kendo-grid-column>
        <kendo-grid-command-column field="action" title="{{'ACTIONS' | translate}}">
          <ng-template kendoGridCellTemplate let-dataItem>
            <button class="text-center" title="{{'TIMESHEETSUBMISSION.APPROVETIMESHEET' | translate}}" mat-icon-button
              [satPopoverAnchorFor]="approvePopOver" #approvePopUp="satPopoverAnchor"
              (click)="openPopup(dataItem,approvePopUp);$event.stopPropagation()">
              <fa-icon icon="thumbs-up" class="mr-05" class="mat-color-accent"></fa-icon>
            </button>
            <button class="text-center" title="{{'TIMESHEETSUBMISSION.REJECTEDTIMESHEET' | translate}}" mat-icon-button
              [satPopoverAnchorFor]="rejectedPopOver" #editReasonPopUp="satPopoverAnchor"
              (click)="editReason(dataItem,editReasonPopUp);$event.stopPropagation()">
              <fa-icon icon="thumbs-down" style="cursor: pointer;" class="mat-color-accent"></fa-icon>
            </button>
            <button class="text-center" matTooltip="{{'TIMESHEETSUBMISSION.VIEWTIMESHEET' | translate}}" mat-icon-button
              (click)="openDialog($event,dataItem);$event.stopPropagation();">
              <fa-icon icon="eye" style="cursor: pointer;" class="mat-color-accent"></fa-icon>
            </button>
          </ng-template>
        </kendo-grid-command-column>
      </kendo-grid>
      <div *ngIf="loadingIndicator" class="k-i-loading"></div>
    </div>
  </div>
</ng-container>

<sat-popover #rejectedPopOver [autoFocus]="false" hasBackdrop backdropClass="backdrop-color" [restoreFocus]="false"
  [interactiveClose]="false" scrollStrategy="reposition" verticalAlign="below" horizontalAlign="end">
  <mat-card class="filter-data p-0">
    <mat-card-title class="text-center">
      <div class="card-title-text mat-bg-primary p-05">
        {{'TIMESHEETSUBMISSION.REJECTEDREASON' | translate}}</div>
    </mat-card-title>
    <mat-card-content>
      <textarea matInput rows="3" [(ngModel)]="reason"
        placeholder="{{'TIMESHEETSUBMISSION.REASON' | translate}}"></textarea>
    </mat-card-content>
    <div class="text-center mb-1 prl-1">
      <button mat-raised-button color="primary" mat-raised-button (click)="openRejctedPopup(rejectedReasonPopUp)"
        type="reset" [satPopoverAnchorFor]="rejectedMessagePopOver" #rejectedReasonPopUp="satPopoverAnchor"
        [disabled]="loadingIndicator">
        <fa-icon icon="plus" class="mr-05"></fa-icon> {{'SAVE' | translate}}
      </button>
      <button mat-raised-button (click)="closePopup()" type="reset" [disabled]="loadingIndicator" class="ml-05">
        <fa-icon icon="times" class="mr-05"></fa-icon> {{'CANCEL' | translate}}
      </button>
    </div>
  </mat-card>
</sat-popover>

<sat-popover backdropClass="backdrop-color" #approvePopOver hasBackdrop backdropClass="backdrop-color"
  verticalAlign="below" horizontalAlign="end">
  <mat-card class="p-0">
    <mat-card-title class="text-center mat-bg-primary">
      <div class="card-title-text mb-1"> Approve time sheet</div>
    </mat-card-title>
    <mat-card-content>
      <div class="card-content mb-1">
        Are you sure want to aprrove the time sheet?
      </div>
      <div class="text-center">
        <button class="mr-1" mat-button mat-raised-button color="primary" [disabled]="loadingIndicator"
          (click)="approveTimeSheet();">
          <fa-icon class="mr-05" icon="check"></fa-icon> {{ 'YES' | translate }}
        </button>
        <button mat-button mat-raised-button (click)="closeApproverPopUp();">
          <fa-icon class="mr-05" icon="times"></fa-icon> {{ 'CANCEL' | translate }}
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</sat-popover>

<sat-popover backdropClass="backdrop-color" #rejectedMessagePopOver hasBackdrop backdropClass="backdrop-color"
  verticalAlign="below" horizontalAlign="end">
  <mat-card class="p-0">
    <mat-card-title class="text-center mat-bg-primary">
      <div class="card-title-text mb-1">Reject time sheet</div>
    </mat-card-title>
    <mat-card-content>
      <div class="card-content mb-1">
        Are you sure want to reject the time sheet?
      </div>
      <div class="text-center">
        <button class="mr-1" mat-button mat-raised-button color="primary" [disabled]="loadingIndicator"
          (click)="rejectTimeSheet();">
          <fa-icon class="mr-05" icon="check"></fa-icon> {{ 'YES' | translate }}
        </button>
        <button mat-button mat-raised-button (click)="closerejectedMessgaePopUp();">
          <fa-icon class="mr-05" icon="times"></fa-icon> {{ 'CANCEL' | translate }}
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</sat-popover>

<app-common-message-box *ngIf="!(canAccess_feature_ApproveOrRejectTimesheet)"
  textToDisplay="{{ 'MYPROFILE.ALERTMESSAGE' | translate }}">
</app-common-message-box>