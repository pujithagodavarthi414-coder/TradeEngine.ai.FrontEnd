<mat-card class="p-0 mr-0" fxFlex>
  <mat-card-title>
    <div class="custom-dialog">
      <div class="custom-close" mat-dialog-close (click)="onNoClick()">
        <fa-icon icon="times" class="project-dialog"></fa-icon>
      </div>
    </div>
    <div class="card-title-text  mat-bg-primary p-05 mb-1">{{timeSheetTitle}}
    </div>
  </mat-card-title>
  <div class="activity-data filter-margin viewtimesheet-rows-cursor-pointer m-0" *ngIf="datesData">
    <kendo-grid [data]="datesData" [sortable]="false" [pageable]="false" [filterable]="false" [selectable]="false">
      <kendo-grid-column field="date" title="{{'TIMESHEETSUBMISSION.DATE' | translate}}" [style]="{'cursor':'default'}">
        <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
          {{ dataItem.date | date: "dd-MMM-yyyy"  }}
        </ng-template>
      </kendo-grid-column>
      <kendo-grid-column field="inTime" title="{{'TIMESHEETSUBMISSION.STARTTIME' | translate}}" [style]="{'cursor':'default'}">
        <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
          {{ dataItem.inTime | utcToLocalTime | date: "HH:mm" }}
        </ng-template>
      </kendo-grid-column>
      <kendo-grid-column field="outTime" title="{{'TIMESHEETSUBMISSION.ENDTIME' | translate}}" [style]="{'cursor':'default'}">
        <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
          {{ dataItem.outTime | utcToLocalTime | date: "HH:mm" }}
        </ng-template>
      </kendo-grid-column>
      <kendo-grid-column field="breakmins" title="{{'TIMESHEETSUBMISSION.BREAKDURATION' | translate}}" [style]="{'cursor':'default'}">
      </kendo-grid-column>
      <kendo-grid-column field="summary" title="{{'TIMESHEETSUBMISSION.SUMMARY' | translate}}" [style]="{'cursor':'default'}">
        <ng-template kendoGridCellTemplate let-dataItem>
          <span matTooltip="{{ dataItem.summary}}">{{  dataItem.summary }}</span>
        </ng-template>
      </kendo-grid-column>
      <kendo-grid-column field="isOnLeave" title="{{'TIMESHEETSUBMISSION.ISONLEAVE' | translate}}" [style]="{'cursor':'default'}">
        <ng-template kendoGridCellTemplate let-dataItem>
          <span *ngIf="dataItem.isOnLeave == null || dataItem.isOnLeave == false">
            {{'TIMESHEETSUBMISSION.NO' | translate}}
          </span>
          <span *ngIf="dataItem.isOnLeave == true">
            {{'TIMESHEETSUBMISSION.YES' | translate}}
          </span>
        </ng-template>
      </kendo-grid-column>
      <kendo-grid-command-column field="action" title="{{'ACTIONS' | translate}}">
        <ng-template kendoGridCellTemplate let-dataItem>
          <button class="text-center" title="{{'TIMESHEETSUBMISSION.EDITTIMESHEET' | translate}}" mat-icon-button
            [satPopoverAnchorFor]="editTimeSheetPopover" #editTimesheetPopUp="satPopoverAnchor"
            (click)="editTimeSheet(dataItem,editTimesheetPopUp)">
            <fa-icon icon="edit" style="cursor: pointer;" class="mat-color-accent"></fa-icon>
          </button>
        </ng-template>
      </kendo-grid-command-column>
    </kendo-grid>
    <div class="pull-right">
      <button class="text-center" title="{{'TIMESHEETSUBMISSION.APPROVETIMESHEET' | translate}}" mat-icon-button
      [satPopoverAnchorFor]="approvePopOver" #approvePopUp="satPopoverAnchor"
        (click)="openPopup(approvePopUp);$event.stopPropagation()">
        <fa-icon icon="thumbs-up" class="mr-05" class="mat-color-accent"></fa-icon>
      </button>
      <button class="text-center" title="{{'TIMESHEETSUBMISSION.REJECTEDTIMESHEET' | translate}}" mat-icon-button [satPopoverAnchorFor]="rejectedPopOver"
        #editReasonPopUp="satPopoverAnchor" (click)="editReason(editReasonPopUp);$event.stopPropagation()">
        <fa-icon icon="thumbs-down" style="cursor: pointer;" class="mat-color-accent"></fa-icon>
      </button>
    </div>
  </div>
</mat-card>

<sat-popover #editTimeSheetPopover [autoFocus]="false" hasBackdrop backdropClass="backdrop-color" [restoreFocus]="false"
  [interactiveClose]="false" scrollStrategy="reposition" verticalAlign="below" horizontalAlign="end">
  <mat-card class="filter-data p-0">
    <mat-card-title class="text-center">
      <div class="card-title-text mat-bg-primary p-05">
        {{'TIMESHEETSUBMISSION.EDITTIMESHEET' | translate}}</div>
    </mat-card-title>
    <form [formGroup]="timesheetForm" novalidate #formDirective="ngForm"
      (submit)="timesheetForm.valid && upsertTimeSheetSubmission()">
      <div class="mobile-view-popover p-1">
        <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="10px" fxLayoutGap.xs="0px">
          <div fxFlex="33" fxFlex.xs="100">
            <mat-form-field class="full-width">
              <input matInput formControlName="inTime" placeholder="{{'TIMESHEETSUBMISSION.STARTTIME' | translate}}" aria-label="24hr format"
                [ngxTimepicker]="fullTime1" [format]="24" readonly (click)="startTimeshow();"
                [(ngModel)]="startTimePicker" />
              <ngx-material-timepicker #fullTime1 [cancelBtnTmpl]="startcancelBtn" [confirmBtnTmpl]="confirmBtn">
              </ngx-material-timepicker>
              <span class="close-icon-padding close_icon pull-right">
                <mat-icon *ngIf="startTimePicker" class="icon-button" aria-hidden="false" (click)="clearStartTime()"
                  style="cursor:pointer">close</mat-icon>
              </span>
            </mat-form-field>
            <ng-template #startcancelBtn>
              <p class="feedtimesheet-datepicker-button" style="margin-right: 10px;" (click)="closeStartTime()">
                {{'FEEDTIMESHEET.CANCEL' | translate}}</p>
            </ng-template>
          </div>
          <div fxFlex="33" fxFlex.xs="100">
            <mat-form-field class="full-width">
              <input matInput formControlName="outTime" placeholder="{{'TIMESHEETSUBMISSION.ENDTIME' | translate}}" aria-label="24hr format"
                [ngxTimepicker]="fullTime2" [format]="24" readonly (click)="endTimeshow();"
                [(ngModel)]="endTimePicker" />
              <ngx-material-timepicker #fullTime2 [cancelBtnTmpl]="endcancelBtn" [confirmBtnTmpl]="confirmBtn">
              </ngx-material-timepicker>
              <span class="close-icon-padding close_icon pull-right">
                <mat-icon *ngIf="endTimePicker" class="icon-button" aria-hidden="false" (click)="clearEndTime()"
                  style="cursor:pointer">close</mat-icon>
              </span>
            </mat-form-field>
            <ng-template #endcancelBtn>
              <p class="feedtimesheet-datepicker-button" style="margin-right: 10px;" (click)="closeEndTime()">
                {{'FEEDTIMESHEET.CANCEL' | translate}}</p>
            </ng-template>
          </div>
          <div fxFlex="33" fxFlex.xs="100">
            <mat-form-field class="full-width">
              <input formControlName="breakmins" matInput placeholder="{{'TIMESHEETSUBMISSION.BREAKDURATION' | translate}}" mobileNumber>
            </mat-form-field>
          </div>
        </div>
        <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="10px" fxLayoutGap.xs="0px">
          <div fxFlex="100" fxFlex.xs="100">
            <mat-form-field class="full-width">
              <textarea matInput rows="3" formControlName="summary" placeholder="{{'TIMESHEETSUBMISSION.SUMMARY' | translate}}"></textarea>
            </mat-form-field>
          </div>
        </div>
        <div>
          <mat-checkbox formControlName="onLeave"  [checked]="isOnLeavecheck" class="activity-checkbox"
            (click)="$event.stopPropagation()" (change)="isOnLeaveChecked($event)">
            {{'TIMESHEETSUBMISSION.ISONLEAVE' | translate}}</mat-checkbox>
        </div>
      </div>
      <div class="text-center mb-1 prl-1">
        <button mat-raised-button color="primary" type="submit" class="mr-05" (click)="$event.stopPropagation()">
          <mat-progress-bar color="primary" mode="indeterminate" *ngIf="upsertInProgress">
          </mat-progress-bar>
          <fa-icon icon="plus" class="mr-05"></fa-icon> {{'SAVE' | translate}}
        </button>
        <button mat-raised-button (click)="closePopup()" type="reset" [disabled]="upsertInProgress">
          <fa-icon icon="times" class="mr-05"></fa-icon> {{'CANCEL' | translate}}
        </button>
      </div>
      <ng-template #cancelBtn>
        <p class="feedtimesheet-datepicker-button" style="margin-right: 10px;">
          {{'ROSTER.CANCEL' | translate}}</p>
      </ng-template>
      <ng-template #confirmBtn>
        <p class="feedtimesheet-datepicker-button">{{'ROSTER.OK' | translate}}</p>
      </ng-template>
    </form>
  </mat-card>
</sat-popover>
<sat-popover #rejectedPopOver [autoFocus]="false" hasBackdrop backdropClass="backdrop-color" [restoreFocus]="false"
  [interactiveClose]="false" scrollStrategy="reposition" verticalAlign="below" horizontalAlign="end">
  <mat-card class="filter-data p-0">
    <mat-card-title class="text-center">
      <div class="card-title-text mat-bg-primary p-05">
        {{'TIMESHEETSUBMISSION.REJECTEDREASON' | translate}}</div>
    </mat-card-title>
    <mat-card-content>
      <textarea matInput rows="3" [(ngModel)]="reason" placeholder="{{'TIMESHEETSUBMISSION.REASON' | translate}}"></textarea>
    </mat-card-content>
    <div class="text-center mb-1 prl-1">
      <button mat-raised-button color="primary" mat-raised-button (click)="openRejctedPopup(rejectedReasonPopUp)" type="reset"
      [satPopoverAnchorFor]="rejectedMessagePopOver" #rejectedReasonPopUp="satPopoverAnchor"
        [disabled]="loadingIndicator">
        <fa-icon icon="plus" class="mr-05"></fa-icon> {{'SAVE' | translate}}
      </button>
      <button mat-raised-button (click)="closeReasonPopup()" type="reset" [disabled]="loadingIndicator" class="ml-05">
        <fa-icon icon="times" class="mr-05"></fa-icon> {{'CANCEL' | translate}}
      </button>
    </div>
  </mat-card>
</sat-popover>

<sat-popover backdropClass="backdrop-color" #approvePopOver hasBackdrop backdropClass="backdrop-color"
  verticalAlign="below" horizontalAlign="end">
  <mat-card class="p-0">
    <mat-card-title class="text-center mat-bg-primary">
      <div class="card-title-text mb-1">Approve time sheet</div>
    </mat-card-title>
    <mat-card-content>
      <div class="card-content mb-1">
        Are you sure want to aprrove the time sheet?
      </div>
      <div class="text-center">
        <button class="mr-1" mat-button mat-raised-button color="primary" [disabled]="loadingIndicator"
          (click)="approveTimeSheet();">
          <fa-icon class="mr-05" icon="check"></fa-icon> {{ 'YES' | translate }}
        </button>
        <button mat-button mat-raised-button (click)="closeApproverPopUp();">
          <fa-icon class="mr-05" icon="times"></fa-icon> {{ 'CANCEL' | translate }}
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</sat-popover>

<sat-popover backdropClass="backdrop-color" #rejectedMessagePopOver hasBackdrop backdropClass="backdrop-color"
  verticalAlign="below" horizontalAlign="end">
  <mat-card class="p-0">
    <mat-card-title class="text-center mat-bg-primary">
      <div class="card-title-text mb-1">Reject time sheet</div>
    </mat-card-title>
    <mat-card-content>
      <div class="card-content mb-1">
        Are you sure want to reject the time sheet?
      </div>
      <div class="text-center">
        <button class="mr-1" mat-button mat-raised-button color="primary" [disabled]="loadingIndicator"
          (click)="rejectTimeSheet();">
          <fa-icon class="mr-05" icon="check"></fa-icon> {{ 'YES' | translate }}
        </button>
        <button mat-button mat-raised-button (click)="closerejectedMessgaePopUp();">
          <fa-icon class="mr-05" icon="times"></fa-icon> {{ 'CANCEL' | translate }}
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</sat-popover>