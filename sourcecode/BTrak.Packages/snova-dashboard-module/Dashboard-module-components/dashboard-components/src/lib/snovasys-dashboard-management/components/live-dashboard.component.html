<div class="full-height">
  <mat-card class="p-0 m-0" *ngIf="(canAccess_feature_ViewLiveDashboard)">
    <mat-card-title class="full-width data-table-header drag-handler">
      <div fxLayout="row wrap" fxLayoutGap="0" fxLayoutGap.xs="5px">
        <div fxFlex fxLayoutAlign="start center" class="card-title-text p-05 full-width">
          <span class="hide-content-overflow">{{ 'PRODUCTIVITYDASHBOARD.LIVEDASHBOARD' | translate | titlecase }}</span>
        </div>

        <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center" class="ml-02">
          <button mat-icon-button matTooltip="{{'RESET' | translate}}" (click)="resetAllFilters()">
            <fa-icon class="filter mat-color-accent" icon="undo"></fa-icon>
          </button>
        </div>
        <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center">
          <button type="submit" mat-icon-button class="pull-right" (click)="filterClick()"
            [matMenuTriggerFor]="filterMenu" matTooltip=" {{'HRMANAGAMENT.ADVANCESEARCH' | translate}}">
            <fa-icon icon="user-cog" class="filter mat-color-accent">
            </fa-icon>
          </button>
        </div>
        <div fxFlex="30px" fxLayoutAlign="end center" class="mr-05 ml-05" *ngIf="(canAccess_feature_SnapLiveDashboard)">
          <mat-icon mat-icon-button class="custom-widget-icon mr-05 mt-n2"
            matTooltip="{{ 'PRODUCTIVITYDASHBOARD.snapshot' | translate }}" (click)="generateDashboard()">
            camera_enhance
            {{ 'PRODUCTIVITYDASHBOARD.snapshot' | translate }}</mat-icon>
        </div>
      </div>
      <mat-divider></mat-divider>
    </mat-card-title>
  </mat-card>
  <mat-menu #filterMenu="matMenu" xPosition="before" class="custom-matpanel">

    <mat-card class="filter-data" (click)="$event.stopPropagation()">
      <mat-form-field class="full-width">
        <mat-select placeholder="{{ 'PRODUCTIVITYDASHBOARD.SelectStatus' | translate }}"
          (selectionChange)="getProcessDashboardDetails($event.value)" [(ngModel)]="statusDropdown">
          <mat-option value="all">All</mat-option>
          <mat-option *ngFor="let list of liveDashBoardStatusDropDownList"
            [value]="list.processDashboardStatusHexaValue">
            {{list.statusShortName}}</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="full-width" *ngIf="entities?.length > 1">
        <mat-select placeholder="{{ 'WIDGETS.SELECTBRANCH' | translate }}" [(ngModel)]="selectedEntity"
          (selectionChange)="entityValues($event.value)">
          <mat-option *ngFor="let entity of entities" [value]="entity.id">
            {{entity.name}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </mat-card>
  </mat-menu>
  <mat-card class="p-0 m-0 no-drag" *ngIf="(canAccess_feature_ViewLiveDashboard)" id="style-1">
    <mat-card-content class="p-0 m-0">
      <div fxLayout="row wrap">
        <div fxFlex="70" fxFlexOrder.lt-md="2" fxFlex.sm="100" fxFlex.xs="100">
          <ngx-datatable class='btrak live-dashboard-table liveDashboard_table' [rows]="liveDashBoardData"
            [groupRowsBy]="'goalResponsibleUserName'" [columnMode]="'force'" [headerHeight]="35" [footerHeight]="50"
            [rowHeight]="40" [limit]="liveDashBoardData?liveDashBoardData.length:0" [groupExpansionDefault]="true"
            [scrollbarH]="scrollbarH" [loadingIndicator]="anyOperationInProgress"
            [messages]="{emptyMessage:('NODATATODISPLAY' | translate), totalMessage: 'TOTAL' | translate}">
            <ngx-datatable-group-header [rowHeight]="35" #myGroupHeader (toggle)="onDetailToggle()">
              <ng-template let-group="group">
                <div class="text-center">
                  <span class="livedashboard_custom_header">
                    {{group.value[0].goalResponsibleUserName}}
                  </span>
                </div>
              </ng-template>
            </ngx-datatable-group-header>
            <ngx-datatable-column [width]="50" [resizeable]="false" [sortable]="false" [draggable]="false"
              [canAutoResize]="false">
            </ngx-datatable-column>
            <ngx-datatable-column name="{{ 'PRODUCTIVITYDASHBOARD.GOAL' | translate | softLabelsPipe : softLabels}}"
              prop="goalName">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <span class="icon-button" (click)="redirectToGoal(row)">{{row?.goalName}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="{{ 'GOALS.STARTDATE' | translate }}"
              prop="onboardProcessDate">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <span class="icon-button" (click)="redirectToGoal(row)"
                  matTooltip="{{row?.onboardProcessDateTimeZoneName }}">{{row?.onboardProcessDate | date: 'dd-MM-yyyy'}}
                  <span class="timezone-name" *ngIf="(row?.onboardProcessDate | covertTimeIntoUtcTime) != Offset"
                  >{{row?.onboardProcessDateTimeZoneAbbreviation}}
                  </span>
                </span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column
              name="{{ 'PRODUCTIVITYDASHBOARD.GOALSTATUS' | translate | softLabelsPipe : softLabels}}">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <div (click)="redirectToGoal(row)" [ngStyle]="{ 'background' : row.goalStatusColor }"
                  style="width: 200px; cursor: pointer;">
                  &nbsp;</div>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="{{ 'PRODUCTIVITYDASHBOARD.MILESTONE' | translate }}" prop="mileStone">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <span class="icon-button" (click)="redirectToGoal(row)"
                  matTooltip="{{row?.generatedDateTimeZoneName}}">{{row?.mileStone | date: 'dd-MM-yyyy'}}
                  <span class="timezone-name" *ngIf="(row?.mileStone | covertTimeIntoUtcTime) != Offset"
                  >{{row?.generatedDateTimeZoneAbbreviation }}
                  </span>
                </span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="{{ 'PRODUCTIVITYDASHBOARD.DELAY' | translate }}" prop="delay">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <span class="icon-button" (click)="redirectToGoal(row)">{{row?.delay}}</span>
              </ng-template>
            </ngx-datatable-column>
          </ngx-datatable>
        </div>
        <div fxFlex="30" fxFlexOrder.lt-md="1" fxFlex.sm="100" fxFlex.xs="100">
          <ngx-datatable class="btrak live-dashboard-table" [columnMode]="'force'" [headerHeight]="35"
            [footerHeight]="50" [rowHeight]="35" [rows]="liveDashBoardStatusDropDownList">
            <ngx-datatable-column [flexGrow]="1" style="width:150px;">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <div matTooltip="{{row?.statusShortName}}">
                {{ row?.statusShortName }}
                </div>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [flexGrow]="1">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <div style="width:150px;" [ngStyle]="{ 'background' : row.processDashboardStatusHexaValue }">
                  &nbsp;
                </div>
              </ng-template>
            </ngx-datatable-column>
          </ngx-datatable>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
  <app-common-message-box *ngIf="!(canAccess_feature_ViewLiveDashboard)"
    textToDisplay="{{ 'PERMISSIONMESSAGE' | translate }}">
  </app-common-message-box>
</div>