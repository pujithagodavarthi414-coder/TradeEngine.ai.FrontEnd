<div *ngIf="(canAccess_feature_DevQuality); then thenBlock else elseBlock"></div>
<div class="full-height">
  <ng-template #thenBlock>
    <mat-card class="p-0 m-0">
      <mat-card-title class="full-width data-table-header drag-handler">
        <div fxLayout="row wrap" fxLayoutGap="0" fxLayoutGap.xs="10px">
          <div fxFlex fxLayoutAlign="start center" class="card-title-text p-05 full-width">
            <span class="hide-content-overflow"> {{ 'PRODUCTIVITYDASHBOARD.DEVQUALITY' | translate | titlecase }}</span>
          </div>
          <div fxFlex.gt-xs="180px" fxFlex.xs="100px" class="ml-05 mr-05 search_goalinput" fxLayoutAlign="end center"
            fxLayoutAlign.xs="center center">
            <mat-form-field ngClass.xs="full-width">
              <input class="search_goal" matInput placeholder="{{'SEARCH' | translate}}" [(ngModel)]="searchText"
                (input)="searchRecords()">
            </mat-form-field>
            <span class="close_icon" style="right: 8px !important;">
              <span *ngIf="!searchText">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <mat-icon *ngIf="searchText" class="icon-button" aria-hidden="false" (click)="closeSearch()"
                style="cursor:pointer">
                close</mat-icon>
            </span>
          </div>
          <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center" class="ml-02">
            <button mat-icon-button (click)="resetAllFilters()">
              <fa-icon matTooltip="{{'RESET' | translate}}" class="filter mat-color-accent" icon="undo"></fa-icon>
            </button>
          </div>
          <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center" style="cursor: pointer;">
            <button type="submit" mat-icon-button class="pull-right" (click)="filterClick()"
              [matMenuTriggerFor]="filterMenu">
              <fa-icon icon="user-cog" matTooltip="{{'WIDGETS.CONFIGUREAPPSETTINGS' | translate}}"
                class="filter mat-color-accent">
              </fa-icon>
            </button>
          </div>
        </div>
        <mat-menu #filterMenu="matMenu" xPosition="before" class="custom-matpanel">
          <mat-card class="filter-data" (click)="$event.stopPropagation()">
            <div fxLayoutAlign="center start">
              <fa-icon (click)="getDevQualityBasedOnDate('left')" icon="chevron-left"></fa-icon>
              <b>&nbsp;{{selectedDate | date: "MMM-yyyy"}}&nbsp;</b><span
                *ngIf="weekNumber"><b>W{{weekNumber}}&nbsp;</b></span>
              <fa-icon (click)="getDevQualityBasedOnDate('right')" icon="chevron-right"></fa-icon>
            </div>
            <mat-form-field class="full-width">
              <mat-select [(ngModel)]="selectedValue" (ngModelChange)="changeFilterType()">
                <!-- <mat-option *ngFor="let filter of filters" [value]="filter.value">
                  {{filter.value}}
                </mat-option> -->
                <mat-option value="Week">{{ 'PRODUCTIVITYDASHBOARD.WEEK' | translate }}</mat-option>
                <mat-option value="Month">{{ 'PRODUCTIVITYDASHBOARD.MONTH' | translate }}</mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field class="full-width" *ngIf="entities?.length > 1">
              <mat-select placeholder="{{ 'WIDGETS.SELECTBRANCH' | translate }}" [(ngModel)]="selectedEntity"
                (selectionChange)="entityValues($event.value)">
                <mat-option *ngFor="let entity of entities" [value]="entity.id">
                  {{entity.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field class="full-width" *ngIf="(canAccess_feature_ManageAppFilters)">
              <mat-select [(value)]="selectedFilterValue" (selectionChange)="changeFilterValue($event.value)">
                <mat-option *ngIf="isAll" value="all">{{ 'PRODUCTIVITYDASHBOARD.ALL' | translate }}</mat-option>
                <mat-option *ngIf="isReportedOnly" value="reportingOnly">{{ 'PRODUCTIVITYDASHBOARD.REPORTINGONLY' | translate }}</mat-option>
                <mat-option *ngIf="isMyself" value="mySelf">{{ 'PRODUCTIVITYDASHBOARD.MYSELF' | translate }}</mat-option>
              </mat-select>
            </mat-form-field>
          </mat-card>
        </mat-menu>
        <mat-divider></mat-divider>
      </mat-card-title>
    </mat-card>

    <div class="activity-data filter-margin m-0 app-height-search-2 no-drag pagination-move-left" id="style-1">
      <ngx-datatable class="btrak" [columnMode]="'force'" [headerHeight]="35" [footerHeight]="35" [rowHeight]="35"
        [rows]="devQuality" [scrollbarH]="true"
        [messages]="{emptyMessage:('NODATATODISPLAY' | translate), totalMessage: 'TOTAL' | translate}"
        [externalPaging]="true" [count]="page.totalElements" [offset]="page.pageNumber" [limit]="page.size"
        (sort)="onSort($event)" [loadingIndicator]="anyOperationInProgress" (page)='setPage($event)'
        [sorts]="[{prop: 'reOpen', dir: 'desc'}]">

        <ngx-datatable-column minWidth="150" name="{{ 'PRODUCTIVITYDASHBOARD.DEVELOPERNAME' | translate }} " [flexGrow]="1 "
          prop="userName">
          <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
            <div class="icon-button" fxLayout="row" (click)="goToProfile(row.userId)">
              <div *ngIf="row.userProfileImage != null && row.userProfileImage != ''">
                <app-avatar [src]="row.userProfileImage | fetchSizedAndCachedImage: '30':''" [isRound]="true" size="30">
                </app-avatar>
              </div>
              <div *ngIf="row.userProfileImage == null || row.userProfileImage == ''">
                <app-avatar [name]="row.userName | removeSpecialCharacters" [isRound]="true" size="30"></app-avatar>
              </div>
              <span class="ml-05 mt-02 hide-content-overflow" matTooltip="{{row.userName}}" matTooltipShowDelay="400"
                fxFlex>
                {{ row?.userName }}
              </span>
            </div>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column minWidth="150" name="{{ 'USERSTORIESDEPENDENCY.PROJECTNAME' | translate | softLabelsPipe : softLabels}}"
          [flexGrow]="1" prop="projectName">
          <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
            <div class="icon-button" fxLayout="row" (click)="navigateToUserStoriesPage(row)" matTooltip="{{ value }}">
              {{ value }}
            </div>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column minWidth="150" name="{{ 'GOALS.GOALNAME' | translate | softLabelsPipe : softLabels}}" [flexGrow]="1"
          prop="goalShortName">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <div class="icon-button" fxLayout="row" (click)="navigateToUserStoriesPage(row)" matTooltip="{{ row?.goalShortName }}">
              {{ row?.goalShortName }}
            </div>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column minWidth="150" name="{{ 'SPRINTS.SPRINTNAME' | translate | softLabelsPipe : softLabels}}" [flexGrow]="1"
          prop="sprintName">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <div class="icon-button" fxLayout="row" (click)="navigateToUserStoriesPage(row)" matTooltip="{{ row?.sprintName }}">
              {{ row?.sprintName }}
            </div>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column minWidth="500" name="{{ 'PRODUCTIVITYDASHBOARD.USER STORY' | translate | softLabelsPipe : softLabels}}"
          [flexGrow]="1" prop="userStoryName">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <div class="icon-button" fxLayout="row" (click)="navigateToUserStoriesPage(row)" matTooltip="{{ row?.userStoryName }}">
              {{ row?.userStoryName }}
            </div>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column minWidth="150" name="{{ 'PRODUCTIVITYDASHBOARD.CURRENTSTATUS' | translate }}" [flexGrow]="1"
          prop="currentStatus">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <div class="icon-button" fxLayout="row" (click)="navigateToUserStoriesPage(row)" matTooltip="{{ row?.currentStatus }}">
              {{ row?.currentStatus }}
            </div>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column minWidth="150" name="{{ 'PRODUCTIVITYDASHBOARD.REOPEN' | translate }}" [flexGrow]="1" prop="reOpen">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <div class="icon-button" (click)="navigateToUserStoriesPage(row)" matTooltip="{{ row?.reOpen }}">
              {{ row?.reOpen }}
            </div>
          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable>
    </div>
  </ng-template>
</div>
<ng-template #elseBlock>
  <app-common-message-box textToDisplay="{{ 'PRODUCTIVITYDASHBOARD.PERMISSION' | translate }}">
  </app-common-message-box>
</ng-template>

<ng-template #uniqueUserstoryDialog let-data>
  <unique-userstory-dialog [data]=[data]></unique-userstory-dialog>
</ng-template>