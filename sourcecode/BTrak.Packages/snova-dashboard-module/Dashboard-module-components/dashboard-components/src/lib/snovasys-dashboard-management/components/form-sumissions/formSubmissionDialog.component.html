<div class="custom-dialog">
    <div class="custom-close" mat-dialog-close (click)="onNoClick()">
        <fa-icon icon="times" class="project-dialog"></fa-icon>
    </div>
</div>
<div mat-dialog-content class="project-dialogContent" id="style-1">
    <mat-card class="p-0" style="height: calc(100vh - 200px);">
        <mat-tab-group class="testrail-tabs form-submission" [selectedIndex]="selectedTab"
            (selectedTabChange)="selectedMatTab($event)">
            <mat-tab label="{{'FORMSUBMISSION.FORMSUBMISSION' | translate}}">
                <ng-template mat-tab-label>
                    {{'FORMSUBMISSION.FORMSUBMISSION' | translate}}
                </ng-template>
                <ng-template matTabContent>
                    <div *ngIf="selectedTab == 0" class="performance-form m-1" id="style-1">
                        <div style="height: calc(100vh - 355px);" id="style-1">
                            <formio #customFormio [form]="formJson" [submission]="formData" (submit)="onDataSubmit()">
                            </formio>
                        </div>
                        <div fxLayout="row">
                            <div fxFlex="220px">
                                <b>{{ 'FORMSUBMISSION.ASSIGNTO' | translate }}:</b>
                            </div>
                            <div fxFlex="250px">
                                <mat-select placeholder="{{ 'FORMSUBMISSION.SELECTAUSER' | translate }}"
                                    (selectionChange)="assignedToSelected($event.value)" [(ngModel)]="assignedToUserId">
                                    <mat-select-trigger>
                                        {{assigneName}}
                                    </mat-select-trigger>
                                    <mat-option *ngFor="let type of users" [value]="type.id">
                                        <app-avatar class="employee_img" *ngIf="!type.profileImage"
                                            [name]="type.fullName | removeSpecialCharacters" [isRound]="true" size="30">
                                        </app-avatar>
                                        <img class="employee_img" src="{{type.profileImage}}"
                                            *ngIf="type.profileImage">{{type.fullName}}
                                    </mat-option>
                                </mat-select>
                            </div>
                            <div fxFlex></div>
                        </div>
                        <button mat-button mat-raised-button class="m-1 pull-right" color="primary" type="button"
                            (click)="onDataSubmit()">
                            <fa-icon class="mr-05" icon="save"></fa-icon> {{ 'TESTMANAGEMENT.SAVE' | translate }}
                        </button>
                    </div>
                </ng-template>
            </mat-tab>
            <mat-tab label="{{'FORMSUBMISSION.DISCUSSIONS' | translate}}" *ngIf="referenceId">
                <ng-template mat-tab-label>
                    {{'FORMSUBMISSION.DISCUSSIONS' | translate}}
                </ng-template>
                <ng-template matTabContent>
                    <div class="performance-form" id="style-1" *ngIf="selectedTab == 1">
                        <snovasys-comments [receiverId]="referenceId" [isPermissionExists]="true"
                            [componentModel]="componentModel">
                        </snovasys-comments>
                    </div>
                </ng-template>
            </mat-tab>
            <mat-tab label="{{'FORMSUBMISSION.HISTORY' | translate}}" *ngIf="referenceId">
                <ng-template mat-tab-label>
                    {{'FORMSUBMISSION.HISTORY' | translate}}
                </ng-template>
                <ng-template matTabContent>
                    <div class="performance-form" id="style-1" *ngIf="selectedTab == 2">
                        <div *ngIf="historyDetails.total > 0">
                            <div fxLayout="column" fxLayoutGap="10px">
                                <kendo-grid #grid [data]="historyDetails" [pageSize]="state.take" [skip]="state.skip"
                                    [sortable]="true" [pageable]="pageable" [filterable]="false"
                                    (dataStateChange)="dataStateChange($event)" [sort]="state.sort">
                                    <kendo-grid-column field="fieldName" title="{{'RESIDENT.FIELDNAME' | translate}}">
                                        <ng-template kendoGridCellTemplate let-dataItem>
                                            <div class="cursor-pointer">{{ dataItem.fieldName }}
                                            </div>
                                        </ng-template>
                                    </kendo-grid-column>
                                    <kendo-grid-column field="newFieldValue"
                                        title="{{'RESIDENT.FIELDVALUE' | translate}}">
                                        <ng-template kendoGridCellTemplate let-dataItem>
                                            <div class="cursor-pointer">{{ dataItem.newFieldValue }}
                                            </div>
                                        </ng-template>
                                    </kendo-grid-column>
                                    <kendo-grid-column field="createdBy"
                                        title="{{'RESIDENT.UPDATEDBYUSERNAME' | translate}}">
                                        <ng-template kendoGridCellTemplate let-dataItem>
                                            <div class="cursor-pointer">{{ dataItem.createdBy }}
                                            </div>
                                        </ng-template>
                                    </kendo-grid-column>
                                    <kendo-grid-column field="createdDate"
                                        title="{{'RESIDENT.UPDATEDDATETIME' | translate}}">
                                        <ng-template kendoGridCellTemplate let-dataItem>
                                            <div class="cursor-pointer">
                                                {{ dataItem.createdDateTime | utcToLocalTime | date: 'dd-MMM-yyyy HH:mm' }}
                                            </div>
                                        </ng-template>
                                    </kendo-grid-column>
                                </kendo-grid>
                                <div [ngClass]="{'k-i-loading': isAnyOperationIsInprogress}"></div>
                            </div>
                        </div>
                        <div *ngIf="historyDetails.total == 0">
                            <div class="m-1" fxLayoutAlign="center center" fxLayout="column">
                                {{ 'ACTIVITYTRACKER.NODATATODISPLAY' | translate }}
                            </div>
                        </div>
                    </div>
                </ng-template>
            </mat-tab>
        </mat-tab-group>
    </mat-card>
</div>