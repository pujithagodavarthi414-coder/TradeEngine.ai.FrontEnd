<div class="custom-dialog">
    <div class="custom-close" mat-dialog-close (click)="cancelDialog()">
        <fa-icon icon="times" class="project-dialog"></fa-icon>
    </div>
</div>
<div class="mt-1 invoice-upsert-form" id="style-1">
    <div class="p-4 m-4">
        <div fxLayout="column">
            <div fxLayout="row" fxLayoutAlign="space-around center" class="mb-3">
                <div fxFlex="23">
                    <b>{{'ENTITYFORM.SITE' | translate}}: </b> {{grEDetails.siteName}}
                </div>
                <div fxFlex="23">
                    <b>{{'ENTITYFORM.GRD' | translate}}: </b> {{grEDetails.grdName}}
                </div>
                <div fxFlex="23">
                    <b>{{'ENTITYFORM.TERM' | translate}}: </b> {{grEDetails.term}}
                </div>
                <div fxFlex="23">
                    <b> {{'BANKACCOUNT.BANKACCOUNT' | translate}}: </b> {{grEDetails.bankAccountName}}
                </div>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-around center">
                <div fxFlex="23">
                    <b>{{'SITE.STARTDATE' | translate}}: </b> {{grEDetails.startDate | date: 'mediumDate'}}
                </div>
                <div fxFlex="23">
                    <b>{{'SITE.ENDDATE' | translate}}: </b> {{grEDetails.endDate | date: 'mediumDate'}}
                </div>
                <div fxFlex="23">
                    <app-month-picker [month]="grEDetails.month" [disabled]="true"></app-month-picker>
                </div>
                <div fxFlex="23">
                    <app-year-picker [year]="grEDetails.year" [disabled]="true"></app-year-picker>
                </div>
            </div>
            <div fxLayout="row" class="p-1">
                <div fxLayout="column" fxFlex="50" class="mt-2">
                    <div fxLayout="row">
                        <div fxLayout="column" fxFlex="100" class="p-1">
                            <div fxFlex="100" class="mb-1">
                                <h6 class="mb-0"><b>{{'ENTITYFORM.PRA' | translate}}</b></h6>
                            </div>
                            <div fxFlex="100">
                                <span fxFlex="40"><b>{{'ENTITYFORM.PRODUCTION' | translate}} </b></span>
                                <span fxFlex="20">{{CommaFormatted(grEDetails.production)}} (kWh)</span>
                            </div>
                            <div fxFlex="100">
                                <span fxFlex="40"><b>{{'ENTITYFORM.REPRICE' | translate}} </b></span>
                                <span fxFlex="20">{{CommaFormatted(grEDetails.reprise)}} (kWh)</span>
                            </div>
                            <div fxFlex="100">
                                <span fxFlex="40"><b>{{'ENTITYFORM.AUTOCONSUMPTION' | translate}} </b></span>
                                <span fxFlex="20">{{CommaFormatted(autoConsumption)}} (kWh)</span>
                            </div>
                            <!-- <div fxFlex="100">
                                <span fxFlex="40"><b>{{'ENTITYFORM.FACTURATION' | translate}} </b></span>
                                <span fxFlex="20">{{grEDetails.facturation | number: '1.2'}} (CHF)</span>
                            </div> -->
                            <div fxFlex="100" *ngFor="let field of praFields">
                                <span fxFlex="40"><b>{{field.displayName}} </b></span>
                                <span fxFlex="20">{{CommaFormatted(field.enteredResult)}} ({{field.unit}})</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div fxLayout="column" fxFlex="50" class="mt-2">
                    <!-- <div fxFlex="100"> -->
                    <h6 class="mb-0" *ngIf="isGre"><b>{{'ENTITYFORM.GRE' | translate}}</b></h6>
                    <h6 class="mb-0" *ngIf="!isGre"><b>{{'ENTITYFORM.ROMANDEE' | translate}}</b></h6>
                    <!-- </div> -->
                    <div fxLayout="row">
                        <div fxLayout="column" fxFlex="50" class="p-1">
                            <div fxFlex="100">
                                <span fxFlex="40"><b>{{'ENTITYFORM.GRIDINVOICE#' | translate}} </b></span>
                                <span fxFlex="40">{{grEDetails?.gridInvoiceName}} {{grEDetails.gridInvoice}}</span>
                            </div>
                            <div fxFlex="100" *ngIf="isGre">
                                <span fxFlex="40"><b>{{'ENTITYFORM.HAUTETARIFF' | translate}} </b></span>
                                <span fxFlex="20">{{CommaFormatted(grEDetails.hauteTariff)}} (kWh)</span>
                            </div>
                            <div fxFlex="100" *ngIf="isGre">
                                <span fxFlex="40"><b>{{'ENTITYFORM.BASTARIFF' | translate}} </b></span>
                                <span fxFlex="20">{{CommaFormatted(grEDetails.basTariff)}} (kWh)</span>
                            </div>
                            <div fxFlex="100" *ngIf="isGre">
                                <span fxFlex="40"><b>{{'TOTAL' | translate}} </b></span>
                                <span fxFlex="20">{{CommaFormatted(hbTotal)}} (kWh)</span>
                            </div>
                            <div fxFlex="100" *ngFor="let field of dFEntryFields">
                                <span fxFlex="40"><b>{{field.displayName}} </b></span>
                                <span fxFlex="20">{{CommaFormatted(field.enteredResult)}} ({{field.unit}})</span>
                            </div>
                            <!-- <div fxFlex="100" *ngIf="!isGre">
                                <span fxFlex="40"><b>{{'ENTITYFORM.ADMINISTRATIONROMADEE' | translate}} </b></span>
                                <span fxFlex="20">{{CommaFormatted(grEDetails.administrationRomandeE)}} (CHF)</span>
                            </div> -->
                        </div>
                        <div fxLayout="column" fxFlex="50" class="p-1">
                            <div fxFlex="100">
                                <span fxFlex="40"><b>{{'ENTITYFORM.GRIDINVOICEDATE' | translate}} </b></span>
                                <span fxFlex="30">{{grEDetails.gridInvoiceDate | date: 'mediumDate'}}</span>
                            </div>
                            <!-- <div fxFlex="100" *ngIf="isGre">
                                <span fxFlex="40"><b>{{'ENTITYFORM.DISTRIBUTION' | translate}} </b></span>
                                <span fxFlex="20">{{CommaFormatted(grEDetails.distribution)}} (CHF)</span>
                            </div>
                            <div fxFlex="100" *ngIf="isGre">
                                <span fxFlex="40"><b>{{'ENTITYFORM.FACTURATION' | translate}} </b></span>
                                <span fxFlex="20">{{CommaFormatted(grEDetails.greFacturation)}} (CHF)</span>
                            </div>
                            <div fxFlex="100" *ngIf="isGre">
                                <span fxFlex="40"><b>{{'TOTAL' | translate}} </b></span>
                                <span fxFlex="20">{{CommaFormatted(greTotal)}} (CHF)</span>
                            </div> -->
                            <div fxFlex="100">
                                <span fxFlex="40"><b>{{'TOTAL' | translate}} </b></span>
                                <span fxFlex="20">{{CommaFormatted(grEDetails.distribution  | number: '1.1-2')}} (CHF)</span>
                            </div>
                            <div fxFlex="100">
                                <span fxFlex="40"><b>{{'ENTITYFORM.CONFIRMDETAILSGRID' | translate}} </b></span>
                                <span fxFlex="20">{{grEDetails.confirmDetailsfromGrid}}</span>
                            </div>
                            <div fxFlex="100" *ngIf="isRemainder">
                                <span fxFlex="40"><b>{{'ENTITYFORM.OUTSTANDINGAMOUNT' | translate}} </b></span>
                                <span fxFlex="20">{{CommaFormatted(grEDetails.outStandingAmount  | number: '1.2')}} (CHF)</span>
                            </div>
                            <div *ngFor="let formField of messageTypes; let i=index">
                                <div fxFlex="100" *ngIf="formField.isDisplay == true && grdIdSelected != null && grdIdSelected != undefined 
                                    && formField.selectedGrdIds != null && formField.selectedGrdIds != undefined && formField.selectedGrdIds.includes(grdIdSelected)
                                    && isNotRemainder(formField)">
                                    <span fxFlex="82">Include {{ formField.messageType }} Message in Email </span>
                                    <span fxFlex="8" *ngIf="formField.isSendInMail != undefined && formField.isSendInMail == true">Yes</span>
                                    <span fxFlex="8" *ngIf="formField.isSendInMail == undefined || 
                                        (formField.isSendInMail != undefined && formField.isSendInMail != true)">No</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div fxLayout="column" class="p-1">
                <h6 class="mb-0"><b>{{'ENTITYFORM.FACTUREPHOTONONESUMMARY' | translate}}</b></h6>
                <div fxLayout="column" fxFlex="100" class="mt-2">
                    <div fxFlex="100">
                        <span fxFlex="25"><b>{{'ENTITYFORM.AUTOCONSUMPTION' | translate}}</b>(kWh)</span>
                        <span fxFlex="20">{{autoConsumption | number: '1.1-2'}}</span>
                    </div>
                    <div fxFlex="100">
                        <span fxFlex="25"><b>{{'ENTITYFORM.AUTOCTARIF' | translate}} </b>(Cts)</span>
                        <span fxFlex="20">{{CommaFormatted(autoCTariff) | number: '1.1-2'}}</span>
                    </div>
                    <div fxFlex="100">
                        <span fxFlex="25">(CHF)</span>
                        <span fxFlex="20">{{CommaFormatted(autoConsuptionFactor | number: '1.1-2') }}</span>
                    </div>
                    <!-- <div fxFlex="100">
                        <span fxFlex="25"><b>{{'ENTITYFORM.FACTURATION' | translate}} </b>(CHF)</span>
                        <span fxFlex="20"> {{CommaFormatted(facturation) | number: '1.2'}} </span>
                    </div> -->
                    <div fxFlex="100">
                        <span fxFlex="25"></span>
                        <span fxFlex="20"> {{CommaFormatted(autoConsumptionTotal | number: '1.1-2') }} </span>
                    </div>
                    <div fxFlex="100" *ngFor="let field of praFields">
                        <span fxFlex="25"><b>{{field.displayName}} </b></span>
                        <span fxFlex="20">{{CommaFormatted(field.enteredResult | number: '1.1-2') }}</span>
                    </div>
                    <div fxFlex="100">
                        <span fxFlex="25"></span>
                        <span fxFlex="20"> {{CommaFormatted(pRATotal | number: '1.1-2') }} </span>
                    </div>
                    <div fxFlex="100" class="mt-1">
                        <span></span>
                    </div>
                    <!-- <div fxFlex="100" *ngIf="isGre">
                        <span fxFlex="25"><b>{{'ENTITYFORM.DISTRIBUTION' | translate}} </b>(CHF)</span>
                        <span fxFlex="20">{{CommaFormatted(distribution) | number: '1.1-2'}}</span>
                    </div> -->
                    <!-- <div fxFlex="100" *ngIf="isGre">
                        <span fxFlex="25"><b>{{'ENTITYFORM.AUTOCTARIF' | translate}} </b>(CHF)</span>
                        <span fxFlex="20">{{CommaFormatted(greFacturation) | number: '1.1-2'}}</span>
                    </div> -->
                    <!-- <div fxFlex="100" *ngIf="!isGre">
                        <span fxFlex="25"><b>{{'ENTITYFORM.ADMINISTRATIONROMADEE' | translate}} </b>(CHF)</span>
                        <span fxFlex="20">{{CommaFormatted(administrationRomandeE) | number: '1.1-2'}}</span>
                    </div> -->
                    <div fxFlex="100">
                        <span fxFlex="25"><b>{{'TOTAL' | translate}} </b>(CHF)</span>
                        <span fxFlex="20">{{CommaFormatted(greTotal | number: '1.1-2') }}</span>
                    </div>
                    <div fxFlex="100" class="mt-1">
                        <span></span>
                    </div>
                    <div fxFlex="100">
                        <span fxFlex="25"><b>{{'ENTITYFORM.SUBTOTAL' | translate}} </b>(CHF)</span>
                        <span fxFlex="20">{{CommaFormatted(subTotal | number: '1.1-2')}}</span>
                    </div>
                    <div fxFlex="100">
                        <span fxFlex="20"></span>
                        <span fxFlex="5">{{'ENTITYFORM.TVA' | translate}}  </span>
                        <span fxFlex="10">{{tva | number: '1.1-2'}} </span>
                    </div>
                    <div fxFlex="100">
                        <span fxFlex="25">(CHF)</span>
                        <span fxFlex="20"><b>{{CommaFormatted(total | number: '1.1-2') }}</b></span>
                    </div>
                    <div fxFlex="100">
                        <span fxFlex="25">Arrondi</span>
                        <span fxFlex="20"><b>{{CommaFormatted(aroundi | number: '1.1-2') }}</b></span>
                    </div>
                    <div fxFlex="100">
                        <span fxFlex="25">Total</span>
                        <span fxFlex="20"><b>{{CommaFormatted(wholeTotalValue | number: '1.1-2') }}</b></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>