<app-common-message-box *ngIf="!(this.canAccess_feature_ViewUsers)"
    textToDisplay="{{ 'PRODUCTIVITYDASHBOARD.PERMISSION' | translate }}">
</app-common-message-box>
<ng-container *ngIf="(this.canAccess_feature_ViewUsers)">
    <div class="full-height">
        <mat-card class="p-0 m-0">
            <mat-card-title class="full-width data-table-header drag-handler">
                <!-- <div fxLayout="row wrap" fxLayoutGap="0" fxLayoutGap.xs="10px">
                <div fxFlex="150px" class="filter-section" fxLayoutAlign="start center">
                    <button type="submit" mat-icon-button class="pull-right" (click)="filterClick()"
                        matTooltip=" {{'HRMANAGAMENT.ADVANCESEARCH' | translate}}">
                        <fa-icon icon="filter" class="filter mat-color-accent">
                        </fa-icon>
                    </button>
                    <div [hidden]="!isOpen" fxLayout="row wrap">
                        <div fxFlex="90px" fxLayoutAlign="start center">
                            <ul>
                                <li [ngClass]="{ 'active': branchIsActive }" [satPopoverAnchorFor]="branchPopover"
                                    (click)="branchPopover.toggle()">
                                    <a>
                                        <mat-icon>arrow_drop_down</mat-icon>{{'HRMANAGAMENT.STATUS' | translate}}
                                    </a>
                                    <sat-popover #branchPopover verticalAlign="below" hasBackdrop
                                        horizontalAlign="start">
                                        <mat-card class="filter-data">
                                            <mat-form-field class="full-width">
                                                <mat-label>{{'HRMANAGAMENT.SELECTSTATUS' | translate}}</mat-label>
                                                <mat-select (selectionChange)="searchByEmployee($event.value)"
                                                    [(value)]="selectedStatusId">
                                                    <mat-option value="all">Both</mat-option>
                                                    <mat-option value="active">Active</mat-option>
                                                    <mat-option value="Inactive">Inactive</mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </mat-card>
                                    </sat-popover>
                                </li>
                            </ul>
                        </div> -->

                <div fxLayout="row wrap" fxLayout.xs="column">
                    <div fxFlex class="card-title-text p-05" fxLayoutAlign="start center">
                        {{'HRMANAGAMENT.USERMANAGEMENT' | translate | titlecase}}
                    </div>
                    <!-- <div fxFlex fxLayout="row" fxLayoutAlign="end center" fxLayoutAlign.xs="center center">
                    <div fxFlex class="filter-section" fxLayoutAlign="end center" [hidden]="!isOpen">
                        <ul>
                            <li [ngClass]="{ 'active': branchIsActive }" [satPopoverAnchorFor]="branchPopover"
                                (click)="branchPopover.toggle()">
                                <a>
                                    <mat-icon>arrow_drop_down</mat-icon>{{'HRMANAGAMENT.STATUS' | translate}}
                                </a>
                            </li>
                        </ul>
                    </div> -->
                    <div fxFlex.gt-xs="180px" class="ml-05 mr-05 search_goalinput" fxLayoutAlign="end center"
                        fxLayoutAlign.xs="center center">
                        <mat-form-field ngClass.xs="full-width">
                            <input class="search_goal" matInput placeholder="{{'SEARCH' | translate}}"
                                [(ngModel)]="searchText" (input)="search()">
                        </mat-form-field>
                        <span class="user-management-close">
                            <span *ngIf="!searchText">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                            <mat-icon *ngIf="searchText" class="icon-button" aria-hidden="false" (click)="closeSearch()"
                                style="cursor:pointer">
                                close</mat-icon>
                        </span>
                    </div>
                    <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center" class="ml-02">
                        <button mat-icon-button matTooltip="{{'RESET' | translate}}" (click)="resetAllFilters()">
                            <fa-icon class="filter mat-color-accent" icon="undo"></fa-icon>
                        </button>
                    </div>
                    <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center" class="ml-02"
                        *ngIf="(canAccess_feature_AddUser)">
                        <button type="submit" mat-icon-button>
                            <fa-icon class="filter mat-color-accent" matTooltip="{{'HRMANAGAMENT.ADDUSER' | translate}}"
                                #UserPopover="satPopoverAnchor" [satPopoverAnchorFor]="userPopup"
                                (click)="addUser(UserPopover)" icon="user-plus">
                            </fa-icon>
                        </button>
                    </div>
                    <div fxFlex="40px" fxFlex.xs="25px" fxLayoutAlign="end center" class="ml-02">
                        <button type="submit" mat-icon-button [matMenuTriggerFor]="filterMenu">
                            <fa-icon matTooltip=" {{'HRMANAGAMENT.ADVANCESEARCH' | translate}}" icon="user-cog"
                                class="filter mat-color-accent">
                            </fa-icon>
                        </button>
                    </div>
                </div>

            </mat-card-title>
        </mat-card>
        <div class="activity-data filter-margin m-0 no-drag pagination-move-left user-table-row" [ngClass] = "userManagementList.length == 0 ? 'productive-count' : ''">
            <ngx-datatable class="btrak" [columnMode]="'force'" [headerHeight]="35" [footerHeight]="35" [rowHeight]="35"
                [externalPaging]="true" [count]="page.totalElements" [offset]="page.pageNumber" [limit]="page.size"
                [scrollbarH]="true" [externalSorting]="true" [rows]="userManagementList" (sort)="onSort($event)"
                (page)='setPage($event)' [loadingIndicator]="isLoading" [virtualization]="false" (activate)="goToProfile($event)"
                [messages]="{emptyMessage:(searchText.trim().length > 0 ? ('SEARCHEDNODATATODISPLAY' | translate) : ('NODATATODISPLAY' | translate)), totalMessage: 'TOTAL' | translate}">
                <ngx-datatable-column minWidth="150" name="{{'HRMANAGAMENT.FULLNAME' | translate}}" [flexGrow]="1" cellClass="justifyContentStart"
                    prop='fullName'>
                    <ng-template let-row="row" ngx-datatable-cell-template>
                        <div class="icon-button" fxLayout="row">
                            <!-- <app-avatar [name]="row.fullName | removeSpecialCharacters" [src]="row.profileImage | fetchSizedAndCachedImage: '30':''"
                            [isRound]="true" size="30">
                        </app-avatar> -->
                            <div *ngIf="row.profileImage != null && row.profileImage != ''">
                                <app-avatar [src]="row.profileImage | fetchSizedAndCachedImage: '30':''"
                                    [isRound]="true" size="30">
                                </app-avatar>
                            </div>
                            <div *ngIf="row.profileImage == null || row.profileImage == ''">
                                <app-avatar [name]="row.fullName | removeSpecialCharacters" [isRound]="true" size="30">
                                </app-avatar>
                            </div>
                            <span class="ml-05 mt-02 hide-content-overflow" matTooltip="{{row.fullName}}"
                                matTooltipShowDelay="400" fxFlex>
                                {{ row?.fullName }}
                            </span>
                        </div>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column minWidth="150" name="{{'HRMANAGAMENT.EMAIL' | translate}}" [flexGrow]="1"
                    prop='email'>
                    <ng-template let-row="row" ngx-datatable-cell-template>
                        {{ row?.email}}
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column minWidth="150" name="{{'HRMANAGAMENT.ROLENAME' | translate}}" [flexGrow]="1"
                    prop='roleName'>
                    <ng-template let-row="row" ngx-datatable-cell-template>
                        {{ row?.roleName}}
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column minWidth="150" name="{{'HRMANAGAMENT.MOBILENO' | translate}}" [flexGrow]="1"
                    prop='mobileNo'>
                    <ng-template let-row="row" ngx-datatable-cell-template>
                        {{ row?.mobileNo}}
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column minWidth="150" name="{{'HRMANAGAMENT.TIMEZONE' | translate}}" [flexGrow]="1"
                    prop='mobileNo'>
                    <ng-template let-row="row" ngx-datatable-cell-template>
                        {{ row?.timeZoneName}}
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column minWidth="150" name="{{'HRMANAGAMENT.DESKTOP' | translate}}" [flexGrow]="1"
                    prop='desktopName'>
                    <ng-template let-row="row" ngx-datatable-cell-template>
                        {{ row?.desktopName}}
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column minWidth="150" name="{{'HRMANAGAMENT.LANGUAGE' | translate}}" [flexGrow]="1"
                    prop='language'>
                    <ng-template let-row="row" ngx-datatable-cell-template>
                        {{ row?.language}}
                        <span *ngIf="row.language == null">{{ row?.companyLanguage}}</span>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column minWidth="150" name="{{'HRMANAGAMENT.ISACTIVE' | translate}}" [flexGrow]="1"
                    prop='isActive'>
                    <ng-template let-row="row" ngx-datatable-cell-template>
                        <span *ngIf="(row?.isActive)">
                            {{ 'YES' | translate}}
                        </span>
                        <span *ngIf="!(row?.isActive)">
                            {{ 'NO' | translate }}
                        </span>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column minWidth="150" name="{{'HRMANAGAMENT.ISEXTERNAL' | translate}}" [flexGrow]="1"
                    prop='isExternal'>
                    <ng-template let-row="row" ngx-datatable-cell-template>
                        <span *ngIf="(row?.isExternal)">
                            {{ 'YES' | translate}}
                        </span>
                        <span *ngIf="!(row?.isExternal)">
                            {{ 'NO' | translate }}
                        </span>
                    </ng-template>
                </ngx-datatable-column>

                <!-- <ngx-datatable-column name="{{'HRMANAGAMENT.ISADMIN' | translate}}" [flexGrow]="1">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                            <span class="{{row.isAdmin ? 'Yes' : 'No'}}">
                                {{row?.isAdmin ? "Yes" : "No"}}
                            </span>
                        </ng-template>
                    </ngx-datatable-column> -->

                <!-- ENABLE TRACKING -->
                <!-- <ngx-datatable-column minWidth="150" name="{{'ACTIVITYAPPS.ENABLETRACKING' | translate}}" [flexGrow]="1"
                    [sortable]="false" *ngIf="(canAccess_feature_ConfigureEmployeeTracking)">
                    <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                        <button class="text-center" matTooltip="{{'ACTIVITYAPPS.ENABLETRACKING' | translate}}"
                            *ngIf="(canAccess_feature_ConfigureEmployeeTracking) && !row.trackEmployee"
                            [satPopoverAnchorFor]="addTrackerPopovers" #addTrackerPopover="satPopoverAnchor"
                            (click)="trackEmployee(row,addTrackerPopover);$event.stopPropagation()" mat-icon-button>
                            <fa-icon icon="cog" class="mat-color-accent"></fa-icon>
                        </button>
                        <button class="text-center" matTooltip="{{'ACTIVITYAPPS.ENABLEDTRACKING' | translate}}"
                            *ngIf="(canAccess_feature_ConfigureEmployeeTracking) && row.trackEmployee"
                            [satPopoverAnchorFor]="addTrackerPopovers" #addTrackerPopover="satPopoverAnchor"
                            (click)="trackEmployee(row,addTrackerPopover);$event.stopPropagation()" mat-icon-button>
                            <mat-icon style="color: red !important;">fiber_manual_record</mat-icon>
                        </button>
                    </ng-template>
                </ngx-datatable-column> -->
                <!-- ENABLE TRACKING -->

                <ngx-datatable-column minWidth="150" name="{{'HRMANAGAMENT.EDIT' | translate}}" [flexGrow]="1"
                    [sortable]="false" *ngIf="(canAccess_feature_UpdateUser)">
                    <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                        <fa-icon class="icon-button mat-color-accent mr-05" icon="edit"
                            matTooltip="{{'HRMANAGAMENT.EDITUSER' | translate}}" #UserPopover="satPopoverAnchor"
                            [satPopoverAnchorFor]="userPopup" (click)="editUser(row,UserPopover);$event.stopPropagation();"> </fa-icon>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column minWidth="150" name="{{'HRMANAGAMENT.CHANGEPASSWORD' | translate}}" [flexGrow]="1"
                    [sortable]="false" *ngIf="(canAccess_feature_ResetPassword)">
                    <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                        <button mat-icon-button [disabled]="!row.isActive"
                            matTooltip="{{'HRMANAGAMENT.CHANGEPASSWORD' | translate}}"
                            #updatePasswordPopover="satPopoverAnchor" [satPopoverAnchorFor]="updatePasswordPopup"
                            (click)="updatePassword(row,updatePasswordPopover);$event.stopPropagation();">
                            <fa-icon icon="key" class="mat-color-accent">
                            </fa-icon>
                        </button>
                    </ng-template>
                </ngx-datatable-column>
            </ngx-datatable>
        </div>
        <sat-popover #userPopup [autoFocus]="false" hasBackdrop backdropClass="backdrop-color" [restoreFocus]="false"
            [interactiveClose]="false" scrollStrategy="reposition" verticalAlign="below" horizontalAlign="end">
            <mat-card class="filter-data p-0">
                <mat-card-title class="text-center">
                    <div class="card-title-text mat-bg-primary p-05" *ngIf="isFromAdd == false">
                        {{'USERMANAGEMENT.UPDATEUSER' | translate}}
                    </div>
                    <div class="card-title-text mat-bg-primary p-05" *ngIf="isFromAdd == true">
                        {{'HRMANAGAMENT.ADDUSER' | translate}}
                    </div>
                </mat-card-title>
                <form [formGroup]="updateForm" novalidate #formDirective="ngForm"
                    (submit)="updateForm.valid && updateUser()">
                    <div class="card-content p-05">
                        <div fxLayout="row wrap">
                            <div fxFlex="100" fxFlex.gt-sm="47" class="mr-1">
                                <input type="hidden" formControlName="userId"
                                    placeholder="{{'USERMANAGEMENT.USERID' | translate}}"
                                    (click)="$event.stopPropagation();">
                                <input type="hidden" formControlName="password" placeholder="{{'PASSWORD' | translate}}"
                                    (click)="$event.stopPropagation();">
                                <mat-form-field class="full-width" (click)="$event.stopPropagation();">
                                    <input matInput formControlName="firstName" removeSpecialCharacters
                                        placeholder="{{'HRMANAGAMENT.FIRSTNAME' | translate}}"
                                        (keyup)="removeSpecialCharacterForFirstName()" required>
                                    <mat-error>
                                        <span
                                            *ngIf="updateForm.get('firstName').hasError('required') && updateForm.get('firstName').touched">
                                            {{'HRMANAGAMENT.PLEASEENTERFIRSTNAME' | translate}}</span>
                                        <span *ngIf="updateForm.get('firstName').hasError('maxlength')">
                                            {{'HRMANAGAMENT.FIRSTNAMESHOULDNOTEXCEED50CHARACTERS' | translate}}</span>
                                    </mat-error>
                                </mat-form-field>
                                <mat-error>
                                    <span
                                        *ngIf="isAllowSpecialCharacterForFirstName == false">{{ 'HRMANAGAMENT.FIRSTNAMECANNOTSTARTWITHSPECIALCHARACTERS' | translate }}</span>
                                </mat-error>
                            </div>
                            <div fxFlex="100" fxFlex.gt-sm="47">
                                <mat-form-field class="full-width" (click)="$event.stopPropagation();">
                                    <input matInput formControlName="surName"
                                        placeholder="{{'HRMANAGAMENT.LASTNAME' | translate}}" removeSpecialCharacters
                                        (keyup)="removeSpecialCharacterForLastName()" required>
                                    <mat-error>
                                        <span
                                            *ngIf="updateForm.get('surName').hasError('required') && updateForm.get('surName').touched">
                                            {{'HRMANAGAMENT.PLEASEENETERSURNAME' | translate}}</span>
                                        <span *ngIf="updateForm.get('surName').hasError('maxlength')">
                                            {{'HRMANAGAMENT.SURNAMESHOULDNOTEXCEED50CHARACTERS' | translate}}</span>
                                    </mat-error>
                                </mat-form-field>
                                <mat-error>
                                    <span
                                        *ngIf="isAllowSpecialCharacterForLastName == false">{{ 'HRMANAGAMENT.LASTNAMECANNOTSTARTWITHSPECIALCHARACTERS' | translate }}</span>
                                </mat-error>
                            </div>
                        </div>
                        <div fxLayout="row wrap">
                            <div fxFlex="100" fxFlex.gt-sm="47" class="mr-1">
                                <mat-form-field class="full-width" (click)="$event.stopPropagation();">
                                    <input matInput formControlName="mobileNo"
                                        placeholder="{{'USERMANAGEMENT.MOBILENUMBER' | translate}}" mobileNumber
                                        autocomplete="off">
                                    <mat-error>
                                        <span *ngIf="updateForm.get('mobileNo').hasError('maxlength')">
                                            {{'EMERGENCYCONTACTDETAILS.SHOULDNOTEXCEED20DIGITS' | translate}}</span>
                                        <span
                                            *ngIf="updateForm.get('mobileNo').hasError('required')&& updateForm.get('mobileNo').touched">
                                            {{'HRMANAGAMENT.PLEASEENTERMOBILENUMBER' | translate}}</span>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                            <div fxFlex="100" fxFlex.gt-sm="47">
                                <mat-form-field class="full-width" (click)="$event.stopPropagation();">
                                    <input matInput formControlName="email"
                                        placeholder="{{'USERMANAGEMENT.EMAIL' | translate}}" required>
                                    <mat-error>
                                        <span
                                            *ngIf="updateForm.get('email').hasError('required') && updateForm.get('email').touched">
                                            {{'HRMANAGAMENT.PLEASEENTEREMAIL' | translate}}</span>
                                        <span *ngIf="updateForm.get('email').hasError('pattern')">
                                            {{'EMPLOYEECONTACTDETAILS.VALIDEMAIL' | translate }}</span>
                                        <span *ngIf="updateForm.get('email').hasError('maxlength')">
                                            {{'HRMANAGAMENT.EMAILSHOULDNOTEXCEED50CHARACTERS' | translate}}</span>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                        <div fxLayout="row wrap">
                            <div fxFlex="100" fxFlex.gt-sm="47" class="mr-1">
                                <mat-form-field class="full-width" (click)="$event.stopPropagation();">
                                    <mat-select formControlName="roleIds"
                                        placeholder="{{'USERMANAGEMENT.ROLE' | translate}}"
                                        [compareWith]="compareSelectedRolesFn" required multiple
                                        (selectionChange)="getSelectedRoles()">
                                        <mat-select-trigger>
                                            {{selectedRoles}}
                                        </mat-select-trigger>
                                        <mat-option [value]="0" #allRolesSelected (click)="toggleAllRolesSelected()">
                                            Select all
                                        </mat-option>
                                        <mat-option [value]="roles.roleId" *ngFor="let roles of rolesDropDown"
                                            (click)="toggleGoalStatusPerOne($event)">
                                            {{roles.roleName}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-error>
                                        <span
                                            *ngIf="updateForm.get('roleIds').hasError('required')&& updateForm.get('roleIds').touched">
                                            {{'USERSTORY.PLEASESELECTROLE' | translate}}</span>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                            <div fxFlex fxFlex.gt-xl="50">
                                <mat-form-field class="full-width">
                                    <!--<mat-select placeholder="{{'HRMANAGAMENT.TIMEZONE' | translate}}"
                                        formControlName="timeZoneId">
                                        <mat-option *ngFor="let timeZone of timeZoneList$ | async"
                                            [value]="timeZone.timeZoneId">
                                            {{timeZone.timeZoneTitle}}</mat-option>
                                    </mat-select>-->
                                    <input type="text" matInput placeholder="{{'HRMANAGAMENT.TIMEZONE' | translate}}"
                                    formControlName="timeZoneId" [matAutocomplete]="auto" (keyup)="searchtimeZone($event.code,$event.target.value)">
                                    <mat-autocomplete class="mat-select-panel" #auto="matAutocomplete" [displayWith]="displayFn.bind(this)"
                                    (optionSelected)="selectedTimeZone($event)">
                                        <mat-option *ngFor="let timeZone of timeZonesList"
                                            [value]="timeZone.timeZoneId">
                                            {{timeZone.timeZoneTitle}}</mat-option>
                                    </mat-autocomplete>
                                </mat-form-field>
                            </div>
                        </div>
                        <div fxLayout="row wrap">
                            <div fxFlex="100" fxFlex.gt-sm="47" class="mr-1">
                                <mat-form-field class="full-width" (click)="$event.stopPropagation();">
                                    <mat-select placeholder="{{'HRMANAGAMENT.LANGUAGE' | translate}}"
                                        formControlName="language">
                                        <mat-option *ngFor="let language of userLanguages" [value]="language.code">
                                            {{language.name}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div fxFlex fxFlex.gt-xl="50">
                                <mat-form-field class="full-width">
                                    <!--<mat-select placeholder="{{'HRMANAGAMENT.DESKTOP' | translate}}"
                                        formControlName="desktopId">
                                        <mat-option *ngFor="let desktop of desktopsDropdown"
                                            [value]="desktop.desktopId">
                                            {{desktop.desktopName}}</mat-option>
                                    </mat-select>-->
                                    <input type="text" matInput placeholder="{{'HRMANAGAMENT.DESKTOP' | translate}}"
                                    formControlName="desktopId" [matAutocomplete]="auto1" (keyup)="searchdesktop($event.code,$event.target.value)">
                                    <mat-autocomplete class="mat-select-panel" #auto1="matAutocomplete" [displayWith]="display1Fn.bind(this)"
                                    (optionSelected)="selectedDesktop($event)">
                                        <mat-option *ngFor="let desktop of desktopsDropdown"
                                        [value]="desktop.desktopId" matTooltip=" {{desktop.desktopName}}" [matTooltipDisabled]="desktop.desktopName == 'Select none'">
                                        {{desktop.desktopName}}</mat-option>
                                    </mat-autocomplete>
                                </mat-form-field>
                            </div>
                        </div>
                        <div fxLayout="row wrap">
                            <div fxFlex="100" fxFlex.gt-sm="47" class="mr-1">
                                <mat-form-field class="full-width" (click)="$event.stopPropagation();">
                                    <mat-select formControlName="moduleIds"
                                        placeholder="{{'HRMANAGAMENT.ENABLEINTRO' | translate}}"
                                        [compareWith]="compareSelectedModulesFn"  multiple
                                        (selectionChange)="getSelectedModules()">
                                        <mat-select-trigger>
                                            {{selectedModules}}
                                        </mat-select-trigger>
                                        <mat-option [value]="0" #allModulesSelected (click)="toggleAllModulesSelected()">
                                            Select all
                                        </mat-option>
                                        <mat-option [value]="modules.moduleId" *ngFor="let modules of modulesDropDown"
                                        (click)="toggleGoalStatusPerOnemodule($event)">
                                            {{modules.moduleName}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-hint>
                                        {{'HRMANAGAMENT.SELECTMODULETOENABLEINTRO' | translate}}
                                    </mat-hint>
                                   <!-- <mat-error>
                                        <span
                                            *ngIf="updateForm.get('moduleIds').hasError('required')&& updateForm.get('moduleIds').touched">
                                            {{'USERSTORY.PLEASESELECTMODULE' | translate}}</span>
                                    </mat-error>-->
                                </mat-form-field>
                            </div>
                            <div class="mt-1" fxFlex fxFlex.gt-xl="50">
                                <mat-checkbox formControlName="isActive" (click)="$event.stopPropagation();"
                                    class="mb-1 checkbox-text mr-1">
                                    {{'USERMANAGEMENT.ISACTIVE' | translate}}</mat-checkbox>
                            </div>
                        </div>
                        <div fxLayout="row wrap">
                            <div class="mt-1" fxFlex fxFlex.gt-xl="50">
                                <mat-checkbox formControlName="isExternal" (click)="$event.stopPropagation();"
                                    class="mb-1 checkbox-text mr-1">
                                    {{'USERMANAGEMENT.ISEXTERNAL' | translate}}</mat-checkbox>
                            </div>
                        </div>
                    </div>
                    <div class="text-center mb-1">
                        <button mat-button mat-raised-button class="mr-05" color="primary" type="submit"
                            [disabled]="(UpdateOperationInProgress$ | async) || !updateForm.valid || isAllowSpecialCharacterForFirstName == false  || isAllowSpecialCharacterForLastName == false">
                            <mat-progress-bar color="primary" mode="indeterminate"
                                *ngIf="(UpdateOperationInProgress$ | async)">
                            </mat-progress-bar>
                            <fa-icon *ngIf="isFromAdd == false" class="mr-05" icon="sync"></fa-icon>
                            <fa-icon *ngIf="isFromAdd == true" class="mr-05" icon="plus"></fa-icon>
                            <span *ngIf="isFromAdd == false">{{'USERMANAGEMENT.UPDATEUSER' | translate}}</span>
                            <span *ngIf="isFromAdd == true">{{'HRMANAGAMENT.ADDUSER' | translate}}</span>
                        </button>
                        <button mat-button mat-raised-button class="mr-05" (click)="closeDialog();false">
                            <fa-icon icon="times" class="mr-05" aria-hidden="true"></fa-icon> {{'CANCEL' | translate}}
                        </button>
                    </div>
                </form>
            </mat-card>
        </sat-popover>
        <sat-popover #updatePasswordPopup [autoFocus]="false" hasBackdrop backdropClass="backdrop-color"
            [restoreFocus]="false" [interactiveClose]="false" scrollStrategy="reposition" verticalAlign="below"
            horizontalAlign="end">
            <mat-card class="filter-data p-0">
                <mat-card-title class="text-center">
                    <div class="card-title-text mat-bg-primary p-05">{{'USERMANAGEMENT.CHANGEPASSWORD' | translate}}
                    </div>
                </mat-card-title>
                <form [formGroup]="changePasswordForm" novalidate #passwordFormDirective="ngForm"
                    (submit)="changePasswordForm.valid && changePassword()">
                    <div class="card-content p-05 mt-05">
                        <mat-form-field class="full-width" (click)="$event.stopPropagation();">
                            <input matInput formControlName="newPassword" type="password"
                                placeholder="{{'USERMANAGEMENT.NEWPASSWORD' | translate}}" required>
                            <mat-error>
                                <span
                                    *ngIf="changePasswordForm.get('newPassword').hasError('required') && changePasswordForm.get('newPassword').touched">
                                    {{'USERMANAGEMENT.PLEASEENTERNEWPASSWORD' | translate}}</span>
                                <span
                                    *ngIf="changePasswordForm.get('newPassword').hasError('pattern') && !(changePasswordForm.get('newPassword').hasError('maxlength'))">
                                    {{'USERMANAGEMENT.PLEASEENTERVALIDPASSWORD' | translate}}</span>
                                <span *ngIf="changePasswordForm.get('newPassword').hasError('maxlength')">
                                    {{'USERMANAGEMENT.NEWPASSWORDSHOULDNOTEXCEED250CHARACTERS' | translate}}</span>
                            </mat-error>
                        </mat-form-field>
                        <mat-form-field class="full-width mt-1" (click)="$event.stopPropagation();">
                            <input matInput formControlName="confirmPassword" type="password"
                                (blur)="passwordConfirmation()"
                                placeholder="{{'USERMANAGEMENT.CONFIRMPASSWORD' | translate}}" required>
                            <mat-error>
                                <span
                                    *ngIf="changePasswordForm.get('confirmPassword').hasError('required') && changePasswordForm.get('confirmPassword').touched">
                                    {{'USERMANAGEMENT.PLEASEENTERCONFIRMPASSWORD' | translate}}</span>
                                <span *ngIf="changePasswordForm.get('confirmPassword').hasError('maxlength')">
                                    {{'USERMANAGEMENT.CONFIRMPASSWORDCANNOTEXCEED250CHARACTERS' | translate}}</span>
                            </mat-error>
                        </mat-form-field>
                        <mat-error>
                            <span *ngIf="isPassword">{{'USERMANAGEMENT.PASSWORDSSHOULDMATCH' | translate}}</span>
                        </mat-error>
                    </div>
                    <div class="text-center mb-1 mt-05">
                        <button type="submit" mat-button mat-raised-button class="mr-05" color="primary"
                            [disabled]="(changePasswordOperationInProgress$ | async) || !changePasswordForm.valid || isPassword">
                            <mat-progress-bar color="primary" mode="indeterminate"
                                *ngIf="(changePasswordOperationInProgress$ | async)">
                            </mat-progress-bar>
                            <fa-icon class="mr-05" icon="edit"></fa-icon> {{'USERMANAGEMENT.CHANGE' | translate}}
                        </button>
                        <button mat-button mat-raised-button (click)="closePopup();false">
                            <fa-icon class="mr-05" icon="times"></fa-icon> {{'CANCEL' | translate}}
                        </button>
                    </div>
                </form>
            </mat-card>
        </sat-popover>
        <!-- <sat-popover #branchPopover verticalAlign="below" hasBackdrop horizontalAlign="start">
        <mat-card class="filter-data">
           
            <mat-form-field class="full-width" *ngIf = "entities?.length > 1">
                <mat-select placeholder="{{ 'WIDGETS.SELECTBRANCH' | translate }}" [(ngModel)]="selectedEntity"
                  (selectionChange)="entityValues($event.value)">
                  <mat-option *ngFor="let entity of entities" [value]="entity.id">
                    {{entity.name}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
        </mat-card>
    </sat-popover> -->
        <mat-menu #filterMenu="matMenu" xPosition="before" class="custom-matpanel">
            <mat-card class="filter-data" (click)="$event.stopPropagation()">
                <mat-form-field class="full-width">
                    <mat-label>{{'HRMANAGAMENT.SELECTSTATUS' | translate}}</mat-label>
                    <mat-select (selectionChange)="searchByEmployee($event.value)" [(value)]="selectedStatusId">
                        <mat-option value="all">Both</mat-option>
                        <mat-option value="active">Active</mat-option>
                        <mat-option value="Inactive">Inactive</mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-form-field class="full-width" *ngIf="entities?.length > 1">
                    <mat-select placeholder="{{ 'WIDGETS.SELECTBRANCH' | translate }}" [(ngModel)]="selectedEntity"
                        (selectionChange)="entityValues($event.value)">
                        <mat-option *ngFor="let entity of entities" [value]="entity.id">
                            {{entity.name}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </mat-card>
        </mat-menu>

        <!-- ENABLE TRACKING -->
        <sat-popover #addTrackerPopovers [autoFocus]="false" hasBackdrop backdropClass="backdrop-color"
            [restoreFocus]="false" [interactiveClose]="false" verticalAlign="center" horizontalAlign="end">
            <mat-card class="filter-data p-0">
                <mat-card-title class="text-center">
                    <div class="card-title-text mat-bg-primary p-05">
                        {{'ACTIVITYTRACKER.TRACKUSER' | translate}}
                    </div>
                </mat-card-title>
                <form [formGroup]="activityForm" novalidate #formDirective="ngForm"
                    (submit)="activityForm.valid && upsertTracker()">
                    <div class="apps-popover p-1" id="style-1">
                        <div fxLayout="column" fxLayout.xs="column" fxLayoutGap="10px" fxLayoutGap.xs="0px">
                            <div fxFlex="100">
                                <mat-checkbox formControlName="isTrack" (change)="changeTrack()"
                                    class="full-width mt-1">
                                    {{'ACTIVITYTRACKER.TRACKUSER' | translate }}</mat-checkbox>
                            </div>
                            <div fxFlex="100" [hidden]="!track">
                                <div fxLayout="row wrap" fxLayout.xs="column" class="m-1">
                                    <div fxFlex="80">
                                        <span>{{'ACTIVITYAPPS.TRACKAPPANDURLS' | translate}}</span>
                                    </div>
                                    <div fxFlex="20">
                                        <mat-slide-toggle formControlName="isTracking" (change)="detectTrackingChange()"
                                            class="ml-1">
                                        </mat-slide-toggle>
                                    </div>
                                </div>
                                <div *ngIf="appsTrack">
                                    <div class="pb-05 marg-left">
                                        <span>{{'ACTIVITYAPPS.CONTROLWHEATHER' | translate}}</span></div>
                                    <nav class="mt-1 marg-left">
                                        <mat-button-toggle-group formControlName="app"
                                            class="custom-button-group1 custom-button mat-button-item"
                                            style='border-radius:20px'>
                                            <mat-button-toggle (click)="onClickTrackAlloff();" value="off">
                                                {{'ACTIVITYAPPS.OFF' | translate}}
                                            </mat-button-toggle>
                                            <mat-button-toggle (click)="onClickTrackAllApps();" value="App">
                                                {{'ACTIVITYAPPS.APPS' | translate}}
                                            </mat-button-toggle>
                                            <mat-button-toggle (click)="onClickTrackAllAppsUrls();" value="AppandUrl">
                                                {{'ACTIVITYAPPS.APPSANDURLS' | translate}}
                                            </mat-button-toggle>
                                            <mat-button-toggle (click)="onClickTrackAllAppsUrlsDetailed();"
                                                value="AppandUrlDetailed">
                                                {{'ACTIVITYAPPS.APPSANDURLSDETAILED' | translate}}
                                            </mat-button-toggle>
                                            <mat-button-toggle (click)="onClickTrackUrls();" value="Url">
                                                {{'ACTIVITYAPPS.URLS' | translate}}
                                            </mat-button-toggle>
                                        </mat-button-toggle-group>
                                    </nav>
                                </div>
                            </div>
                            <div fxFlex="100" [hidden]="!track">
                                <div fxLayout="row wrap" fxLayout.xs="column" class="m-1">
                                    <div fxFlex="80">
                                        <span>{{'ACTIVITYAPPS.SCREENSHOTFREQUENCY' | translate}}</span>
                                    </div>
                                    <div fxFlex="20">
                                        <mat-slide-toggle formControlName="isScreenshotTracking"
                                            (change)="detectScreenshotChange()" class="ml-1"></mat-slide-toggle>
                                    </div>
                                </div>
                                <div *ngIf="isScreenshot">
                                    <div class="pb-05">
                                        <span class="m-1 ml-0">{{'ACTIVITYAPPS.NUMBEROFSCREENSHOTS' | translate}}</span>
                                        <input class="mr-05" style='width:45px' type="number" min="0"
                                            formControlName="shotTime"
                                            (keypress)="omitSpecialChar($event);onChangeScreenShotCount()"
                                            (paste)="omitSpecialChar($event);onChangeScreenShotCount()"
                                            (change)="omitSpecialChar($event);onChangeScreenShotCount()" /></div>
                                    <nav class="mt-1">
                                        <mat-button-toggle-group
                                            class="custom-button-group custom-button  mat-button-item"
                                            style='border-radius:20px' formControlName="shotFrequency">
                                            <mat-button-toggle (click)="onChangeScreenShotFrequency(0)" value="0">
                                                {{'ACTIVITYAPPS.NONE' | translate}}
                                            </mat-button-toggle>
                                            <mat-button-toggle (click)="onChangeScreenShotFrequency(1)" value="1">1x
                                            </mat-button-toggle>
                                            <mat-button-toggle (click)="onChangeScreenShotFrequency(2)" value="2">2x
                                            </mat-button-toggle>
                                            <mat-button-toggle (click)="onChangeScreenShotFrequency(3)" value="3">3x
                                            </mat-button-toggle>
                                        </mat-button-toggle-group>
                                    </nav>
                                </div>
                            </div>
                            <div fxFlex="100" [hidden]="!track">
                                <div fxLayout="row wrap" fxLayout.xs="column" class="m-1">
                                    <div fxFlex="80">
                                        <span>{{'ACTIVITYAPPS.RECORDACTIVITY' | translate}}</span>
                                    </div>
                                    <div fxFlex="20">
                                        <mat-slide-toggle formControlName="isKeyboardTracking" class="ml-1"
                                            (change)="changeKeyboard()">
                                        </mat-slide-toggle>
                                    </div>
                                </div>
                            </div>
                            <div fxFlex="100" [hidden]="!track">
                                <div fxLayout="row wrap" fxLayout.xs="column" class="m-1">
                                    <div fxFlex="80">
                                        <span>{{'ACTIVITYAPPS.MOUSETRACKING' | translate}}</span>
                                    </div>
                                    <div fxFlex="20">
                                        <mat-slide-toggle formControlName="isMouseTracking" class="ml-1"
                                            (change)="changeMouse()">
                                        </mat-slide-toggle>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mobile-view-popover p-1">
                        <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="10px" fxLayoutGap.xs="0px">
                        </div>
                    </div>
                    <div class="text-center mb-1 prl-1">
                        <button mat-raised-button color="primary" class="mr-05" (click)="$event.stopPropagation()"
                            [disabled]="upsertEnableTracking || !activityForm.valid">
                            <mat-progress-bar color="primary" mode="indeterminate" *ngIf="upsertEnableTracking">
                            </mat-progress-bar>
                            <fa-icon icon="save" class="mr-05"></fa-icon> {{'ACTIVITYTRACKER.SAVE' | translate}}
                        </button>
                        <button mat-raised-button (click)="closeTrackDialog()" type="reset"
                            [disabled]="upsertEmployeeInProgress$ | async">
                            <fa-icon icon="times" class="mr-05"></fa-icon> {{'CANCEL' | translate}}
                        </button>
                    </div>
                </form>
            </mat-card>
        </sat-popover>
        <!-- ENABLE TRACKING -->

    </div>
</ng-container>