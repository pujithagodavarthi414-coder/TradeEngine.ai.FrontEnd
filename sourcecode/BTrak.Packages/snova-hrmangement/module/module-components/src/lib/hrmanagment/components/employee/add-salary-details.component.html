<mat-card-title class="text-center">
    <div class="card-title-text mat-bg-primary p-05" *ngIf="!employeeSalaryDetailsId">
        {{'HRMANAGAMENT.ADDSALARYDETAILS' | translate}}</div>
    <div class="card-title-text mat-bg-primary p-05" *ngIf="employeeSalaryDetailsId">
        {{'HRMANAGAMENT.EDITSALARYDETAILS' | translate}}</div>
</mat-card-title>
<div class="mat-dialog-padding">
    <form [formGroup]="employeeSalaryDetailsForm" novalidate #formDirective="ngForm"
        (submit)="employeeSalaryDetailsForm.valid && saveEmployeeSalaryDetails()">
        <div class="mobile-view-popover p-1">
            <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="10px" fxLayoutGap.xs="0px">
                <div fxFlex="50" fxFlex.xs="100">
                    <mat-form-field class="full-width">
                        <mat-select formControlName="payGradeId" placeholder="{{'HRMANAGAMENT.PAYGRADE' | translate}}"
                            required>
                            <mat-option *ngFor="let level of selectPayGradeListData$ | async"
                                [value]="level.payGradeId">
                                {{level.payGradeName}}
                            </mat-option>
                        </mat-select>
                        <mat-error>
                            <span
                                *ngIf="employeeSalaryDetailsForm.get('payGradeId').hasError('required') && employeeSalaryDetailsForm.get('payGradeId').touched">
                                {{'HRMANAGAMENT.PLEASESELECTPAYGRADE' | translate}}</span>
                        </mat-error>
                    </mat-form-field>
                </div>
                <div fxFlex="50" fxFlex.xs="100">
                    <mat-form-field class="full-width">
                        <input matInput formControlName="salaryComponent"
                            placeholder="{{'HRMANAGAMENT.SALARYCOMPONENT' | translate}}" required>
                        <mat-error>
                            <span
                                *ngIf="employeeSalaryDetailsForm.get('salaryComponent').hasError('required') && employeeSalaryDetailsForm.get('salaryComponent').touched">
                                {{'HRMANAGAMENT.PLEASEENTERSALARYCOMPONENT' | translate}}</span>
                            <span
                                *ngIf="employeeSalaryDetailsForm.get('salaryComponent').hasError('maxlength') && employeeSalaryDetailsForm.get('salaryComponent').touched">
                                {{'HRMANAGAMENT.SHOULDNOTEXCEED50CHARACTERS' | translate}}</span>
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>
            <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="10px" fxLayoutGap.xs="0px">
                <div fxFlex="50" fxFlex.xs="100">
                    <mat-form-field class="full-width">
                        <mat-select formControlName="payFrequencyId"
                            placeholder="{{'HRMANAGAMENT.PAYFREQUENCY' | translate}}" required>
                            <mat-option *ngFor="let level of selectPayFrequencyListData$ | async"
                                [value]="level.payFrequencyId">
                                {{level.payFrequencyName}}
                            </mat-option>
                        </mat-select>
                        <mat-error>
                            <span
                                *ngIf="employeeSalaryDetailsForm.get('payFrequencyId').hasError('required') && employeeSalaryDetailsForm.get('payFrequencyId').touched">
                                {{'HRMANAGAMENT.PLEASESELECTPAYFREQUENCY' | translate}}</span>
                        </mat-error>
                    </mat-form-field>
                </div>
                <div fxFlex="50" fxFlex.xs="100">
                    <mat-form-field class="full-width">
                        <mat-select formControlName="paymentMethodId"
                            placeholder="{{'HRMANAGAMENT.PAYMENTMETHOD' | translate}}" required>
                            <mat-option *ngFor="let level of selectPaymentMethodListData$ | async"
                                [value]="level.paymentMethodId">
                                {{level.paymentMethodName}}
                            </mat-option>
                        </mat-select>
                        <mat-error>
                            <span
                                *ngIf="employeeSalaryDetailsForm.get('paymentMethodId').hasError('required') && employeeSalaryDetailsForm.get('paymentMethodId').touched">
                                {{'HRMANAGAMENT.PLEASESELECTPAYMENTMETHOD' | translate}}</span>
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>
            <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="10px" fxLayoutGap.xs="0px">
                <div fxFlex="50" fxFlex.xs="100">
                    <mat-form-field class="full-width">
                        <mat-select formControlName="currencyId"
                            placeholder="{{'EMPLOYEEMEMBERSHIP.CURRENCY' | translate}}" required>
                            <mat-option *ngFor="let currency of currencyList$ | async" [value]="currency.currencyId">
                                {{currency.currencyName}}</mat-option>
                        </mat-select>
                        <mat-error>
                            <span
                                *ngIf="employeeSalaryDetailsForm.get('currencyId').hasError('required') && employeeSalaryDetailsForm.get('currencyId').touched">
                                {{'EMPLOYEEMEMBERSHIP.PLEASESELECTCURRENCY' | translate}}</span>
                        </mat-error>
                    </mat-form-field>
                </div>
                <div fxFlex="50" fxFlex.xs="100">
                    <mat-form-field class="full-width">
                        <input matInput formControlName="amount"
                            placeholder="{{'HRMANAGAMENT.TOTALSALARY' | translate}}" type="number" min="0" amountOnly
                            autocomplete="off" (change)="setNetPayMaxValue()" required>
                        <mat-error>
                            <span
                                *ngIf="employeeSalaryDetailsForm.get('amount').hasError('required') && employeeSalaryDetailsForm.get('amount').touched">
                                {{'HRMANAGAMENT.TOTALSALARYISREQUIRED' | translate}}</span>
                            <span
                                *ngIf="employeeSalaryDetailsForm.get('amount').hasError('max')&& employeeSalaryDetailsForm.get('currencyId').touched">
                                {{'HRMANAGAMENT.SHOULDNOTEXCEED13CHARACTERS' | translate}}</span>
                            <span
                                *ngIf="employeeSalaryDetailsForm.get('amount').hasError('min')">{{'HRMANAGAMENT.AMOUNTSHOULDBEGREATERTHAN0' | translate}}</span>
                        </mat-error>
                    </mat-form-field>
                </div>

                <div fxFlex="50" fxFlex.xs="100">
                    <mat-form-field class="full-width">
                        <input matInput formControlName="netPayAmount"
                            placeholder="{{'HRMANAGAMENT.NETPAYAMOUNT' | translate}}" type="number" min="0"
                            max="netPayLimit" amountOnly autocomplete="off">
                        <mat-error>
                            <span
                                *ngIf="employeeSalaryDetailsForm.get('netPayAmount').hasError('max') && employeeSalaryDetailsForm.get('netPayAmount').touched">
                                {{'HRMANAGAMENT.NETPAYMAXLIMIT' | translate}}</span>
                            <span
                                *ngIf="employeeSalaryDetailsForm.get('netPayAmount').hasError('min')">{{'HRMANAGAMENT.AMOUNTSHOULDBEGREATERTHAN0' | translate}}</span>
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>
            <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="10px" fxLayoutGap.xs="0px"
                *ngIf="isAccessPayRollTemplate">
                <div fxFlex="50" fxFlex.xs="100">
                    <mat-form-field class="full-width">
                        <mat-select formControlName="payrollTemplateId" placeholder="Template"
                            (selectionChange)="changeTemplate()">
                            <mat-option [value]="template.payRollTemplateId" *ngFor="let template of employeeTemplates">
                                {{template.payRollTemplateName}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div fxFlex="50" fxFlex.xs="100">
                    <mat-form-field class="full-width">
                        <input matInput formControlName="takeHomeAmount" readonly="true"
                            placeholder="{{'HRMANAGAMENT.TAKEHOMEAMOUNT' | translate}}" type="text" amountOnly
                            autocomplete="off">
                    </mat-form-field>
                </div>
            </div>
            <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="10px" fxLayoutGap.xs="0px">
                <div fxFlex="31" fxFlex.xs="100">
                    <mat-form-field class="full-width">
                        <input matInput formControlName="startDate" [matDatepicker]="picker1"
                            (click)="picker1.open();checkDateRangesForTemplates()"
                            (blur)="checkDateRangesForTemplates()"
                            placeholder="{{'HRMANAGAMENT.STARTDATE' | translate}}" (input)="startDate()"
                            (dateChange)="startDate()" autocomplete="off" required>
                        <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                        <mat-datepicker #picker1></mat-datepicker>
                        <mat-error>
                            <span *ngIf="!isDatesvalid">

                                {{'HRMANAGAMENT.DATESDUPLICATE' | translate}}
                            </span>
                            <span *ngIf="employeeSalaryDetailsForm.get('startDate').hasError('required')">
                                {{'HRMANAGAMENT.PLEASESELECTSTARTDATE' | translate}}</span>

                            <span
                                *ngIf="employeeSalaryDetailsForm.get('startDate').hasError('matDatepickerMin')">{{'HRMANAGAMENT.PLEASEENTERDATEGREATERTHAN' | translate}}</span>
                            <span
                                *ngIf="employeeSalaryDetailsForm.get('startDate').hasError('matDatepickerMax')">{{'HRMANAGAMENT.SELECTEDDATESHOULDBELESSTHANTODAYSDATE' | translate}}</span>
                        </mat-error>
                    </mat-form-field>
                </div>
                <div fxFlex="31" fxFlex.xs="100">
                    <mat-form-field class="full-width">
                        <input matInput formControlName="endDate" [matDatepicker]="picker2"
                            (click)="picker2.open();checkDateRangesForTemplates()"
                            (blur)="checkDateRangesForTemplates()" placeholder="{{'HRMANAGAMENT.ENDDATE' | translate}}"
                            [min]="minDateForEndDate" disabled={{endDateBool}} [readonly]="true" autocomplete="off">
                        <mat-datepicker-toggle matSuffix [for]="picker2" disabled={{endDateBool}}>
                        </mat-datepicker-toggle>
                        <mat-datepicker #picker2></mat-datepicker>
                    </mat-form-field>
                </div>
                <div fxFlex="35" fxFlex.xs="100">
                    <mat-form-field class="full-width">
                        <mat-select placeholder="{{'TAXSLABS.TAXCALCULATIONTYPE' | translate}}"
                            formControlName="taxCalculationTypeId">
                            <mat-option *ngFor="let taxCalculationType of taxCalculationTypes"
                                [value]="taxCalculationType.taxCalculationTypeId">
                                {{ taxCalculationType.taxCalculationTypeName }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>

            <div>
                <mat-form-field class="full-width">
                    <textarea formControlName="comments" matInput rows="1" cols="20"
                        placeholder="{{'EMPLOYEEIMMIGRATIONDETAILS.COMMENTS' | translate}}"></textarea>
                    <mat-error>
                        <span
                            *ngIf="employeeSalaryDetailsForm.get('comments').hasError('maxlength') && employeeSalaryDetailsForm.get('comments').touched">
                            {{'HRMANAGAMENT.COMMENTSSHOULDNOTEXCEED800CHARACTERS' | translate}}</span>
                    </mat-error>
                </mat-form-field>
            </div>
            <app-dropzone [moduleTypeId]="moduleTypeId" [referenceTypeId]="referenceTypeId"
                [getFilesByReferenceId]="true" [referenceId]="employeeSalaryDetailsId"
                [selectedParentFolderId]="selectedParentFolderId" [selectedStoreId]="selectedStoreId"
                [isButtonVisible]="false" (isFilesExist)="filesExist($event)" [isToUploadFiles]="isToUploadFiles">
            </app-dropzone>
            <!-- <mat-label>{{'USERSTORY.FILEEXTENSIONS' | translate}} :&nbsp;jpg, jpeg, png, pdf</mat-label> -->
        </div>
        <div class="mb-1 prl-1" fxLayoutAlign="center center">
            <button mat-button mat-raised-button type="submit" color="primary" class="mr-1"
                [disabled]="!employeeSalaryDetailsForm.valid || !isDatesvalid || (upsertEmployeeSalaryDetailsInProgress$ | async) || (anyOperationInProgress$ | async)">
                <mat-progress-bar color="primary" mode="indeterminate"
                    *ngIf="upsertEmployeeSalaryDetailsInProgress$ | async">
                </mat-progress-bar>
                <span *ngIf="!this.employeeSalaryDetailsId">
                    <fa-icon class="mr-05" icon="save"></fa-icon> {{'SAVE' | translate }}
                </span>
                <span *ngIf="this.employeeSalaryDetailsId">
                    <fa-icon class="mr-05" icon="pen"></fa-icon> {{'UPDATE' | translate}}
                </span>
            </button>
            <button mat-button mat-raised-button type="button" (click)="closePopover();onNoClick()"
                [disabled]="(upsertEmployeeSalaryDetailsInProgress$ | async) || (anyOperationInProgress$ | async)">
                <fa-icon class="mr-05" icon="times"></fa-icon> {{'CANCEL' | translate}}
            </button>
        </div>
    </form>
</div>